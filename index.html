<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="https://rayxk94.github.io">
  <title>xkBigData</title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    
    <!-- <meta name="keywords" content="">
    <meta name="description" content="xkBigData"> -->
  
  <meta name="description" content="xkBigData">
<meta property="og:type" content="website">
<meta property="og:title" content="xkBigData">
<meta property="og:url" content="https://rayxk94.github.io/index.html">
<meta property="og:site_name" content="xkBigData">
<meta property="og:description" content="xkBigData">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ray">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="xkBigData" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.a5fda8.css">
  <style type="text/css">
    
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

  
    
 	  <script src="/lib/clickLove.js"></script>
  
  


  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      


<div class="overlay" style="background: #4d4d4d;"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/img/xk.jpg" class="js-avatar">
		</a>
		<hgroup>
			<h1 class="header-author"><a href="/">Ray</a></h1>
		</hgroup>
		
		<p class="header-subtitle">xkBigData</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/" target="_blank">主页</a></li>
			
				<li><a href="https://github.com/Rayxk94" target="_blank">Git地址</a></li>
			
			</ul>
		</nav>
		<nav class="header-smart-menu">
			
				
					<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
				
			
				
					<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
				
			
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					
						<a class="github" href="https://github.com/Rayxk94" 
												title="GitHub" target="_blank"><i class="icon-github"></i></a>
					
				
			</div>
		
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<a href="/">
					<img src="/img/xk.jpg" class="js-avatar">
				</a>
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">Ray</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>xkBigData<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						
						<a class="github" target="_blank" 
							href="https://github.com/Rayxk94" title="GitHub"><i class="icon-github"></i></a>
						
					
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a target="_blank" rel="noopener" href="https://github.com/Rayxk94">Git地址</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1"
              class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            

  
    <article id="post-初识ClickHouse" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2020/03/15/%E5%88%9D%E8%AF%86ClickHouse/" target="_blank">初识ClickHouse</a>
  
    </h1>
  


  
  
<a href="/2020/03/15/%E5%88%9D%E8%AF%86ClickHouse/" class="archive-article-date">
        <time datetime="2020-03-15T13:09:16.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-03-15</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="初识ClickHouse"><a href="#初识ClickHouse" class="headerlink" title="初识ClickHouse"></a><center>初识ClickHouse</center></h2><p><a target="_blank" rel="noopener" href="https://clickhouse.tech/">ClickHouse 官网</a></p>
<h3 id="1-ClickHouse-介绍"><a href="#1-ClickHouse-介绍" class="headerlink" title="1. ClickHouse 介绍"></a>1. ClickHouse 介绍</h3><ul>
<li>ClickHouse 是一个采用列式存储，用于联机分析（OLAP）的数据库管理系统（DBMS）。</li>
<li>优点：<ul>
<li>列式存储</li>
<li>实时的数据更新</li>
<li>支持近似计算</li>
<li>支持数据复制和数据完整性</li>
</ul>
</li>
<li>缺点：<ul>
<li>没有完整的事务支持</li>
<li>缺少高频率、低延迟的修改或删除已存在数据的能力，仅能用于批量删除或修改数据</li>
</ul>
</li>
</ul>
<h3 id="2-部署-ClickHouse"><a href="#2-部署-ClickHouse" class="headerlink" title="2. 部署 ClickHouse"></a>2. 部署 ClickHouse</h3><p><a target="_blank" rel="noopener" href="https://clickhouse.tech/docs/en/getting-started/install/">部署文档（官方）</a></p>
<ul>
<li>本次部署采用的是单点部署</li>
</ul>
<h4 id="2-1-检查机器环境是否可以部署-ClickHouse"><a href="#2-1-检查机器环境是否可以部署-ClickHouse" class="headerlink" title="2.1 检查机器环境是否可以部署 ClickHouse"></a>2.1 检查机器环境是否可以部署 ClickHouse</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ grep -q sse4_2 &#x2F;proc&#x2F;cpuinfo &amp;&amp; echo &quot;SSE 4.2 supported&quot; || echo &quot;SSE 4.2 not supported&quot;</span><br><span class="line">SSE 4.2 supported</span><br></pre></td></tr></table></figure>

<h4 id="2-2-部署-ClickHouse"><a href="#2-2-部署-ClickHouse" class="headerlink" title="2.2 部署 ClickHouse"></a>2.2 部署 ClickHouse</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ sudo yum install yum-utils</span><br><span class="line">[hadoop@bigdata ~]$ sudo rpm --import https:&#x2F;&#x2F;repo.clickhouse.tech&#x2F;CLICKHOUSE-KEY.GPG</span><br><span class="line">[hadoop@bigdata ~]$ sudo yum-config-manager --add-repo https:&#x2F;&#x2F;repo.clickhouse.tech&#x2F;rpm&#x2F;stable&#x2F;x86_64</span><br><span class="line">[hadoop@bigdata ~]$ sudo yum install clickhouse-server clickhouse-client</span><br></pre></td></tr></table></figure>

<h4 id="2-3-启动-ClickHouse"><a href="#2-3-启动-ClickHouse" class="headerlink" title="2.3 启动 ClickHouse"></a>2.3 启动 ClickHouse</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ sudo systemctl start clickhouse-server</span><br><span class="line">[hadoop@bigdata ~]$ sudo systemctl status clickhouse-server</span><br><span class="line">● clickhouse-server.service - ClickHouse Server (analytic DBMS for big data)</span><br><span class="line">   Loaded: loaded (&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;clickhouse-server.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 日 2021-02-14 14:08:45 CST; 6s ago</span><br><span class="line"> Main PID: 10498 (clckhouse-watch)</span><br><span class="line">   CGroup: &#x2F;system.slice&#x2F;clickhouse-server.service</span><br><span class="line">           ├─10498 clickhouse-watchdog --config&#x3D;&#x2F;etc&#x2F;clickhouse-server&#x2F;config.xml --pid-file&#x3D;&#x2F;run&#x2F;clickhouse-server&#x2F;clickhouse-server.pid</span><br><span class="line">           └─10499 &#x2F;usr&#x2F;bin&#x2F;clickhouse-server --config&#x3D;&#x2F;etc&#x2F;clickhouse-server&#x2F;config.xml --pid-file&#x3D;&#x2F;run&#x2F;clickhouse-server&#x2F;clickhouse-server.pid</span><br><span class="line"></span><br><span class="line">2月 14 14:08:45 bigdata systemd[1]: Started ClickHouse Server (analytic DBMS for big data).</span><br><span class="line">2月 14 14:08:45 bigdata clickhouse-server[10498]: Processing configuration file &#39;&#x2F;etc&#x2F;clickhouse-server&#x2F;config.xml&#39;.</span><br><span class="line">2月 14 14:08:45 bigdata clickhouse-server[10498]: Logging trace to &#x2F;var&#x2F;log&#x2F;clickhouse-server&#x2F;clickhouse-server.log</span><br><span class="line">2月 14 14:08:45 bigdata clickhouse-server[10498]: Logging errors to &#x2F;var&#x2F;log&#x2F;clickhouse-server&#x2F;clickhouse-server.err.log</span><br><span class="line">2月 14 14:08:45 bigdata clickhouse-server[10498]: Processing configuration file &#39;&#x2F;etc&#x2F;clickhouse-server&#x2F;users.xml&#39;.</span><br><span class="line">2月 14 14:08:45 bigdata clickhouse-server[10498]: Saved preprocessed configuration to &#39;&#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;preprocessed_configs&#x2F;users.xml&#39;.</span><br><span class="line">2月 14 14:08:47 bigdata clickhouse-server[10498]: Processing configuration file &#39;&#x2F;etc&#x2F;clickhouse-server&#x2F;config.xml&#39;.</span><br><span class="line">2月 14 14:08:47 bigdata clickhouse-server[10498]: Saved preprocessed configuration to &#39;&#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;preprocessed_configs&#x2F;config.xml&#39;.</span><br></pre></td></tr></table></figure>

<ul>
<li>进入到 ClickHouse 客户端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ clickhouse-client</span><br></pre></td></tr></table></figure>

<h3 id="3-修改-ClickHouse-配置文件"><a href="#3-修改-ClickHouse-配置文件" class="headerlink" title="3. 修改 ClickHouse 配置文件"></a>3. 修改 ClickHouse 配置文件</h3><ul>
<li>修改配置文件：/etc/clickhouse-server/config.xml</li>
<li>ClickHouse JDBC 端口号</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;tcp_port&gt;9000&lt;&#x2F;tcp_port&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>ClickHouse 修改监听的 HostName</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;listen_host&gt;::&lt;&#x2F;listen_host&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启 ClickHouse</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ sudo systemctl start clickhouse-server</span><br><span class="line">[hadoop@bigdata ~]$ clickhouse-client --host&#x3D;bigdata --port&#x3D;9000</span><br><span class="line">bigdata :) show databases;</span><br><span class="line"></span><br><span class="line">SHOW DATABASES</span><br><span class="line"></span><br><span class="line">Query id: 478c40aa-9367-4322-a66a-61c61f906138</span><br><span class="line"></span><br><span class="line">┌─name────┐</span><br><span class="line">│ default │</span><br><span class="line">│ system  │</span><br><span class="line">└─────────┘</span><br><span class="line"></span><br><span class="line">2 rows in set. Elapsed: 0.004 sec. </span><br></pre></td></tr></table></figure>

<ul>
<li>客户端执行的 SQL 语句如果需要换行操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ clickhouse-client --host&#x3D;bigdata --port&#x3D;9000 -m</span><br><span class="line">bigdata :) show</span><br><span class="line">:-] databases;</span><br><span class="line"></span><br><span class="line">SHOW DATABASES</span><br><span class="line"></span><br><span class="line">Query id: 66526349-6668-4e89-b53c-dd70b5aeb99f</span><br><span class="line"></span><br><span class="line">┌─name────┐</span><br><span class="line">│ default │</span><br><span class="line">│ system  │</span><br><span class="line">└─────────┘</span><br><span class="line"></span><br><span class="line">2 rows in set. Elapsed: 0.006 sec. </span><br></pre></td></tr></table></figure>

<ul>
<li>修改 users.xml</li>
<li>增加一个用户</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata clickhouse-server]# pwd</span><br><span class="line">&#x2F;etc&#x2F;clickhouse-server</span><br><span class="line">[root@bigdata clickhouse-server]# vim users.xml </span><br><span class="line">&lt;bigdata&gt;</span><br><span class="line">	&lt;password&gt;123456&lt;&#x2F;password&gt;</span><br><span class="line">	&lt;networks&gt;</span><br><span class="line">		&lt;ip&gt;::&#x2F;0&lt;&#x2F;ip&gt;</span><br><span class="line">	&lt;&#x2F;networks&gt;</span><br><span class="line">	&lt;profile&gt;default&lt;&#x2F;profile&gt;</span><br><span class="line">	&lt;quota&gt;default&lt;&#x2F;quota&gt;</span><br><span class="line">&lt;&#x2F;bigdata&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;$username&gt;</span><br><span class="line">	&lt;password&gt;$password&lt;&#x2F;password&gt;</span><br><span class="line">	&lt;networks&gt;</span><br><span class="line">		&lt;ip&gt;::&#x2F;0&lt;&#x2F;ip&gt;</span><br><span class="line">	&lt;&#x2F;networks&gt;</span><br><span class="line">	&lt;profile&gt;default&lt;&#x2F;profile&gt;</span><br><span class="line">	&lt;quota&gt;default&lt;&#x2F;quota&gt;</span><br><span class="line">&lt;&#x2F;$username&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启服务并登录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ sudo systemctl start clickhouse-server</span><br><span class="line">[hadoop@bigdata ~]$ clickhouse-client --host&#x3D;bigdata --port&#x3D;9000 -m --user&#x3D;bigdata --password&#x3D;123456</span><br><span class="line"></span><br><span class="line">bigdata :) show databases;</span><br><span class="line"></span><br><span class="line">SHOW DATABASES</span><br><span class="line"></span><br><span class="line">Query id: aad8f902-2908-447f-8683-8df1c58ee47c</span><br><span class="line"></span><br><span class="line">┌─name────┐</span><br><span class="line">│ default │</span><br><span class="line">│ system  │</span><br><span class="line">└─────────┘</span><br><span class="line"></span><br><span class="line">3 rows in set. Elapsed: 0.004 sec. </span><br></pre></td></tr></table></figure>

<h3 id="4-ClickHouse-默认重要的路径"><a href="#4-ClickHouse-默认重要的路径" class="headerlink" title="4. ClickHouse 默认重要的路径"></a>4. ClickHouse 默认重要的路径</h3><ul>
<li>配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;clickhouse-server</span><br></pre></td></tr></table></figure>

<ul>
<li>数据路径</li>
<li>一个 database 一个文件夹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;data</span><br></pre></td></tr></table></figure>

<ul>
<li>元数据路径</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;metadata</span><br></pre></td></tr></table></figure>

<ul>
<li>命令行路径</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;clickhouse-server</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;clickhouse-client</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;clickhouse-benchmark</span><br></pre></td></tr></table></figure>

<h3 id="5-ClickHouse-基本操作"><a href="#5-ClickHouse-基本操作" class="headerlink" title="5. ClickHouse 基本操作"></a>5. ClickHouse 基本操作</h3><h4 id="5-1-创建一个数据库"><a href="#5-1-创建一个数据库" class="headerlink" title="5.1 创建一个数据库"></a>5.1 创建一个数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE [IF NOT EXISTS] db_name [ON CLUSTER cluster] [ENGINE &#x3D; engine(...)]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) create database bigdata;</span><br><span class="line"></span><br><span class="line">CREATE DATABASE bigdata</span><br><span class="line"></span><br><span class="line">Query id: aebd4d34-7af4-4c15-92d3-7b777476fd08</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows in set. Elapsed: 0.005 sec. </span><br><span class="line">bigdata :) use bigdata;</span><br><span class="line"></span><br><span class="line">USE bigdata</span><br><span class="line"></span><br><span class="line">Query id: 31543b31-ddf2-4fa4-a617-6c8a21303afe</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows in set. Elapsed: 0.002 sec. </span><br><span class="line">bigdata :) select currentDatabase()　;</span><br><span class="line"></span><br><span class="line">SELECT currentDatabase()</span><br><span class="line"></span><br><span class="line">Query id: 2cd2d043-1966-43a9-9e2c-2f5e02d50803</span><br><span class="line"></span><br><span class="line">┌─currentDatabase()─┐</span><br><span class="line">│ bigdata           │</span><br><span class="line">└───────────────────┘</span><br><span class="line"></span><br><span class="line">1 rows in set. Elapsed: 0.004 sec. </span><br></pre></td></tr></table></figure>

<h4 id="5-2-创建一张表"><a href="#5-2-创建一张表" class="headerlink" title="5.2 创建一张表"></a>5.2 创建一张表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]</span><br><span class="line">(</span><br><span class="line">    name1 [type1] [NULL|NOT NULL] [DEFAULT|MATERIALIZED|ALIAS expr1] [compression_codec] [TTL expr1],</span><br><span class="line">    name2 [type2] [NULL|NOT NULL] [DEFAULT|MATERIALIZED|ALIAS expr2] [compression_codec] [TTL expr2],</span><br><span class="line">    ...</span><br><span class="line">) ENGINE &#x3D; engine</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) CREATE TABLE test</span><br><span class="line">:-] (</span><br><span class="line">:-]     id Int32,</span><br><span class="line">:-]     name String</span><br><span class="line">:-] ) ENGINE &#x3D; Memory;</span><br><span class="line"></span><br><span class="line">CREATE TABLE test</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96; Int32,</span><br><span class="line">    &#96;name&#96; String</span><br><span class="line">)</span><br><span class="line">ENGINE &#x3D; Memory</span><br><span class="line"></span><br><span class="line">Query id: 7adb3381-57f1-4c6b-847a-f82590888cc9</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows in set. Elapsed: 0.020 sec. </span><br></pre></td></tr></table></figure>

<h4 id="5-3-插入一笔数据"><a href="#5-3-插入一笔数据" class="headerlink" title="5.3 插入一笔数据"></a>5.3 插入一笔数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) insert into test values(1,&#39;hadoop&#39;),(2,&#39;spark&#39;);</span><br><span class="line"></span><br><span class="line">INSERT INTO test VALUES</span><br><span class="line"></span><br><span class="line">Query id: 50160821-b508-42b7-a344-05087d6932a9</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">2 rows in set. Elapsed: 0.005 sec.</span><br></pre></td></tr></table></figure>

<h4 id="5-4-查询数据"><a href="#5-4-查询数据" class="headerlink" title="5.4 查询数据"></a>5.4 查询数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) select * from test;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM test</span><br><span class="line"></span><br><span class="line">Query id: 51dba55f-39df-4c66-832a-20ecb3117c51</span><br><span class="line"></span><br><span class="line">┌─id─┬─name───┐</span><br><span class="line">│  1 │ hadoop │</span><br><span class="line">│  2 │ spark  │</span><br><span class="line">└────┴────────┘</span><br><span class="line"></span><br><span class="line">2 rows in set. Elapsed: 0.005 sec. </span><br></pre></td></tr></table></figure>

<h4 id="5-5-修改数据"><a href="#5-5-修改数据" class="headerlink" title="5.5 修改数据"></a>5.5 修改数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) ALTER TABLE test UPDATE name &#x3D; &#39;spark1&#39; where id &#x3D; 2; </span><br><span class="line"></span><br><span class="line">ALTER TABLE test</span><br><span class="line">    UPDATE name &#x3D; &#39;spark1&#39; WHERE id &#x3D; 2</span><br><span class="line"></span><br><span class="line">Query id: 3ede61c5-72b9-4af1-b75b-33882da9288e</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows in set. Elapsed: 0.003 sec. </span><br><span class="line"></span><br><span class="line">bigdata :) select * from test;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM test</span><br><span class="line"></span><br><span class="line">Query id: d9045117-ec85-4146-82c8-6b11109adf69</span><br><span class="line"></span><br><span class="line">┌─id─┬─name───┐</span><br><span class="line">│  1 │ hadoop │</span><br><span class="line">│  2 │ spark1 │</span><br><span class="line">└────┴────────┘</span><br><span class="line"></span><br><span class="line">2 rows in set. Elapsed: 0.005 sec. </span><br></pre></td></tr></table></figure>

<h4 id="5-6-删除数据"><a href="#5-6-删除数据" class="headerlink" title="5.6 删除数据"></a>5.6 删除数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) ALTER TABLE test delete where id &#x3D; 2;</span><br><span class="line"></span><br><span class="line">ALTER TABLE test</span><br><span class="line">    DELETE WHERE id &#x3D; 2</span><br><span class="line"></span><br><span class="line">Query id: 9cecf262-aa88-4ba2-81b8-5db27046e1d2</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows in set. Elapsed: 0.005 sec. </span><br><span class="line"></span><br><span class="line">bigdata :) select * from test;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM test</span><br><span class="line"></span><br><span class="line">Query id: 931e9a24-3f86-48ec-9df0-e8f4c7b3d603</span><br><span class="line"></span><br><span class="line">┌─id─┬─name───┐</span><br><span class="line">│  1 │ hadoop │</span><br><span class="line">└────┴────────┘</span><br><span class="line"></span><br><span class="line">1 rows in set. Elapsed: 0.006 sec. </span><br></pre></td></tr></table></figure>

<h3 id="6-ClickHouse-常用数据类型"><a href="#6-ClickHouse-常用数据类型" class="headerlink" title="6. ClickHouse 常用数据类型"></a>6. ClickHouse 常用数据类型</h3><ul>
<li>ClickHouse 数据类型中区分大小写</li>
<li>查看本版本中有哪些数据类型：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) select * from system.data_type_families;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM system.data_type_families</span><br><span class="line"></span><br><span class="line">Query id: e5b07c0c-b7a5-42c5-9040-c69a04bf7e67</span><br><span class="line"></span><br><span class="line">┌─name────────────────────────────┬─case_insensitive─┬─alias_to────┐</span><br><span class="line">│ Polygon                         │                0 │             │</span><br><span class="line">│ Ring                            │                0 │             │</span><br><span class="line">│ MultiPolygon                    │                0 │             │</span><br><span class="line">│ IPv6                            │                0 │             │</span><br><span class="line">│ IntervalSecond                  │                0 │             │</span><br><span class="line">│ IPv4                            │                0 │             │</span><br><span class="line">│ UInt32                          │                0 │             │</span><br><span class="line">│ IntervalYear                    │                0 │             │</span><br><span class="line">│ IntervalQuarter                 │                0 │             │</span><br><span class="line">│ IntervalMonth                   │                0 │             │</span><br><span class="line">│ Int64                           │                0 │             │</span><br><span class="line">│ IntervalDay                     │                0 │             │</span><br><span class="line">│ IntervalHour                    │                0 │             │</span><br><span class="line">│ UInt256                         │                0 │             │</span><br><span class="line">│ Int16                           │                0 │             │</span><br><span class="line">│ LowCardinality                  │                0 │             │</span><br><span class="line">│ AggregateFunction               │                0 │             │</span><br><span class="line">│ Nothing                         │                0 │             │</span><br><span class="line">│ Decimal256                      │                1 │             │</span><br><span class="line">│ Tuple                           │                0 │             │</span><br><span class="line">│ Array                           │                0 │             │</span><br><span class="line">│ Enum16                          │                0 │             │</span><br><span class="line">│ IntervalMinute                  │                0 │             │</span><br><span class="line">│ FixedString                     │                0 │             │</span><br><span class="line">│ String                          │                0 │             │</span><br><span class="line">│ DateTime                        │                1 │             │</span><br><span class="line">│ Map                             │                0 │             │</span><br><span class="line">│ UUID                            │                0 │             │</span><br><span class="line">│ Decimal64                       │                1 │             │</span><br><span class="line">│ Nullable                        │                0 │             │</span><br><span class="line">│ Enum                            │                0 │             │</span><br><span class="line">│ Int32                           │                0 │             │</span><br><span class="line">│ UInt8                           │                0 │             │</span><br><span class="line">│ Date                            │                1 │             │</span><br><span class="line">│ Decimal32                       │                1 │             │</span><br><span class="line">│ Point                           │                0 │             │</span><br><span class="line">│ Float64                         │                0 │             │</span><br><span class="line">│ DateTime64                      │                1 │             │</span><br><span class="line">│ Int128                          │                0 │             │</span><br><span class="line">│ Decimal128                      │                1 │             │</span><br><span class="line">│ Int8                            │                0 │             │</span><br><span class="line">│ SimpleAggregateFunction         │                0 │             │</span><br><span class="line">│ Nested                          │                0 │             │</span><br><span class="line">│ Decimal                         │                1 │             │</span><br><span class="line">│ Int256                          │                0 │             │</span><br><span class="line">│ IntervalWeek                    │                0 │             │</span><br><span class="line">│ UInt64                          │                0 │             │</span><br><span class="line">│ Enum8                           │                0 │             │</span><br><span class="line">│ DateTime32                      │                1 │             │</span><br><span class="line">│ UInt16                          │                0 │             │</span><br><span class="line">│ Float32                         │                0 │             │</span><br><span class="line">│ INET6                           │                1 │ IPv6        │</span><br><span class="line">│ INET4                           │                1 │ IPv4        │</span><br><span class="line">│ BINARY                          │                1 │ FixedString │</span><br><span class="line">│ NATIONAL CHAR VARYING           │                1 │ String      │</span><br><span class="line">│ BINARY VARYING                  │                1 │ String      │</span><br><span class="line">│ NCHAR LARGE OBJECT              │                1 │ String      │</span><br><span class="line">│ NATIONAL CHARACTER VARYING      │                1 │ String      │</span><br><span class="line">│ NATIONAL CHARACTER LARGE OBJECT │                1 │ String      │</span><br><span class="line">│ NATIONAL CHARACTER              │                1 │ String      │</span><br><span class="line">│ NATIONAL CHAR                   │                1 │ String      │</span><br><span class="line">│ CHARACTER VARYING               │                1 │ String      │</span><br><span class="line">│ LONGBLOB                        │                1 │ String      │</span><br><span class="line">│ MEDIUMTEXT                      │                1 │ String      │</span><br><span class="line">│ TEXT                            │                1 │ String      │</span><br><span class="line">│ TINYBLOB                        │                1 │ String      │</span><br><span class="line">│ VARCHAR2                        │                1 │ String      │</span><br><span class="line">│ CHARACTER LARGE OBJECT          │                1 │ String      │</span><br><span class="line">│ DOUBLE PRECISION                │                1 │ Float64     │</span><br><span class="line">│ LONGTEXT                        │                1 │ String      │</span><br><span class="line">│ NVARCHAR                        │                1 │ String      │</span><br><span class="line">│ INT1 UNSIGNED                   │                1 │ UInt8       │</span><br><span class="line">│ VARCHAR                         │                1 │ String      │</span><br><span class="line">│ CHAR VARYING                    │                1 │ String      │</span><br><span class="line">│ MEDIUMBLOB                      │                1 │ String      │</span><br><span class="line">│ NCHAR                           │                1 │ String      │</span><br><span class="line">│ CHAR                            │                1 │ String      │</span><br><span class="line">│ SMALLINT UNSIGNED               │                1 │ UInt16      │</span><br><span class="line">│ TIMESTAMP                       │                1 │ DateTime    │</span><br><span class="line">│ FIXED                           │                1 │ Decimal     │</span><br><span class="line">│ TINYTEXT                        │                1 │ String      │</span><br><span class="line">│ NUMERIC                         │                1 │ Decimal     │</span><br><span class="line">│ DEC                             │                1 │ Decimal     │</span><br><span class="line">│ TINYINT UNSIGNED                │                1 │ UInt8       │</span><br><span class="line">│ INTEGER UNSIGNED                │                1 │ UInt32      │</span><br><span class="line">│ INT UNSIGNED                    │                1 │ UInt32      │</span><br><span class="line">│ CLOB                            │                1 │ String      │</span><br><span class="line">│ MEDIUMINT UNSIGNED              │                1 │ UInt32      │</span><br><span class="line">│ BOOL                            │                1 │ Int8        │</span><br><span class="line">│ SMALLINT                        │                1 │ Int16       │</span><br><span class="line">│ INTEGER SIGNED                  │                1 │ Int32       │</span><br><span class="line">│ NCHAR VARYING                   │                1 │ String      │</span><br><span class="line">│ INT SIGNED                      │                1 │ Int32       │</span><br><span class="line">│ TINYINT SIGNED                  │                1 │ Int8        │</span><br><span class="line">│ BIGINT SIGNED                   │                1 │ Int64       │</span><br><span class="line">│ BINARY LARGE OBJECT             │                1 │ String      │</span><br><span class="line">│ SMALLINT SIGNED                 │                1 │ Int16       │</span><br><span class="line">│ MEDIUMINT                       │                1 │ Int32       │</span><br><span class="line">│ INTEGER                         │                1 │ Int32       │</span><br><span class="line">│ INT1 SIGNED                     │                1 │ Int8        │</span><br><span class="line">│ BIGINT UNSIGNED                 │                1 │ UInt64      │</span><br><span class="line">│ BYTEA                           │                1 │ String      │</span><br><span class="line">│ INT                             │                1 │ Int32       │</span><br><span class="line">│ SINGLE                          │                1 │ Float32     │</span><br><span class="line">│ FLOAT                           │                1 │ Float32     │</span><br><span class="line">│ MEDIUMINT SIGNED                │                1 │ Int32       │</span><br><span class="line">│ BOOLEAN                         │                1 │ Int8        │</span><br><span class="line">│ DOUBLE                          │                1 │ Float64     │</span><br><span class="line">│ INT1                            │                1 │ Int8        │</span><br><span class="line">│ CHAR LARGE OBJECT               │                1 │ String      │</span><br><span class="line">│ TINYINT                         │                1 │ Int8        │</span><br><span class="line">│ BIGINT                          │                1 │ Int64       │</span><br><span class="line">│ CHARACTER                       │                1 │ String      │</span><br><span class="line">│ BYTE                            │                1 │ Int8        │</span><br><span class="line">│ BLOB                            │                1 │ String      │</span><br><span class="line">│ REAL                            │                1 │ Float32     │</span><br><span class="line">└─────────────────────────────────┴──────────────────┴─────────────┘</span><br><span class="line"></span><br><span class="line">116 rows in set. Elapsed: 0.006 sec.</span><br></pre></td></tr></table></figure>

<h4 id="6-1-Int-类型"><a href="#6-1-Int-类型" class="headerlink" title="6.1 Int 类型"></a>6.1 Int 类型</h4><ul>
<li>Int 类型有以下这些：</li>
<li>UInt8, UInt16, UInt32, UInt64, UInt256, Int8, Int16, Int32, Int64, Int128, Int256</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Int Ranges </span><br><span class="line">Int8 — [-128 : 127]</span><br><span class="line">Int16 — [-32768 : 32767]</span><br><span class="line">Int32 — [-2147483648 : 2147483647]</span><br><span class="line">Int64 — [-9223372036854775808 : 9223372036854775807]</span><br><span class="line">Int128 — [-170141183460469231731687303715884105728 : 170141183460469231731687303715884105727]</span><br><span class="line">Int256 — [-57896044618658097711785492504343953926634992332820282019728792003956564819968 : 57896044618658097711785492504343953926634992332820282019728792003956564819967]</span><br><span class="line"></span><br><span class="line">Uint Ranges </span><br><span class="line">UInt8 — [0 : 255]</span><br><span class="line">UInt16 — [0 : 65535]</span><br><span class="line">UInt32 — [0 : 4294967295]</span><br><span class="line">UInt64 — [0 : 18446744073709551615]</span><br><span class="line">UInt256 — [0 : 115792089237316195423570985008687907853269984665640564039457584007913129639935]</span><br></pre></td></tr></table></figure>

<h4 id="6-2-Float-类型"><a href="#6-2-Float-类型" class="headerlink" title="6.2 Float 类型"></a>6.2 Float 类型</h4><ul>
<li>Float32 — float</li>
<li>Float64 — double</li>
<li>NaN and Inf<ul>
<li>Inf : 无穷</li>
<li>NaN : 不是一个数字</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) SELECT 0.5 &#x2F; 0</span><br><span class="line">:-] ;</span><br><span class="line"></span><br><span class="line">SELECT 0.5 &#x2F; 0</span><br><span class="line"></span><br><span class="line">Query id: 0af32c1e-100c-40e1-8f1c-469390d545be</span><br><span class="line"></span><br><span class="line">┌─divide(0.5, 0)─┐</span><br><span class="line">│            inf │</span><br><span class="line">└────────────────┘</span><br><span class="line"></span><br><span class="line">1 rows in set. Elapsed: 0.004 sec. </span><br><span class="line"></span><br><span class="line">bigdata :) SELECT -0.5 &#x2F; 0;</span><br><span class="line"></span><br><span class="line">SELECT -0.5 &#x2F; 0</span><br><span class="line"></span><br><span class="line">Query id: 60f4d58c-c969-4453-bd3b-7531ef309861</span><br><span class="line"></span><br><span class="line">┌─divide(-0.5, 0)─┐</span><br><span class="line">│            -inf │</span><br><span class="line">└─────────────────┘</span><br><span class="line"></span><br><span class="line">1 rows in set. Elapsed: 0.006 sec. </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) SELECT 0 &#x2F; 0</span><br><span class="line">:-] ;</span><br><span class="line"></span><br><span class="line">SELECT 0 &#x2F; 0</span><br><span class="line"></span><br><span class="line">Query id: b9275b88-d23e-44b7-80df-4d2d78e7ccbb</span><br><span class="line"></span><br><span class="line">┌─divide(0, 0)─┐</span><br><span class="line">│          nan │</span><br><span class="line">└──────────────┘</span><br><span class="line"></span><br><span class="line">1 rows in set. Elapsed: 0.004 sec. </span><br></pre></td></tr></table></figure>

<h4 id="6-3-Decimal-类型"><a href="#6-3-Decimal-类型" class="headerlink" title="6.3 Decimal 类型"></a>6.3 Decimal 类型</h4><ul>
<li>Decimal(P, S), Decimal32(S), Decimal64(S), Decimal128(S), Decimal256(S)<ul>
<li>P - precision. Valid range: [ 1 : 76 ]. 代表数字可以有多少个小数位数（包括分数）。</li>
<li>S - scale. Valid range: [ 0 : P ]. 小数部分可以有多少个小数位数。</li>
</ul>
</li>
<li>加减乘除运算：<ul>
<li>add, subtract: S = max(S1, S2)：加、减</li>
<li>multuply: S = S1 + S2：乘法</li>
<li>divide: S = S1：除法</li>
</ul>
</li>
</ul>
<h4 id="6-4-Boolean-类型"><a href="#6-4-Boolean-类型" class="headerlink" title="6.4 Boolean 类型"></a>6.4 Boolean 类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">There is no separate type for boolean values. Use UInt8 type, restricted to the values 0 or 1.</span><br></pre></td></tr></table></figure>

<ul>
<li>可以使用 UInt8 中 0、1来表示</li>
</ul>
<h4 id="6-5-String-类型"><a href="#6-5-String-类型" class="headerlink" title="6.5 String 类型"></a>6.5 String 类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Strings of an arbitrary length. The length is not limited. The value can contain an arbitrary set of bytes, including null bytes.</span><br><span class="line">The String type replaces the types VARCHAR, BLOB, CLOB, and others from other DBMSs.</span><br></pre></td></tr></table></figure>

<h4 id="6-6-Fixedstring-类型"><a href="#6-6-Fixedstring-类型" class="headerlink" title="6.6 Fixedstring 类型"></a>6.6 Fixedstring 类型</h4><ul>
<li>固定长度的 String 类型</li>
<li>FixedString(N)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) CREATE TABLE test_fixedstring</span><br><span class="line">:-] (</span><br><span class="line">:-]     id Int32,</span><br><span class="line">:-]     name FixedString(5)</span><br><span class="line">:-] ) ENGINE &#x3D; Memory;</span><br><span class="line"></span><br><span class="line">CREATE TABLE test_fixedstring</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96; Int32,</span><br><span class="line">    &#96;name&#96; FixedString(5)</span><br><span class="line">)</span><br><span class="line">ENGINE &#x3D; Memory</span><br><span class="line"></span><br><span class="line">Query id: a7394848-4af2-4cb5-acd6-230188b035b0</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows in set. Elapsed: 0.008 sec. </span><br><span class="line"></span><br><span class="line">bigdata :) insert into test_fixedstring values(1,&#39;spark&#39;);</span><br><span class="line"></span><br><span class="line">INSERT INTO test_fixedstring VALUES</span><br><span class="line"></span><br><span class="line">Query id: 3811b8f1-d68c-4457-bc57-b45be5c719b6</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">1 rows in set. Elapsed: 0.005 sec. </span><br><span class="line"></span><br><span class="line">bigdata :) insert into test_fixedstring values(2,&#39;hadoop&#39;);</span><br><span class="line"></span><br><span class="line">INSERT INTO test_fixedstring VALUES</span><br><span class="line"></span><br><span class="line">Query id: 8aeb2b97-b44f-40ab-bdee-ff6106a75606</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exception on client:</span><br><span class="line">Code: 131. DB::Exception: String too long for type FixedString(5): while executing &#39;FUNCTION CAST(assumeNotNull(_dummy_0) :: 2, &#39;FixedString(5)&#39; :: 1) -&gt; cast(assumeNotNull(_dummy_0), &#39;FixedString(5)&#39;) FixedString(5) : 4&#39;: data for INSERT was parsed from query</span><br><span class="line"></span><br><span class="line">Connecting to database bigdata at bigdata:9000 as user default.</span><br><span class="line">Connected to ClickHouse server version 21.2.2 revision 54447.</span><br></pre></td></tr></table></figure>

<h4 id="6-7-UUID-类型"><a href="#6-7-UUID-类型" class="headerlink" title="6.7 UUID 类型"></a>6.7 UUID 类型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A universally unique identifier (UUID) is a 16-byte number used to identify records</span><br></pre></td></tr></table></figure>

<ul>
<li>一般是配合 generateUUIDv4 函数一起使用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO t_uuid SELECT generateUUIDv4(), &#39;Example 1&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">bigdata :) CREATE TABLE test_uuid</span><br><span class="line">:-] (</span><br><span class="line">:-]     id UUID,</span><br><span class="line">:-]     name String</span><br><span class="line">:-] ) ENGINE &#x3D; Memory;</span><br><span class="line"></span><br><span class="line">CREATE TABLE test_uuid</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96; UUID,</span><br><span class="line">    &#96;name&#96; String</span><br><span class="line">)</span><br><span class="line">ENGINE &#x3D; Memory</span><br><span class="line"></span><br><span class="line">Query id: d3fde3cd-609f-497c-b662-4f75d252b076</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">0 rows in set. Elapsed: 0.004 sec. </span><br><span class="line"></span><br><span class="line">bigdata :) insert into test_uuid(name) values(&#39;spark&#39;),(&#39;hadoop&#39;);</span><br><span class="line"></span><br><span class="line">INSERT INTO test_uuid (name) VALUES</span><br><span class="line"></span><br><span class="line">Query id: a513ba06-55a5-4dfd-accf-acfa03636969</span><br><span class="line"></span><br><span class="line">Ok.</span><br><span class="line"></span><br><span class="line">2 rows in set. Elapsed: 0.005 sec. </span><br><span class="line"></span><br><span class="line">bigdata :) select * from test_uuid;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM test_uuid</span><br><span class="line"></span><br><span class="line">Query id: 69a9a816-1308-41aa-8d1d-64759557795b</span><br><span class="line"></span><br><span class="line">┌───────────────────────────────────id─┬─name───┐</span><br><span class="line">│ 00000000-0000-0000-0000-000000000000 │ spark  │</span><br><span class="line">│ 00000000-0000-0000-0000-000000000000 │ hadoop │</span><br><span class="line">└──────────────────────────────────────┴────────┘</span><br><span class="line"></span><br><span class="line">2 rows in set. Elapsed: 0.007 sec. </span><br></pre></td></tr></table></figure>

<h4 id="6-8-Date-类型"><a href="#6-8-Date-类型" class="headerlink" title="6.8 Date 类型"></a>6.8 Date 类型</h4><ul>
<li>Date : 精确到日期</li>
<li>Datetime ：精确到秒，可以自己选择时区：DateTime([timezone])</li>
<li>Datetime64 ：自定义精确到哪里，最多可以精确到亚秒：DateTime64(precision, [timezone])：Tick size (precision): 10-precision seconds</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE dt</span><br><span class="line">(</span><br><span class="line">    &#96;timestamp&#96; Date,</span><br><span class="line">    &#96;event_id&#96; UInt8</span><br><span class="line">)</span><br><span class="line">ENGINE &#x3D; TinyLog;</span><br><span class="line">INSERT INTO dt Values (1546300800, 1), (&#39;2019-01-01&#39;, 2);</span><br><span class="line">SELECT * FROM dt;</span><br><span class="line">┌──timestamp─┬─event_id─┐</span><br><span class="line">│ 2019-01-01 │        1 │</span><br><span class="line">│ 2019-01-01 │        2 │</span><br><span class="line">└────────────┴──────────┘</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE dt</span><br><span class="line">(</span><br><span class="line">    &#96;timestamp&#96; DateTime(&#39;Europe&#x2F;Moscow&#39;),</span><br><span class="line">    &#96;event_id&#96; UInt8</span><br><span class="line">)</span><br><span class="line">ENGINE &#x3D; TinyLog;</span><br><span class="line">INSERT INTO dt Values (1546300800, 1), (&#39;2019-01-01 00:00:00&#39;, 2);</span><br><span class="line">SELECT * FROM dt;</span><br><span class="line">┌───────────timestamp─┬─event_id─┐</span><br><span class="line">│ 2019-01-01 03:00:00 │        1 │</span><br><span class="line">│ 2019-01-01 00:00:00 │        2 │</span><br><span class="line">└─────────────────────┴──────────┘</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE dt</span><br><span class="line">(</span><br><span class="line">    &#96;timestamp&#96; DateTime64(3, &#39;Europe&#x2F;Moscow&#39;),</span><br><span class="line">    &#96;event_id&#96; UInt8</span><br><span class="line">)</span><br><span class="line">ENGINE &#x3D; TinyLog</span><br><span class="line">INSERT INTO dt Values (1546300800000, 1), (&#39;2019-01-01 00:00:00&#39;, 2)</span><br><span class="line">SELECT * FROM dt</span><br><span class="line">┌───────────────timestamp─┬─event_id─┐</span><br><span class="line">│ 2019-01-01 03:00:00.000 │        1 │</span><br><span class="line">│ 2019-01-01 00:00:00.000 │        2 │</span><br><span class="line">└─────────────────────────┴──────────┘</span><br></pre></td></tr></table></figure>
    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">clickhouse</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2020/03/15/%E5%88%9D%E8%AF%86ClickHouse/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-CDH 动态资源池" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2020/03/10/CDH%20%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E6%B1%A0/" target="_blank">CDH 动态资源池</a>
  
    </h1>
  


  
  
<a href="/2020/03/10/CDH%20%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E6%B1%A0/" class="archive-article-date">
        <time datetime="2020-03-10T14:06:14.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-03-10</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="CDH-动态资源池"><a href="#CDH-动态资源池" class="headerlink" title="CDH 动态资源池"></a><center>CDH 动态资源池</center></h2><ul>
<li><p>CDH 的动态资源池类似于 Yarn 中的队列概念差不多</p>
</li>
<li><p>现在有这样一个需求，开发环境中，就只有一套 CDH 的集群，不同的用户组使用不同的硬件资源，这时候可以通过动态资源池来实现这个功能。</p>
</li>
<li><p>需求：</p>
<ul>
<li>一个 CDH 集群里面有开发人员和 BI 人员，开发人员可以使用 Yarn 中的百分之五十资源，BI 人员可以使用 CDH 中的百分之四十资源，剩下的百分之十硬件资源为了防止其他用户提交，用于默认。</li>
</ul>
</li>
<li><p>本次测试的是集群是 CDH 5.16.2，测试的计算软件是 CDH 自带的 Spark 1.6 。</p>
</li>
<li><p>配置动态资源池</p>
<p>![CDH 动态资源池1](/img/cdh/CDH 动态资源池1.png)</p>
<p>![CDH 动态资源池2](/img/cdh/CDH 动态资源池2.png)</p>
<p>![CDH 动态资源池3](/img/cdh/CDH 动态资源池3.png)</p>
<p>![CDH 动态资源池4](/img/cdh/CDH 动态资源池4.png)</p>
<p>![CDH 动态资源池5](/img/cdh/CDH 动态资源池5.png)</p>
</li>
<li><p>刷新动态资源池</p>
</li>
</ul>
<p>![CDH 动态资源池6](/img/cdh/CDH 动态资源池6.png)</p>
<ul>
<li>配置动态资源池中的放置规则</li>
<li>删除已有的配置规则</li>
</ul>
<p>![CDH 动态资源池7](/img/cdh/CDH 动态资源池7.png)</p>
<ul>
<li>配置放置规则</li>
</ul>
<p>![CDH 动态资源池8](/img/cdh/CDH 动态资源池8.png)</p>
<p>![CDH 动态资源池9](/img/cdh/CDH 动态资源池9.png)</p>
<ul>
<li>刷新放置规则</li>
</ul>
<p>![CDH 动态资源池10](/img/cdh/CDH 动态资源池10.png)</p>
<ul>
<li>在集群中的所有节点上面创建 bi 用户组，并创建一个用户为 bi1 的账号，用户组为 bi</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# groupadd bi</span><br><span class="line">[root@bigdata001 ~]# useradd -g bi bi1</span><br><span class="line">[root@bigdata001 ~]# id bi1</span><br><span class="line">uid&#x3D;1001(bi1) gid&#x3D;1001(bi) groups&#x3D;1001(bi)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 bi1 账号提交 Spark 程序</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# clear</span><br><span class="line">[root@bigdata001 ~]# su bi1</span><br><span class="line">[bi1@bigdata001 root]$ cd &#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH&#x2F;lib&#x2F;spark&#x2F;</span><br><span class="line">[bi1@bigdata001 spark]$ bin&#x2F;spark-submit --master yarn-cluster --class org.apache.spark.examples.SparkPi  &#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH&#x2F;lib&#x2F;spark&#x2F;examples&#x2F;lib&#x2F;spark-examples-1.6.0-cdh5.16.2-hadoop2.6.0-cdh5.16.2.jar</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 CDH Yarn</li>
</ul>
<p>![CDH 动态资源池11](/img/cdh/CDH 动态资源池11.png)</p>
<ul>
<li>可以看出本程序运行的资源池为 bi 池</li>
<li>注意：<ul>
<li>在使用 CDH 动态资源池根据不同的用户组来分配资源的时候，需要在所有机器上面都要创建该用户，因为 Spark 提交到 Yarn 是一个分布式计算程序，不确定是在哪个机器上面执行。 </li>
</ul>
</li>
</ul>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">cdh</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2020/03/10/CDH%20%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E6%B1%A0/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-CDH 5.16.2 部署" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2020/03/07/CDH%205.16.2%20%E9%83%A8%E7%BD%B2/" target="_blank">CDH 5.16.2 部署</a>
  
    </h1>
  


  
  
<a href="/2020/03/07/CDH%205.16.2%20%E9%83%A8%E7%BD%B2/" class="archive-article-date">
        <time datetime="2020-03-07T15:21:27.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-03-07</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="CDH-5-16-2-部署"><a href="#CDH-5-16-2-部署" class="headerlink" title="CDH 5.16.2 部署"></a><center>CDH 5.16.2 部署</center></h2><p><a target="_blank" rel="noopener" href="https://www.cloudera.com/">Cloudera 官网</a></p>
<ul>
<li>本次我们部署环境为 CDH 5.16.2</li>
<li>本次部署使用的是三台 2 核 16 G 机器</li>
</ul>
<h3 id="1-部署的方式"><a href="#1-部署的方式" class="headerlink" title="1. 部署的方式"></a>1. 部署的方式</h3><h4 id="1-1-bin在线部署"><a href="#1-1-bin在线部署" class="headerlink" title="1.1 bin在线部署"></a>1.1 bin在线部署</h4><ul>
<li>优点：通过 shell 脚本一键部署，比较方便。</li>
<li>缺点：需要互联网在线下载安装包，如果网络抖动则不会成功。</li>
</ul>
<h4 id="1-2-rpm-部署"><a href="#1-2-rpm-部署" class="headerlink" title="1.2 rpm 部署"></a>1.2 rpm 部署</h4><ul>
<li>优点：官网推荐的，部署还算比较简单。</li>
<li>缺点：部署 Server、Agent rpm 时候需要网络下载依赖包。</li>
</ul>
<h4 id="1-3-tar-部署"><a href="#1-3-tar-部署" class="headerlink" title="1.3 tar 部署"></a>1.3 tar 部署</h4><ul>
<li>真正的离线部署，本次部署就是采用 tar 部署。</li>
</ul>
<h3 id="2-部署前置条件"><a href="#2-部署前置条件" class="headerlink" title="2. 部署前置条件"></a>2. 部署前置条件</h3><p><a target="_blank" rel="noopener" href="https://docs.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html#cm_cdh_compatibility">CDH 5X 部署的硬件条件</a></p>
<ul>
<li>本次部署采用的是阿里云 Centos 7.2 的操作系统</li>
</ul>
<h3 id="3-部署初始化集群"><a href="#3-部署初始化集群" class="headerlink" title="3. 部署初始化集群"></a>3. 部署初始化集群</h3><ul>
<li>所有的机器都需要执行，把内网 IP 加入到 hosts 文件里面</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# echo &quot;172.22.95.62 bigdata001&quot;&gt;&gt; &#x2F;etc&#x2F;hosts</span><br><span class="line">[root@bigdata001 ~]# echo &quot;172.22.95.63 bigdata002&quot;&gt;&gt; &#x2F;etc&#x2F;hosts</span><br><span class="line">[root@bigdata001 ~]# echo &quot;172.22.95.64 bigdata003&quot;&gt;&gt; &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure>

<ul>
<li>关闭防火墙</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# systemctl stop firewalld</span><br><span class="line">[root@bigdata001 ~]# systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<ul>
<li>关闭 selinux</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# vim &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure>

<ul>
<li>时区同步（如果使用阿里云机器，可以不用做）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# timedatectl set-timezone Asia&#x2F;Shanghai</span><br></pre></td></tr></table></figure>

<ul>
<li>时钟同步（如果使用阿里云机器，可以不用做）</li>
<li>所有机器都需要安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# yum install -y ntp</span><br></pre></td></tr></table></figure>

<ul>
<li>选取第一台机器作为主机器</li>
<li>下面只有第一台机器需要执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# vim &#x2F;etc&#x2F;ntp.conf</span><br><span class="line">#time</span><br><span class="line">server 0.asia.pool.ntp.org</span><br><span class="line">server 1.asia.pool.ntp.org</span><br><span class="line">server 2.asia.pool.ntp.org</span><br><span class="line">server 3.asia.pool.ntp.org</span><br><span class="line">#当外部时间不可⽤时，可使⽤本地硬件时间</span><br><span class="line">server 127.127.1.0 iburst local clock</span><br><span class="line">#允许哪些⽹段的机器来同步时间</span><br><span class="line">restrict 172.22.95.0 mask 255.255.255.0 nomodify notrap</span><br></pre></td></tr></table></figure>

<ul>
<li>第一台机器启动 ntp 服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@bigdata001 ~]# systemctl start ntpd</span><br><span class="line">[root@bigdata001 ~]# systemctl status ntpd</span><br><span class="line">● ntpd.service - Network Time Service</span><br><span class="line">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;ntpd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Wed 2021-02-10 12:15:22 CST; 6min ago</span><br><span class="line"> Main PID: 9479 (ntpd)</span><br><span class="line">   CGroup: &#x2F;system.slice&#x2F;ntpd.service</span><br><span class="line">           └─9479 &#x2F;usr&#x2F;sbin&#x2F;ntpd -u ntp:ntp -g</span><br><span class="line"></span><br><span class="line">Feb 10 12:15:22 bigdata001 systemd[1]: Starting Network Time Service...</span><br><span class="line">Feb 10 12:15:22 bigdata001 ntpd[9479]: proto: precision &#x3D; 0.080 usec</span><br><span class="line">Feb 10 12:15:22 bigdata001 ntpd[9479]: 0.0.0.0 c01d 0d kern kernel time sync enabled</span><br><span class="line">Feb 10 12:15:22 bigdata001 systemd[1]: Started Network Time Service.</span><br><span class="line"></span><br><span class="line">[root@bigdata001 ~]# ntpq -p</span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> LOCAL(0)        .LOCL.          10 l  411   64  100    0.000    0.000   0.000</span><br><span class="line">+120.25.115.20   10.137.53.7      2 u   12   64  177   24.430  1081.30   8.310</span><br><span class="line"> 10.143.33.49    .INIT.          16 u    - 1024    0    0.000    0.000   0.000</span><br><span class="line">+100.100.3.1     10.137.55.181    2 u   43   64  377    1.482  1081.81   6.647</span><br><span class="line">+100.100.3.2     10.137.55.181    2 u   43   64  377    1.332  1081.10   7.352</span><br><span class="line">+100.100.3.3     10.137.55.181    2 u   38   64  377    1.470  1080.94   7.428</span><br><span class="line">+203.107.6.88    10.137.38.86     2 u   38   64  377   16.084  1081.27   6.672</span><br><span class="line"> 10.143.33.50    .INIT.          16 u    - 1024    0    0.000    0.000   0.000</span><br><span class="line"> 10.143.33.51    .INIT.          16 u    - 1024    0    0.000    0.000   0.000</span><br><span class="line"> 10.143.0.44     .INIT.          16 u    - 1024    0    0.000    0.000   0.000</span><br><span class="line"> 10.143.0.45     .INIT.          16 u    - 1024    0    0.000    0.000   0.000</span><br><span class="line"> 10.143.0.46     .INIT.          16 u    - 1024    0    0.000    0.000   0.000</span><br><span class="line">+100.100.5.1     10.137.55.181    2 u   29   64  377    1.545  1081.31   7.467</span><br><span class="line">+100.100.5.2     10.137.55.181    2 u   35   64  377    1.819  1082.29   6.611</span><br><span class="line">*100.100.5.3     10.137.55.181    2 u   30   64  377    1.538  1082.21   6.687</span><br></pre></td></tr></table></figure>

<ul>
<li>其他节点禁用服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata002 ~]# systemctl stop ntpd</span><br><span class="line">[root@bigdata002 ~]# systemctl disable ntpd</span><br><span class="line">Removed symlink &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target.wants&#x2F;ntpd.service.</span><br><span class="line">[root@bigdata002 ~]# ntpdate bigdata001</span><br><span class="line">10 Feb 12:24:33 ntpdate[9517]: step time server 172.22.95.62 offset -0.740151 sec</span><br></pre></td></tr></table></figure>

<ul>
<li>同步服务增加调度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata002 ~]# crontab -e</span><br><span class="line">00 00 * * * ntpdate bigdata</span><br></pre></td></tr></table></figure>

<h3 id="4-部署-JDK"><a href="#4-部署-JDK" class="headerlink" title="4. 部署 JDK"></a>4. 部署 JDK</h3><ul>
<li>上传 JDK 的 tar 包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# mkdir software</span><br><span class="line">[root@bigdata001 ~]# cd software&#x2F;</span><br><span class="line">[root@bigdata001 software]# ll</span><br><span class="line">total 185292</span><br><span class="line">-rw-r--r-- 1 root root 189736377 Oct 20 21:13 jdk-8u151-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">[root@bigdata001 software]# cp jdk-8u151-linux-x64.tar.gz &#x2F;tmp&#x2F;</span><br><span class="line">[root@bigdata001 software]# cd &#x2F;tmp&#x2F;</span><br><span class="line">[root@bigdata001 tmp]# scp jdk-8u151-linux-x64.tar.gz bigdata002:&#x2F;tmp</span><br><span class="line">[root@bigdata001 tmp]# scp jdk-8u151-linux-x64.tar.gz bigdata003:&#x2F;tmp</span><br></pre></td></tr></table></figure>

<ul>
<li>三台都执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# cd &#x2F;tmp&#x2F;</span><br><span class="line">[root@bigdata001 tmp]# mkdir &#x2F;usr&#x2F;java</span><br><span class="line">[root@bigdata001 tmp]# tar -xzvf jdk-8u151-linux-x64.tar.gz -C &#x2F;usr&#x2F;java</span><br><span class="line">[root@bigdata001 tmp]# cd &#x2F;usr&#x2F;java&#x2F;</span><br><span class="line">[root@bigdata001 java]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 8 10 143 4096 Sep  6  2017 jdk1.8.0_151</span><br><span class="line">[root@bigdata001 java]# chown root:root jdk1.8.0_151&#x2F;</span><br><span class="line">[root@bigdata001 java]# chown -R root:root jdk1.8.0_151&#x2F;*</span><br><span class="line">[root@bigdata001 java]# chmod 777 jdk1.8.0_151&#x2F;</span><br><span class="line">[root@bigdata001 java]# chmod -R 777 jdk1.8.0_151&#x2F;*</span><br><span class="line">[root@bigdata001 java]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxrwxrwx 8 root root 4096 Sep  6  2017 jdk1.8.0_151</span><br><span class="line"></span><br><span class="line">[root@bigdata001 java]# cd ~</span><br><span class="line">[root@bigdata001 ~]# vim .bashrc </span><br><span class="line"></span><br><span class="line">#### add env</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_151</span><br><span class="line">export PATH&#x3D;$&#123;JAVA_HOME&#125;&#x2F;bin:$&#123;PATH&#125;</span><br><span class="line"></span><br><span class="line">[root@bigdata001 ~]# source .bashrc </span><br><span class="line">[root@bigdata001 ~]# which java</span><br><span class="line">&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_151&#x2F;bin&#x2F;java</span><br></pre></td></tr></table></figure>

<h3 id="5-部署-Mysql"><a href="#5-部署-Mysql" class="headerlink" title="5. 部署 Mysql"></a>5. 部署 Mysql</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/5.7.html">Mysql 下载路径</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# cd software&#x2F;</span><br><span class="line">[root@bigdata001 software]# cp mysql-5.7.31-linux-glibc2.12-x86_64.tar.gz &#x2F;usr&#x2F;local</span><br><span class="line">[root@bigdata001 software]# cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">[root@bigdata001 local]# tar -xzvf mysql-5.7.31-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>创建mysql用户，并修改Mysql文件权限</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 local]# useradd mysql</span><br><span class="line">[root@bigdata001 local]#  id mysql</span><br><span class="line">uid&#x3D;1000(mysql) gid&#x3D;1000(mysql) groups&#x3D;1000(mysql)</span><br><span class="line">[root@bigdata001 local]# chown mysql:mysql mysql-5.7.31-linux-glibc2.12-x86_64</span><br><span class="line">[root@bigdata001 local]# chown -R mysql:mysql mysql-5.7.31-linux-glibc2.12-x86_64&#x2F;*</span><br><span class="line">[root@bigdata001 local]# ln -s &#x2F;usr&#x2F;local&#x2F;mysql-5.7.28-linux-glibc2.12-x86_64 mysql</span><br></pre></td></tr></table></figure>

<ul>
<li>修改 Mysql 配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 local]# cat &#x2F;dev&#x2F;null &gt;&#x2F;etc&#x2F;my.cnf</span><br><span class="line">[root@bigdata001 local]# vim &#x2F;etc&#x2F;my.cnf</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port&#x3D;3306</span><br><span class="line">socket&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line">[mysqld]</span><br><span class="line">port&#x3D;3306</span><br><span class="line">socket&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br><span class="line">character-set-server&#x3D;utf8 </span><br><span class="line"></span><br><span class="line">skip-external-locking</span><br><span class="line">key_buffer_size&#x3D;256M</span><br><span class="line">sort_buffer_size&#x3D;2M</span><br><span class="line">read_buffer_size&#x3D;2M</span><br><span class="line">read_rnd_buffer_size&#x3D;4M</span><br><span class="line">query_cache_size&#x3D;32M</span><br><span class="line">max_allowed_packet&#x3D;16M</span><br><span class="line">myisam_sort_buffer_size&#x3D;128M</span><br><span class="line">tmp_table_size&#x3D;32M</span><br><span class="line"></span><br><span class="line">table_open_cache&#x3D;512</span><br><span class="line">thread_cache_size&#x3D;8</span><br><span class="line">wait_timeout&#x3D;86400</span><br><span class="line">interactive_timeout&#x3D;86400</span><br><span class="line">max_connections&#x3D;600</span><br><span class="line"></span><br><span class="line"># Try number of CPU&#39;s*2 for thread_concurrency</span><br><span class="line"># thread_concurrency&#x3D;32</span><br><span class="line"></span><br><span class="line">#isolation level and default engine </span><br><span class="line">default-storage-engine&#x3D;INNODB</span><br><span class="line">transaction-isolation&#x3D;READ-COMMITTED</span><br><span class="line"></span><br><span class="line">server-id&#x3D;1</span><br><span class="line">basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data</span><br><span class="line">pid-file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;hostname.pid</span><br><span class="line"></span><br><span class="line">#open performance schema</span><br><span class="line">log-warnings</span><br><span class="line">sysdate-is-now</span><br><span class="line"></span><br><span class="line">binlog_format&#x3D;MIXED</span><br><span class="line">log_bin_trust_function_creators&#x3D;1</span><br><span class="line">log-error&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;hostname.err</span><br><span class="line">log-bin&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;arch&#x2F;mysql-bin</span><br><span class="line">#other logs</span><br><span class="line">#general_log &#x3D;1</span><br><span class="line">#general_log_file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;general_log.err</span><br><span class="line">#slow_query_log&#x3D;1</span><br><span class="line">#slow_query_log_file&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;slow_log.err</span><br><span class="line"></span><br><span class="line">#for replication slave</span><br><span class="line">#log-slave-updates </span><br><span class="line">#sync_binlog &#x3D; 1</span><br><span class="line"></span><br><span class="line">#for innodb options </span><br><span class="line">innodb_data_home_dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;</span><br><span class="line">innodb_data_file_path&#x3D;ibdata1:500M:autoextend</span><br><span class="line">innodb_log_group_home_dir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;arch</span><br><span class="line">innodb_log_files_in_group&#x3D;2</span><br><span class="line">innodb_log_file_size&#x3D;200M</span><br><span class="line"></span><br><span class="line">innodb_buffer_pool_size&#x3D;1024M</span><br><span class="line"># innodb_additional_mem_pool_size&#x3D;50M</span><br><span class="line">innodb_log_buffer_size&#x3D;16M</span><br><span class="line"></span><br><span class="line">innodb_lock_wait_timeout &#x3D; 100</span><br><span class="line">#innodb_thread_concurrency &#x3D; 0</span><br><span class="line">innodb_flush_log_at_trx_commit &#x3D; 1</span><br><span class="line">innodb_locks_unsafe_for_binlog&#x3D;1</span><br><span class="line"></span><br><span class="line">#innodb io features: add for mysql5.5.8</span><br><span class="line">performance_schema</span><br><span class="line">innodb_read_io_threads&#x3D;4</span><br><span class="line">innodb-write-io-threads&#x3D;4</span><br><span class="line">innodb-io-capacity&#x3D;200</span><br><span class="line">#purge threads change default(0) to 1 for purge</span><br><span class="line">innodb_purge_threads&#x3D;1</span><br><span class="line">innodb_use_native_aio&#x3D;on</span><br><span class="line"></span><br><span class="line">#case-sensitive file names and separate tablespace</span><br><span class="line">innodb_file_per_table&#x3D;1</span><br><span class="line">lower_case_table_names&#x3D;1</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet&#x3D;16M</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size&#x3D;256M</span><br><span class="line">sort_buffer_size&#x3D;256M</span><br><span class="line">read_buffer&#x3D;2M</span><br><span class="line">write_buffer&#x3D;2M</span><br><span class="line"></span><br><span class="line">[root@bigdata001 local]# chown mysql:mysql &#x2F;etc&#x2F;my.cnf</span><br><span class="line">[root@bigdata001 local]# chmod 640 &#x2F;etc&#x2F;my.cnf</span><br><span class="line">[root@bigdata001 local]#  ll &#x2F;etc&#x2F;my.cnf</span><br><span class="line">-rw-r----- 1 mysql mysql 2169 Oct 23 14:33 &#x2F;etc&#x2F;my.cnf</span><br></pre></td></tr></table></figure>

<ul>
<li>初始化 Mysql</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 local]# yum -y install libaio</span><br><span class="line">[root@bigdata001 local]# cd mysql</span><br><span class="line">[root@bigdata001 mysql]# ll</span><br><span class="line">total 304</span><br><span class="line">drwxr-xr-x  2 mysql mysql   4096 Jun  2  2020 bin</span><br><span class="line">drwxr-xr-x  2 mysql mysql   4096 Jun  2  2020 docs</span><br><span class="line">drwxr-xr-x  3 mysql mysql   4096 Jun  2  2020 include</span><br><span class="line">drwxr-xr-x  5 mysql mysql   4096 Jun  2  2020 lib</span><br><span class="line">-rw-r--r--  1 mysql mysql 275393 Jun  2  2020 LICENSE</span><br><span class="line">drwxr-xr-x  4 mysql mysql   4096 Jun  2  2020 man</span><br><span class="line">-rw-r--r--  1 mysql mysql    587 Jun  2  2020 README</span><br><span class="line">drwxr-xr-x 28 mysql mysql   4096 Jun  2  2020 share</span><br><span class="line">drwxr-xr-x  2 mysql mysql   4096 Jun  2  2020 support-files</span><br><span class="line">[root@bigdata001 mysql]# su mysql</span><br><span class="line">[mysql@bigdata001 mysql]$ mkdir data tmp arch</span><br><span class="line"></span><br><span class="line">[mysql@bigdata001 mysql]$ exit</span><br><span class="line">exit</span><br><span class="line">[root@bigdata001 mysql]# &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld --user&#x3D;mysql --basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F; --datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data --initialize</span><br><span class="line"></span><br><span class="line">[root@bigdata001 mysql]# cd data&#x2F;</span><br><span class="line">[root@bigdata001 data]# ll</span><br><span class="line">total 512068</span><br><span class="line">-rw-r----- 1 mysql mysql        56 Feb 10 13:26 auto.cnf</span><br><span class="line">-rw------- 1 mysql mysql      1680 Feb 10 13:26 ca-key.pem</span><br><span class="line">-rw-r--r-- 1 mysql mysql      1112 Feb 10 13:26 ca.pem</span><br><span class="line">-rw-r--r-- 1 mysql mysql      1112 Feb 10 13:26 client-cert.pem</span><br><span class="line">-rw------- 1 mysql mysql      1680 Feb 10 13:26 client-key.pem</span><br><span class="line">-rw-r----- 1 mysql mysql      7066 Feb 10 13:26 hostname.err</span><br><span class="line">-rw-r----- 1 mysql mysql       428 Feb 10 13:26 ib_buffer_pool</span><br><span class="line">-rw-r----- 1 mysql mysql 524288000 Feb 10 13:26 ibdata1</span><br><span class="line">drwxr-x--- 2 mysql mysql      4096 Feb 10 13:26 mysql</span><br><span class="line">drwxr-x--- 2 mysql mysql      4096 Feb 10 13:26 performance_schema</span><br><span class="line">-rw------- 1 mysql mysql      1676 Feb 10 13:26 private_key.pem</span><br><span class="line">-rw-r--r-- 1 mysql mysql       452 Feb 10 13:26 public_key.pem</span><br><span class="line">-rw-r--r-- 1 mysql mysql      1112 Feb 10 13:26 server-cert.pem</span><br><span class="line">-rw------- 1 mysql mysql      1676 Feb 10 13:26 server-key.pem</span><br><span class="line">drwxr-x--- 2 mysql mysql     12288 Feb 10 13:26 sys</span><br><span class="line">[root@bigdata001 data]# cat hostname.err |grep password </span><br><span class="line">2021-02-10T05:26:10.084026Z 1 [Note] A temporary password is generated for root@localhost: 46uadmwCoA&lt;u</span><br></pre></td></tr></table></figure>

<ul>
<li>部署开机自启动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 data]#  cd &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">[root@bigdata001 mysql]# cp support-files&#x2F;mysql.server &#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;mysql </span><br><span class="line">[root@bigdata001 mysql]# chmod +x &#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;mysql</span><br><span class="line">[root@bigdata001 mysql]# chkconfig --del mysql</span><br><span class="line">[root@bigdata001 mysql]# chkconfig --add mysql</span><br><span class="line">[root@bigdata001 mysql]# chkconfig --level 345 mysql on</span><br></pre></td></tr></table></figure>

<ul>
<li>登录 Mysql 并修改密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 mysql]#  su - mysql</span><br><span class="line">Last login: Wed Feb 10 13:28:49 CST 2021 on pts&#x2F;0</span><br><span class="line">[mysql@bigdata001 ~]$ cd &#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">[mysql@bigdata001 mysql]$ bin&#x2F;mysqld_safe &amp;</span><br><span class="line">[mysql@bigdata001 mysql]$ bin&#x2F;mysql -uroot -p&#39;46uadmwCoA&lt;u&#39;</span><br><span class="line"></span><br><span class="line">mysql&gt; alter user root@localhost identified by &#39;123456&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;ruozedata&#39; ;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<ul>
<li>Mysql 创建 CDH 部署需要的库以及用户</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database cmf default character set utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges  on cmf.* to cmf@&#39;%&#39; identified by &#39;123456&#39;;</span><br><span class="line">ult character set utf8;</span><br><span class="line">grant all privileges  on hive.* to hive@&#39;%&#39; identified by &#39;123456&#39;;</span><br><span class="line">flush privileges;Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create database amon default character set utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges  on amon.* to amon@&#39;%&#39; identified by &#39;123456&#39;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create database hive default character set utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges  on hive.* to hive@&#39;%&#39; identified by &#39;123456&#39;;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>把 Mysql 依赖的 JAR 放到固定的路径下</li>
<li>第一个主机先上传 Mysql jar 并执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# cd software&#x2F;</span><br><span class="line">[root@bigdata001 software]# cp mysql-connector-java-5.1.47.jar &#x2F;tmp&#x2F;</span><br><span class="line">[root@bigdata001 software]# cd &#x2F;tmp&#x2F;</span><br><span class="line">[root@bigdata001 tmp]# scp mysql-connector-java-5.1.47.jar bigdata002:&#x2F;tmp</span><br><span class="line">[root@bigdata001 tmp]# scp mysql-connector-java-5.1.47.jar bigdata003:&#x2F;tmp</span><br></pre></td></tr></table></figure>

<ul>
<li>所有的机器都需要执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# cd &#x2F;tmp&#x2F;</span><br><span class="line">[root@bigdata001 tmp]# mkdir -p &#x2F;usr&#x2F;share&#x2F;java&#x2F;</span><br><span class="line">[root@bigdata001 tmp]# mv mysql-connector-java-5.1.47.jar mysql-connector-java.jar</span><br><span class="line">[root@bigdata001 tmp]# mv mysql-connector-java.jar &#x2F;usr&#x2F;share&#x2F;java&#x2F;</span><br></pre></td></tr></table></figure>

<h3 id="6-部署-Cloudera-Manager"><a href="#6-部署-Cloudera-Manager" class="headerlink" title="6. 部署 Cloudera Manager"></a>6. 部署 Cloudera Manager</h3><ul>
<li>需要下载的文件</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.16.2_x86_64.tar.gz">Cloudera Manager tar包</a></p>
<p><a target="_blank" rel="noopener" href="https://archive.cloudera.com/cdh5/parcels/5.16.2/CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel">Parcel 文件</a></p>
<p><a target="_blank" rel="noopener" href="https://archive.cloudera.com/cdh5/parcels/5.16.2/CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel.sha1">Parcel sha1</a></p>
<p><a target="_blank" rel="noopener" href="https://archive.cloudera.com/cdh5/parcels/5.16.2/manifest.json">manifest</a></p>
<h4 id="6-1-部署-Cloudera-Manager-前置条件"><a href="#6-1-部署-Cloudera-Manager-前置条件" class="headerlink" title="6.1 部署 Cloudera Manager 前置条件"></a>6.1 部署 Cloudera Manager 前置条件</h4><ul>
<li>先把文件上传到第一台机器上面，并通过第一台机器把文件传输到几台机器上面。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 ~]# cd software&#x2F;</span><br><span class="line">[root@bigdata001 software]# cp cloudera-manager-centos7-cm5.16.2_x86_64.tar.gz &#x2F;tmp</span><br><span class="line">[root@bigdata001 software]# cd &#x2F;tmp&#x2F;</span><br><span class="line">[root@bigdata001 tmp]# scp cloudera-manager-centos7-cm5.16.2_x86_64.tar.gz bigdata002:&#x2F;tmp</span><br><span class="line">[root@bigdata001 tmp]# scp cloudera-manager-centos7-cm5.16.2_x86_64.tar.gz bigdata003:&#x2F;tmp</span><br></pre></td></tr></table></figure>

<ul>
<li>后面操作所有的机器，解压 Cloudera Manager</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 tmp]# mkdir &#x2F;opt&#x2F;cloudera-manager</span><br><span class="line">[root@bigdata001 tmp]# tar -xzvf cloudera-manager-centos7-cm5.16.2_x86_64.tar.gz -C &#x2F;opt&#x2F;cloudera-manager&#x2F;</span><br><span class="line">[root@bigdata001 tmp]# cd &#x2F;opt&#x2F;cloudera-manager&#x2F;</span><br><span class="line">[root@bigdata001 cloudera-manager]# ll</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x 4 1106 4001 4096 May 18  2019 cloudera</span><br><span class="line">drwxr-xr-x 9 1106 4001 4096 May 18  2019 cm-5.16.2</span><br><span class="line"></span><br><span class="line">[root@bigdata001 cloudera-manager]# cd cm-5.16.2&#x2F;etc&#x2F;cloudera-scm-agent&#x2F;</span><br><span class="line">[root@bigdata001 cloudera-scm-agent]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 1106 4001 8905 May 18  2019 config.ini</span><br><span class="line">[root@bigdata001 cloudera-scm-agent]# vim config.ini</span><br><span class="line"></span><br><span class="line">server_host&#x3D;bigdata001</span><br></pre></td></tr></table></figure>

<ul>
<li>由于我选举第一台机器作为 CM Server，所以下面需要操作第一台机器，指定 CM 的 Mysql 路径</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera-scm-agent]# cd ..&#x2F;cloudera-scm-server&#x2F;</span><br><span class="line">[root@bigdata001 cloudera-scm-server]# ll</span><br><span class="line">total 8</span><br><span class="line">-rw------- 1 1106 4001  714 May 18  2019 db.properties</span><br><span class="line">-rw-r--r-- 1 1106 4001 2229 May 18  2019 log4j.properties</span><br><span class="line">[root@bigdata001 cloudera-scm-server]# vim db.properties </span><br><span class="line"></span><br><span class="line">com.cloudera.cmf.db.type&#x3D;mysql</span><br><span class="line">com.cloudera.cmf.db.host&#x3D;bigdata001</span><br><span class="line">com.cloudera.cmf.db.name&#x3D;cmf</span><br><span class="line">com.cloudera.cmf.db.user&#x3D;cmf</span><br><span class="line">com.cloudera.cmf.db.password&#x3D;123456</span><br><span class="line">com.cloudera.cmf.db.setupType&#x3D;EXTERNAL</span><br></pre></td></tr></table></figure>

<ul>
<li>所有节点创建⽤户</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera-scm-server]# useradd --system --home&#x3D;&#x2F;opt&#x2F;cloudera-manager&#x2F;cm-5.16.1&#x2F;run&#x2F;cloudera-scm-server&#x2F; --no-create-home --shell&#x3D;&#x2F;bin&#x2F;false --comment &quot;Cloudera SCM User&quot; cloudera-scm</span><br><span class="line">[root@bigdata001 cloudera-scm-server]# chown -R cloudera-scm:cloudera-scm &#x2F;opt&#x2F;cloudera-manager</span><br></pre></td></tr></table></figure>

<ul>
<li>选取一台机器作为 Parcel 源，并部署，我选取的是第一台作为 Parcel 源</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera-scm-server]# mkdir -p &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo</span><br><span class="line">[root@bigdata001 cloudera-scm-server]# cd ~&#x2F;software&#x2F;</span><br><span class="line">[root@bigdata001 software]# mv CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo&#x2F;</span><br><span class="line">[root@bigdata001 software]# mv CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel.sha1 &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo</span><br><span class="line">[root@bigdata001 software]# mv manifest.json &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo&#x2F;</span><br><span class="line">[root@bigdata001 software]# cd &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo</span><br><span class="line">[root@bigdata001 parcel-repo]# mv CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel.sha1 CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel.sha</span><br><span class="line">[root@bigdata001 parcel-repo]# ll</span><br><span class="line">total 2082872</span><br><span class="line">-rw-r--r-- 1 root root 2132782197 Oct 20 21:16 CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel</span><br><span class="line">-rw-r--r-- 1 root root         41 Feb  9 21:37 CDH-5.16.2-1.cdh5.16.2.p0.8-el7.parcel.sha</span><br><span class="line">-rw-r--r-- 1 root root      66804 Oct 20 21:12 manifest.json</span><br></pre></td></tr></table></figure>

<h4 id="6-2-部署-Cloudera-Manager"><a href="#6-2-部署-Cloudera-Manager" class="headerlink" title="6.2 部署 Cloudera Manager"></a>6.2 部署 Cloudera Manager</h4><ul>
<li>创建所有节点的软件安装目录 用户和用户组的权限</li>
<li>所有机器都需要执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera]# mkdir -p &#x2F;opt&#x2F;cloudera&#x2F;parcels</span><br><span class="line">[root@bigdata001 cloudera]# chown -R cloudera-scm:cloudera-scm &#x2F;opt&#x2F;cloudera</span><br></pre></td></tr></table></figure>

<ul>
<li>启动 Cloudera Manager Server</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera]# &#x2F;opt&#x2F;cloudera-manager&#x2F;cm-5.16.2&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-server start</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 Log</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera-scm-server]# cd &#x2F;opt&#x2F;cloudera-manager&#x2F;cm-5.16.2&#x2F;log&#x2F;cloudera-scm-server&#x2F;</span><br><span class="line">[root@bigdata001 cloudera-scm-server]# tail -200f cloudera-scm-server.log</span><br></pre></td></tr></table></figure>

<ul>
<li>启动所有的 Cloudera Manager Agent</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera]# &#x2F;opt&#x2F;cloudera-manager&#x2F;cm-5.16.2&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-agent start</span><br></pre></td></tr></table></figure>


<ul>
<li>打开阿里云的防火墙</li>
<li>打开 WEB 页面 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bigdata001:7180&#x2F;cmf&#x2F;login</span><br><span class="line">用户：admin</span><br><span class="line">密码：admin</span><br></pre></td></tr></table></figure>

<p><img src="/img/cdh/1.png" alt="1"></p>
<p><img src="/img/cdh/2.png" alt="2"></p>
<p><img src="/img/cdh/3.png" alt="3"></p>
<p><img src="/img/cdh/4.png" alt="4"></p>
<p><img src="/img/cdh/5.png" alt="5"></p>
<p><img src="/img/cdh/6.png" alt="6"></p>
<p><img src="/img/cdh/7.png" alt="7"></p>
<ul>
<li>所有机器执行下面命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdata001 cloudera-scm-server]# echo never &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defrag</span><br><span class="line">[root@bigdata001 cloudera-scm-server]# echo never &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled</span><br></pre></td></tr></table></figure>

<ul>
<li>刷新下检查 </li>
</ul>
<p><img src="/img/cdh/8.png" alt="8"></p>
<p><img src="/img/cdh/9.png" alt="9"></p>
<p><img src="/img/cdh/10.png" alt="10"></p>
<p><img src="/img/cdh/11.png" alt="11"></p>
<p><img src="/img/cdh/12.png" alt="12"></p>
<p><img src="/img/cdh/13.png" alt="13"></p>
<p><img src="/img/cdh/14.png" alt="14"></p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">cdh</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2020/03/07/CDH%205.16.2%20%E9%83%A8%E7%BD%B2/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Phoenix 二级索引" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2020/02/05/Phoenix%20%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95/" target="_blank">Phoenix 二级索引</a>
  
    </h1>
  


  
  
<a href="/2020/02/05/Phoenix%20%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95/" class="archive-article-date">
        <time datetime="2020-02-05T14:50:29.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-02-05</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="Phoenix-二级索引"><a href="#Phoenix-二级索引" class="headerlink" title="Phoenix 二级索引"></a><center>Phoenix 二级索引</center></h2><h3 id="1-什么是-Phoenix-的二级索引"><a href="#1-什么是-Phoenix-的二级索引" class="headerlink" title="1. 什么是 Phoenix 的二级索引"></a>1. 什么是 Phoenix 的二级索引</h3><ul>
<li>二级索引是从主键访问数据的正交方式。Hbase中有一个按照字典排序的主键Rowkey作为单一的索引。不按照Rowkey去读取记录都要遍历整张表，然后按照你指定的过滤条件过滤。通过二级索引，索引的列或表达式形成一个备用行键，以允许沿着这个新轴进行点查找和范围扫描。</li>
</ul>
<h3 id="2-Phoenix-中的盐表"><a href="#2-Phoenix-中的盐表" class="headerlink" title="2. Phoenix 中的盐表"></a>2. Phoenix 中的盐表</h3><p><a target="_blank" rel="noopener" href="http://phoenix.apache.org/salted.html">Phoenix 中的盐表</a></p>
<ul>
<li>其本质就是类似于 HBase RowKey 盐表一样，Phoenix 通过指定主键以及 salt_buckets ，会把主键前面加上一个 salt_buckets 以内的随机数，来使 数据分散插入不同的 Region 中。</li>
<li>优点：<ul>
<li> 由于本质是随机数，有助于数据均匀的落在每个 Region 中，从而提高写的性能。</li>
</ul>
</li>
<li>缺点：<ul>
<li>数据查询的顺序和插入的顺序不一致。</li>
<li>当数据量比较小的时候，使用盐表插入，查询性能特别低。</li>
</ul>
</li>
<li>建议：<ul>
<li>salt_buckets 数量和 Region Server 数量一致。</li>
<li>如果一开始有三台 Region Server 设置的 salt_buckets 为3，后面增加两台，Phoenix 无法修改已经创建表的 salt_buckets 的数量，需要重新建表 + 导数。</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; create table bigdata.salt </span><br><span class="line">. . . . . . . . . . . . . . &gt; (id integer primary key, </span><br><span class="line">. . . . . . . . . . . . . . &gt; name varchar,</span><br><span class="line">. . . . . . . . . . . . . . &gt; age integer,</span><br><span class="line">. . . . . . . . . . . . . . &gt; address varchar) </span><br><span class="line">. . . . . . . . . . . . . . &gt; salt_buckets &#x3D; 20;</span><br><span class="line">No rows affected (4.409 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase 中的表结构</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):002:0&gt; describe &#39;BIGDATA:SALT&#39;</span><br><span class="line">Table BIGDATA:SALT is ENABLED</span><br><span class="line"></span><br><span class="line">BIGDATA:SALT, &#123;TABLE_ATTRIBUTES &#x3D;&gt; &#123;coprocessor$1 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.ScanRegionObserver|805306366|&#39;, coprocessor$2 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.UngroupedAggregateRegionObserver|805306366|&#39;, coprocessor$3 &#x3D;&gt; &#39;|org.apac</span><br><span class="line">he.phoenix.coprocessor.GroupedAggregateRegionObserver|805306366|&#39;, coprocessor$4 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.ServerCachingEndpointImpl|805306366|&#39;, coprocessor$5 &#x3D;&gt; &#39;|org.apache.phoenix.hbase.index.Indexer|805306366|org.apache.hadoop</span><br><span class="line">.hbase.index.codec.class&#x3D;org.apache.phoenix.index.PhoenixIndexCodec,index.builder&#x3D;org.apache.phoenix.index.PhoenixIndexBuilder&#39;&#125;</span><br><span class="line"></span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line"></span><br><span class="line">&#123;NAME &#x3D;&gt; &#39;0&#39;, BLOOMFILTER &#x3D;&gt; &#39;NONE&#39;, VERSIONS &#x3D;&gt; &#39;1&#39;, IN_MEMORY &#x3D;&gt; &#39;false&#39;, KEEP_DELETED_CELLS &#x3D;&gt; &#39;FALSE&#39;, DATA_BLOCK_ENCODING &#x3D;&gt; &#39;FAST_DIFF&#39;, TTL &#x3D;&gt; &#39;FOREVER&#39;, COMPRESSION &#x3D;&gt; &#39;NONE&#39;, MIN_VERSIONS &#x3D;&gt; &#39;0&#39;, BLOCKCACHE &#x3D;&gt; &#39;true&#39;, BLOCKSIZE &#x3D;&gt; &#39;</span><br><span class="line">65536&#39;, REPLICATION_SCOPE &#x3D;&gt; &#39;0&#39;&#125;</span><br><span class="line"></span><br><span class="line">1 row(s) in 0.0760 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase Master WEB 页面 <ul>
<li>BIGDATA:SALT 表中 Region Count 为 20 </li>
</ul>
</li>
<li>插入数据看下数据是否均匀分布</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.salt  values (1,&#39;hadoop1&#39;,18,&#39;北京&#39;);</span><br><span class="line">1 row affected (0.036 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.salt  values (2,&#39;hadoop2&#39;,19,&#39;上海&#39;);</span><br><span class="line">1 row affected (0.012 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.salt  values (3,&#39;hadoop3&#39;,17,&#39;杭州&#39;);</span><br><span class="line">1 row affected (0.011 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.salt  values (4,&#39;hadoop4&#39;,12,&#39;深圳&#39;);</span><br><span class="line">1 row affected (0.026 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 WEB 发现数据均匀的分布在不同的 Region 上面</li>
</ul>
<p><img src="/img/phoenix/Salt-Region.png" alt="Salt-Region"></p>
<h3 id="3-Phoenix-二级索引"><a href="#3-Phoenix-二级索引" class="headerlink" title="3. Phoenix 二级索引"></a>3. Phoenix 二级索引</h3><p><a target="_blank" rel="noopener" href="http://phoenix.apache.org/secondary_indexing.html">二级索引（官网）</a></p>
<h4 id="3-1-全局索引"><a href="#3-1-全局索引" class="headerlink" title="3.1 全局索引"></a>3.1 全局索引</h4><ul>
<li>特点：==重写读取==</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Global Indexes</span><br><span class="line">Global indexing targets read heavy uses cases. With global indexes, all the performance penalties for indexes occur at write time. We intercept the data table updates on write (DELETE, UPSERT VALUES and UPSERT SELECT), build the index update and then sent any necessary updates to all interested index tables. At read time, Phoenix will select the index table to use that will produce the fastest query time and directly scan it just like any other HBase table. An index will not be used for a query that references a column that isn’t part of the index.</span><br></pre></td></tr></table></figure>

<ul>
<li>全局索引适合那些读多写少的场景。如果使用全局索引，读数据基本不损耗性能，所有的性能损耗都来源于写数据。数据表的添加、删除和修改都会更新相关的索引表（数据删除了，索引表中的数据也会删除；数据增加了，索引表的数据也会增加）。而查询数据的时候，Phoenix会通过索引表来快速低损耗的获取数据。默认情况下，如果你的查询语句中没有索引相关的列的时候，Phoenix不会使用索引。</li>
<li>全局索引其本质是一个索引表，是把在创建索引时使用的索引字段，作为索引表的联合主键来创建一张表的，索引表存储在 HBase 中，索引表的联合主键作为 HBase 中存储的 RowKey ，由于 HBase 的底层存储的特性，所以索引的失效应该是由左往右，例如，如果索引的第一个字段不在本次查询的 Where 条件中，则会扫描整个索引表。</li>
<li>优点：<ul>
<li>读取性能高，先通过查询索引表中的数据，找到对应查询表的主键，以此通过主键来查询到原表。</li>
</ul>
</li>
<li>缺点：<ul>
<li>数据在进行写入、更新、删除的时候都会操作索引表，以此增加这些操作的消耗。</li>
</ul>
</li>
<li>创建表以及插入数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; create table bigdata.global_index</span><br><span class="line">. . . . . . . . . . . . . . &gt; (id integer primary key, </span><br><span class="line">. . . . . . . . . . . . . . &gt; name varchar,</span><br><span class="line">. . . . . . . . . . . . . . &gt; age integer,</span><br><span class="line">. . . . . . . . . . . . . . &gt; address varchar) </span><br><span class="line">. . . . . . . . . . . . . . &gt; salt_buckets &#x3D; 20;</span><br><span class="line">No rows affected (4.344 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.global_index  values (1,&#39;hadoop1&#39;,18,&#39;北京&#39;);</span><br><span class="line">1 row affected (0.007 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.global_index  values (2,&#39;hadoop2&#39;,19,&#39;上海&#39;);</span><br><span class="line">1 row affected (0.006 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.global_index  values (3,&#39;hadoop3&#39;,17,&#39;杭州&#39;);</span><br><span class="line">1 row affected (0.006 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.global_index  values (4,&#39;hadoop4&#39;,12,&#39;深圳&#39;);</span><br><span class="line">1 row affected (0.004 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>创建索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; CREATE  INDEX global_index_idx ON  bigdata.global_index(name,age);</span><br><span class="line">4 rows affected (9.312 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase 中的 索引表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):003:0&gt; list</span><br><span class="line">TABLE</span><br><span class="line"></span><br><span class="line">BIGDATA:GLOBAL_INDEX</span><br><span class="line"></span><br><span class="line">BIGDATA:GLOBAL_INDEX_IDX</span><br><span class="line"></span><br><span class="line">BIGDATA:SALT</span><br><span class="line"></span><br><span class="line">SYSTEM:CATALOG</span><br><span class="line"></span><br><span class="line">SYSTEM:FUNCTION</span><br><span class="line"></span><br><span class="line">SYSTEM:LOG</span><br><span class="line"></span><br><span class="line">SYSTEM:MUTEX</span><br><span class="line"></span><br><span class="line">SYSTEM:SEQUENCE</span><br><span class="line"></span><br><span class="line">SYSTEM:STATS</span><br><span class="line"></span><br><span class="line">9 row(s) in 0.0110 seconds</span><br><span class="line"></span><br><span class="line">&#x3D;&gt; [&quot;BIGDATA:GLOBAL_INDEX&quot;, &quot;BIGDATA:GLOBAL_INDEX_IDX&quot;, &quot;BIGDATA:SALT&quot;, &quot;SYSTEM:CATALOG&quot;, &quot;SYSTEM:FUNCTION&quot;, &quot;SYSTEM:LOG&quot;, &quot;SYSTEM:MUTEX&quot;, &quot;SYSTEM:SEQUENCE&quot;, &quot;SYSTEM:STATS&quot;]</span><br><span class="line">hbase(main):004:0&gt; scan &#39;BIGDATA:GLOBAL_INDEX_IDX&#39;</span><br><span class="line">ROW                                                           COLUMN+CELL</span><br><span class="line"></span><br><span class="line"> \x01hadoop2\x00\xC1\x14\x00\x80\x00\x00\x02                  column&#x3D;0:\x00\x00\x00\x00, timestamp&#x3D;1612843905504, value&#x3D;x                                                                                                                        </span><br><span class="line"> \x05hadoop3\x00\xC1\x12\x00\x80\x00\x00\x03                  column&#x3D;0:\x00\x00\x00\x00, timestamp&#x3D;1612843905505, value&#x3D;x                                                                                                                        </span><br><span class="line"> \x0Ahadoop1\x00\xC1\x13\x00\x80\x00\x00\x01                  column&#x3D;0:\x00\x00\x00\x00, timestamp&#x3D;1612843905511, value&#x3D;x                                                                                                                        </span><br><span class="line"> \x0Ehadoop4\x00\xC1\x0D\x00\x80\x00\x00\x04                  column&#x3D;0:\x00\x00\x00\x00, timestamp&#x3D;1612843905512, value&#x3D;x                                                                                                                        </span><br><span class="line">4 row(s) in 0.1330 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>通过 Phoenix 查询索引表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; !tables</span><br><span class="line">+------------+--------------+-------------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------+</span><br><span class="line">| TABLE_CAT  | TABLE_SCHEM  |    TABLE_NAME     |  TABLE_TYPE   | REMARKS  | TYPE_NAME  | SELF_REFERENCING_COL_NAME  | REF_GENERATION  | INDEX_STATE  | IMMUTABLE_ROWS  | SALT_BUCKETS  | MULTI_TENANT  | VIEW_STATEMENT  | VIEW_TYPE  | INDEX_ |</span><br><span class="line">+------------+--------------+-------------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------+</span><br><span class="line">|            | BIGDATA      | GLOBAL_INDEX_IDX  | INDEX         |          |            |                            |                 | ACTIVE       | false           | 20            | false         |                 |            | GLOBAL |</span><br><span class="line">|            | SYSTEM       | CATALOG           | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | FUNCTION          | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | LOG               | SYSTEM TABLE  |          |            |                            |                 |              | true            | 32            | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | SEQUENCE          | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | STATS             | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | BIGDATA      | GLOBAL_INDEX      | TABLE         |          |            |                            |                 |              | false           | 20            | false         |                 |            |        |</span><br><span class="line">|            | BIGDATA      | SALT              | TABLE         |          |            |                            |                 |              | false           | 20            | false         |                 |            |        |</span><br><span class="line">+------------+--------------+-------------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------+</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; select * from BIGDATA.GLOBAL_INDEX_IDX</span><br><span class="line">. . . . . . . . . . . . . . &gt; ;</span><br><span class="line">+----------+--------+------+</span><br><span class="line">|  0:NAME  | 0:AGE  | :ID  |</span><br><span class="line">+----------+--------+------+</span><br><span class="line">| hadoop2  | 19     | 2    |</span><br><span class="line">| hadoop3  | 17     | 3    |</span><br><span class="line">| hadoop1  | 18     | 1    |</span><br><span class="line">| hadoop4  | 12     | 4    |</span><br><span class="line">+----------+--------+------+</span><br><span class="line">4 rows selected (0.089 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看查询全表的执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select * from bigdata.global_index;</span><br><span class="line">+----------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                       PLAN                                       | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+----------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN FULL SCAN OVER BIGDATA:GLOBAL_INDEX  | null            | null           | null         |</span><br><span class="line">+----------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看出扫描的是 GLOBAL_INDEX（索引表） ，并且是 FULL SCAN（全表扫描）</li>
<li>查看 Where 条件中 带有第一个索引字段的执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select * from bigdata.global_index where name &#x3D; &#39;hadoop1&#39;;</span><br><span class="line">+----------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                       PLAN                                       | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+----------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN FULL SCAN OVER BIGDATA:GLOBAL_INDEX  | null            | null           | null         |</span><br><span class="line">|     SERVER FILTER BY NAME &#x3D; &#39;hadoop1&#39;                                            | null            | null           | null         |</span><br><span class="line">+----------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">2 rows selected (0.03 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看出先 FULL SCAN 索引表，然后再把索引表里面的数据进行一下 FILTER。</li>
<li>查看 Where 条件中 带有第一个索引字段强制走索引的执行计划</li>
<li>强制走索引的语法：/*+ INDEX($库名.$表名 $索引名) */ *</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select &#x2F;*+ INDEX(bigdata.global_index global_index_idx) *&#x2F; * from bigdata.global_index where name &#x3D; &#39;hadoop1&#39;;</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                                             PLAN                                                             | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN FULL SCAN OVER BIGDATA:GLOBAL_INDEX                                              | null            | null           | null         |</span><br><span class="line">|     SKIP-SCAN-JOIN TABLE 0                                                                                                   | null            | null           | null         |</span><br><span class="line">|         CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN RANGE SCAN OVER BIGDATA:GLOBAL_INDEX_IDX [0,&#39;hadoop1&#39;] - [19,&#39;hadoop1&#39;]  | null            | null           | null         |</span><br><span class="line">|             SERVER FILTER BY FIRST KEY ONLY                                                                                  | null            | null           | null         |</span><br><span class="line">|     DYNAMIC SERVER FILTER BY &quot;BIGDATA.GLOBAL_INDEX.ID&quot; IN ($11.$13)                                                          | null            | null           | null         |</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">5 rows selected (0.049 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>和上面不强制走索引效果差不多</li>
<li>查看 Where 条件中和需要查询的字段都在索引表的执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select age from bigdata.global_index where name &#x3D; &#39;hadoop1&#39;;</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                                         PLAN                                                         | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN RANGE SCAN OVER BIGDATA:GLOBAL_INDEX_IDX [0,&#39;hadoop1&#39;] - [19,&#39;hadoop1&#39;]  | null            | null           | null         |</span><br><span class="line">|     SERVER FILTER BY FIRST KEY ONLY                                                                                  | null            | null           | null         |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">2 rows selected (0.034 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select name from bigdata.global_index where age &#x3D; 18;</span><br><span class="line">+--------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                               PLAN                                               | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+--------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN RANGE SCAN OVER BIGDATA:GLOBAL_INDEX_IDX [0] - [19]  | null            | null           | null         |</span><br><span class="line">|     SERVER FILTER BY FIRST KEY ONLY AND TO_INTEGER(&quot;AGE&quot;) &#x3D; 18                                   | null            | null           | null         |</span><br><span class="line">+--------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">2 rows selected (0.027 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看出 RANGE SCAN 了索引表，这种是最优化的方案</li>
<li>总结：<ul>
<li>where条件全部是索引字段，select条件全部是索引字段，最优的。</li>
<li>where条件全部是索引字段，select条件不部是索引字段，为了走index，强制走。</li>
</ul>
</li>
</ul>
<h4 id="3-2-本地索引"><a href="#3-2-本地索引" class="headerlink" title="3.2 本地索引"></a>3.2 本地索引</h4><ul>
<li>特点：==重写轻读==</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Local Indexes</span><br><span class="line">Local indexing targets write heavy, space constrained use cases. Just like with global indexes, Phoenix will automatically select whether or not to use a local index at query-time. With local indexes, index data and table data co-reside on same server preventing any network overhead during writes. Local indexes can be used even when the query isn’t fully covered (i.e. Phoenix automatically retrieve the columns not in the index through point gets against the data table). Unlike global indexes, all local indexes of a table are stored in a single, separate shared table prior to 4.8.0 version. From 4.8.0 onwards we are storing all local index data in the separate shadow column families in the same data table. At read time when the local index is used, every region must be examined for the data as the exact region location of index data cannot be predetermined. Thus some overhead occurs at read-time.</span><br></pre></td></tr></table></figure>

<ul>
<li>本地索引适合那些写多读少，或者存储空间有限的场景。和全局索引一样，Phoenix也会在查询的时候自动选择是否使用本地索引。本地索引之所以是本地，只要是因为索引数据和真实数据存储在同一台机器上，这样做主要是为了避免网络数据传输的开销。如果你的查询条件没有完全覆盖索引列，本地索引还是可以生效。因为无法提前确定数据在哪个Region上，所以在读数据的时候，还需要检查每个Region上的数据而带来一些性能损耗。</li>
<li>本地索引本质上面索引数据和原数据存储在同一个表里面，本质上面就是在原表的基础上面再增加一个列簇，索引数据写入到新增加的列簇里面。</li>
<li>优点：<ul>
<li>写的性能高 无需写index table ，其实实际上是没有index table这个东西的。</li>
</ul>
</li>
<li>缺点：<ul>
<li>在使用本地索引时，必须检查所有的region的数据，因为无法先确定索引数据的准确区域位置，所以<br>读的开销较大。 </li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; create table bigdata.local_index</span><br><span class="line">. . . . . . . . . . . . . . &gt; (id integer primary key, </span><br><span class="line">. . . . . . . . . . . . . . &gt; name varchar,</span><br><span class="line">. . . . . . . . . . . . . . &gt; age integer,</span><br><span class="line">. . . . . . . . . . . . . . &gt; address varchar) </span><br><span class="line">. . . . . . . . . . . . . . &gt; salt_buckets &#x3D; 20;</span><br><span class="line">No rows affected (4.358 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.local_index  values (1,&#39;hadoop1&#39;,18,&#39;北京&#39;);</span><br><span class="line">1 row affected (0.008 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.local_index  values (2,&#39;hadoop2&#39;,19,&#39;上海&#39;);</span><br><span class="line">1 row affected (0.008 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.local_index  values (3,&#39;hadoop3&#39;,17,&#39;杭州&#39;);</span><br><span class="line">1 row affected (0.007 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.local_index  values (4,&#39;hadoop4&#39;,12,&#39;深圳&#39;);</span><br><span class="line">1 row affected (0.005 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>创建本地索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; CREATE LOCAL INDEX local_index_idx ON  bigdata.local_index(name,age);</span><br><span class="line">4 rows affected (11.532 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase 中原表的表结构 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):006:0&gt; describe &#39;BIGDATA:LOCAL_INDEX&#39;</span><br><span class="line">Table BIGDATA:LOCAL_INDEX is ENABLED</span><br><span class="line"></span><br><span class="line">BIGDATA:LOCAL_INDEX, &#123;TABLE_ATTRIBUTES &#x3D;&gt; &#123;coprocessor$1 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.ScanRegionObserver|805306366|&#39;, coprocessor$2 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.UngroupedAggregateRegionObserver|805306366|&#39;, coprocessor$3 &#x3D;&gt; &#39;|o</span><br><span class="line">rg.apache.phoenix.coprocessor.GroupedAggregateRegionObserver|805306366|&#39;, coprocessor$4 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.ServerCachingEndpointImpl|805306366|&#39;, coprocessor$5 &#x3D;&gt; &#39;|org.apache.phoenix.hbase.index.Indexer|805306366|org.apache</span><br><span class="line">.hadoop.hbase.index.codec.class&#x3D;org.apache.phoenix.index.PhoenixIndexCodec,index.builder&#x3D;org.apache.phoenix.index.PhoenixIndexBuilder&#39;, coprocessor$6 &#x3D;&gt; &#39;|org.apache.hadoop.hbase.regionserver.IndexHalfStoreFileReaderGenerator|805306366|&#39;, ME</span><br><span class="line">TADATA &#x3D;&gt; &#123;&#39;DATA_TABLE_NAME&#39; &#x3D;&gt; &#39;BIGDATA.LOCAL_INDEX&#39;, &#39;SPLIT_POLICY&#39; &#x3D;&gt; &#39;org.apache.phoenix.hbase.index.IndexRegionSplitPolicy&#39;&#125;&#125;</span><br><span class="line"></span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line"></span><br><span class="line">&#123;NAME &#x3D;&gt; &#39;0&#39;, BLOOMFILTER &#x3D;&gt; &#39;NONE&#39;, VERSIONS &#x3D;&gt; &#39;1&#39;, IN_MEMORY &#x3D;&gt; &#39;false&#39;, KEEP_DELETED_CELLS &#x3D;&gt; &#39;FALSE&#39;, DATA_BLOCK_ENCODING &#x3D;&gt; &#39;FAST_DIFF&#39;, TTL &#x3D;&gt; &#39;FOREVER&#39;, COMPRESSION &#x3D;&gt; &#39;NONE&#39;, MIN_VERSIONS &#x3D;&gt; &#39;0&#39;, BLOCKCACHE &#x3D;&gt; &#39;true&#39;, BLOCKSIZE &#x3D;&gt; &#39;</span><br><span class="line">65536&#39;, REPLICATION_SCOPE &#x3D;&gt; &#39;0&#39;&#125;</span><br><span class="line"></span><br><span class="line">&#123;NAME &#x3D;&gt; &#39;L#0&#39;, BLOOMFILTER &#x3D;&gt; &#39;NONE&#39;, VERSIONS &#x3D;&gt; &#39;1&#39;, IN_MEMORY &#x3D;&gt; &#39;false&#39;, KEEP_DELETED_CELLS &#x3D;&gt; &#39;FALSE&#39;, DATA_BLOCK_ENCODING &#x3D;&gt; &#39;FAST_DIFF&#39;, TTL &#x3D;&gt; &#39;FOREVER&#39;, COMPRESSION &#x3D;&gt; &#39;NONE&#39;, MIN_VERSIONS &#x3D;&gt; &#39;0&#39;, BLOCKCACHE &#x3D;&gt; &#39;true&#39;, BLOCKSIZE &#x3D;&gt;</span><br><span class="line"> &#39;65536&#39;, REPLICATION_SCOPE &#x3D;&gt; &#39;0&#39;&#125;</span><br><span class="line"> </span><br><span class="line"> 2 row(s) in 0.0310 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 Phoenix 中是否创建了专门的索引表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; !tables</span><br><span class="line">+------------+--------------+-------------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------+</span><br><span class="line">| TABLE_CAT  | TABLE_SCHEM  |    TABLE_NAME     |  TABLE_TYPE   | REMARKS  | TYPE_NAME  | SELF_REFERENCING_COL_NAME  | REF_GENERATION  | INDEX_STATE  | IMMUTABLE_ROWS  | SALT_BUCKETS  | MULTI_TENANT  | VIEW_STATEMENT  | VIEW_TYPE  | INDEX_ |</span><br><span class="line">+------------+--------------+-------------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------+</span><br><span class="line">|            | BIGDATA      | GLOBAL_INDEX_IDX  | INDEX         |          |            |                            |                 | ACTIVE       | false           | 20            | false         |                 |            | GLOBAL |</span><br><span class="line">|            | BIGDATA      | LOCAL_INDEX_IDX   | INDEX         |          |            |                            |                 | ACTIVE       | false           | null          | false         |                 |            | LOCAL  |</span><br><span class="line">|            | SYSTEM       | CATALOG           | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | FUNCTION          | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | LOG               | SYSTEM TABLE  |          |            |                            |                 |              | true            | 32            | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | SEQUENCE          | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | SYSTEM       | STATS             | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |        |</span><br><span class="line">|            | BIGDATA      | GLOBAL_INDEX      | TABLE         |          |            |                            |                 |              | false           | 20            | false         |                 |            |        |</span><br><span class="line">|            | BIGDATA      | LOCAL_INDEX       | TABLE         |          |            |                            |                 |              | false           | 20            | false         |                 |            |        |</span><br><span class="line">|            | BIGDATA      | SALT              | TABLE         |          |            |                            |                 |              | false           | 20            | false         |                 |            |        |</span><br><span class="line">+------------+--------------+-------------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------+</span><br></pre></td></tr></table></figure>

<ul>
<li>发现创建索引表，并查询索引表中的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; select * from BIGDATA.LOCAL_INDEX_IDX;</span><br><span class="line">+----------+--------+------+</span><br><span class="line">|  0:NAME  | 0:AGE  | :ID  |</span><br><span class="line">+----------+--------+------+</span><br><span class="line">| hadoop4  | 12     | 4    |</span><br><span class="line">| hadoop3  | 17     | 3    |</span><br><span class="line">| hadoop2  | 19     | 2    |</span><br><span class="line">| hadoop1  | 18     | 1    |</span><br><span class="line">+----------+--------+------+</span><br><span class="line">4 rows selected (0.043 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看查询全表的执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select * from bigdata.local_index;</span><br><span class="line">+---------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                      PLAN                                       | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+---------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN FULL SCAN OVER BIGDATA:LOCAL_INDEX  | null            | null           | null         |</span><br><span class="line">+---------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">1 row selected (0.025 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>FULL SCAN BIGDATA:LOCAL_INDEX 里面的数据</li>
<li>查看 Where 后面跟着索引字段查询所有字段执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select * from bigdata.local_index where name &#x3D; &#39;hadoop1&#39;;</span><br><span class="line">+---------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                      PLAN                                       | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+---------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN FULL SCAN OVER BIGDATA:LOCAL_INDEX  | null            | null           | null         |</span><br><span class="line">|     SERVER FILTER BY NAME &#x3D; &#39;hadoop1&#39;                                           | null            | null           | null         |</span><br><span class="line">+---------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>FULL SCAN BIGDATA:LOCAL_INDEX 里面的数据</li>
<li>查看 Where 里面带着索引字段，并且查询非索引字段的执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select address from bigdata.local_index where name &#x3D; &#39;hadoop1&#39;;</span><br><span class="line">+------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                              PLAN                                              | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN RANGE SCAN OVER BIGDATA:LOCAL_INDEX [1,&#39;hadoop1&#39;]  | null            | null           | null         |</span><br><span class="line">|     SERVER FILTER BY FIRST KEY ONLY                                                            | null            | null           | null         |</span><br><span class="line">+------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">2 rows selected (0.039 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select address from bigdata.local_index where age &#x3D; 18;</span><br><span class="line">+--------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                         PLAN                                         | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+--------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN RANGE SCAN OVER BIGDATA:LOCAL_INDEX [1]  | null            | null           | null         |</span><br><span class="line">|     SERVER FILTER BY FIRST KEY ONLY AND TO_INTEGER(&quot;AGE&quot;) &#x3D; 18                       | null            | null           | null         |</span><br><span class="line">+--------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">2 rows selected (0.025 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>总结：要有where条件，且字段不要以*</li>
</ul>
<h4 id="3-3-覆盖索引"><a href="#3-3-覆盖索引" class="headerlink" title="3.3 覆盖索引"></a>3.3 覆盖索引</h4><ul>
<li>特点：==空间换时间，增加查询数据==</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Phoenix is particularly powerful in that we provide covered indexes - we do not need to go back to the primary table once we have found the index entry. Instead, we bundle the data we care about right in the index rows, saving read-time overhead.</span><br><span class="line"></span><br><span class="line">For example, the following would create an index on the v1 and v2 columns and include the v3 column in the index as well to prevent having to get it from the data table:</span><br><span class="line"></span><br><span class="line">CREATE INDEX my_index ON my_table (v1,v2) INCLUDE(v3)</span><br></pre></td></tr></table></figure>

<ul>
<li>Phoenix提供了一种叫Covered Index覆盖索引的二级索引。这种索引在获取数据的过程中，内部不需要再去HBase上获取任何数据，你查询需要返回的列的数据都会被存储在索引中。要想达到这种效果，你的select 的列，where 的列都需要在索引中出现。举个例子，如果你的SQL语句是 select name from hao1 where age=2，要最大化查询效率和速度最快，你就需要建立覆盖索引。</li>
<li>其本质也需要创建一个索引表，不过 Where 条件中的所有字段以及需要查询的所有的字段都在索引表中。</li>
<li>优点：<ul>
<li>空间换时间 查询快。</li>
</ul>
</li>
<li>缺点：<ul>
<li>存储空间浪费。</li>
</ul>
</li>
<li>创建表并插入数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; create table bigdata.covered_index</span><br><span class="line">. . . . . . . . . . . . . . &gt; (id integer primary key, </span><br><span class="line">. . . . . . . . . . . . . . &gt; name varchar,</span><br><span class="line">. . . . . . . . . . . . . . &gt; age integer,</span><br><span class="line">. . . . . . . . . . . . . . &gt; address varchar) </span><br><span class="line">. . . . . . . . . . . . . . &gt; salt_buckets &#x3D; 20;</span><br><span class="line">No rows affected (2.329 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.covered_index  values (1,&#39;hadoop1&#39;,18,&#39;北京&#39;);</span><br><span class="line">1 row affected (0.009 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.covered_index  values (2,&#39;hadoop2&#39;,19,&#39;上海&#39;);</span><br><span class="line">1 row affected (0.006 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.covered_index  values (3,&#39;hadoop3&#39;,17,&#39;杭州&#39;);</span><br><span class="line">1 row affected (0.011 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.covered_index  values (4,&#39;hadoop4&#39;,12,&#39;深圳&#39;);</span><br><span class="line">1 row affected (0.006 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>创建索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; CREATE INDEX covered_index_idx ON  bigdata.covered_index(name,age) INCLUDE(address);</span><br><span class="line">4 rows affected (7.271 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase 中索引表的表结构</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):006:0&gt; describe &#39;BIGDATA:COVERED_INDEX_IDX&#39;</span><br><span class="line">Table BIGDATA:COVERED_INDEX_IDX is ENABLED</span><br><span class="line"></span><br><span class="line">BIGDATA:COVERED_INDEX_IDX, &#123;TABLE_ATTRIBUTES &#x3D;&gt; &#123;coprocessor$1 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.ScanRegionObserver|805306366|&#39;, coprocessor$2 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.UngroupedAggregateRegionObserver|805306366|&#39;, coprocessor$3 </span><br><span class="line">&#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.GroupedAggregateRegionObserver|805306366|&#39;, coprocessor$4 &#x3D;&gt; &#39;|org.apache.phoenix.coprocessor.ServerCachingEndpointImpl|805306366|&#39;, METADATA &#x3D;&gt; &#123;&#39;DATA_TABLE_NAME&#39; &#x3D;&gt; &#39;BIGDATA.COVERED_INDEX&#39;, &#39;PRIORITY&#39; &#x3D;&gt;</span><br><span class="line"> &#39;1000&#39;&#125;&#125;</span><br><span class="line"> </span><br><span class="line"> COLUMN FAMILIES DESCRIPTION</span><br><span class="line"></span><br><span class="line">&#123;NAME &#x3D;&gt; &#39;0&#39;, BLOOMFILTER &#x3D;&gt; &#39;NONE&#39;, VERSIONS &#x3D;&gt; &#39;1&#39;, IN_MEMORY &#x3D;&gt; &#39;false&#39;, KEEP_DELETED_CELLS &#x3D;&gt; &#39;FALSE&#39;, DATA_BLOCK_ENCODING &#x3D;&gt; &#39;FAST_DIFF&#39;, TTL &#x3D;&gt; &#39;FOREVER&#39;, COMPRESSION &#x3D;&gt; &#39;NONE&#39;, MIN_VERSIONS &#x3D;&gt; &#39;0&#39;, BLOCKCACHE &#x3D;&gt; &#39;true&#39;, BLOCKSIZE &#x3D;&gt; &#39;</span><br><span class="line">65536&#39;, REPLICATION_SCOPE &#x3D;&gt; &#39;0&#39;&#125;</span><br><span class="line"></span><br><span class="line">1 row(s) in 0.0240 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 Phoenix 里面的索引表的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; select * from BIGDATA.COVERED_INDEX_IDX;</span><br><span class="line">+----------+--------+------+------------+</span><br><span class="line">|  0:NAME  | 0:AGE  | :ID  | 0:ADDRESS  |</span><br><span class="line">+----------+--------+------+------------+</span><br><span class="line">| hadoop2  | 19     | 2    | 上海         |</span><br><span class="line">| hadoop3  | 17     | 3    | 杭州         |</span><br><span class="line">| hadoop1  | 18     | 1    | 北京         |</span><br><span class="line">| hadoop4  | 12     | 4    | 深圳         |</span><br><span class="line">+----------+--------+------+------------+</span><br><span class="line">4 rows selected (0.054 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 Where 条件和查询列都在索引表中查询的执行计划</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; explain select address from bigdata.covered_index where age &#x3D; 18;</span><br><span class="line">+---------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">|                                               PLAN                                                | EST_BYTES_READ  | EST_ROWS_READ  | EST_INFO_TS  |</span><br><span class="line">+---------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">| CLIENT 20-CHUNK PARALLEL 20-WAY ROUND ROBIN RANGE SCAN OVER BIGDATA:COVERED_INDEX_IDX [0] - [19]  | null            | null           | null         |</span><br><span class="line">|     SERVER FILTER BY TO_INTEGER(&quot;AGE&quot;) &#x3D; 18                                                       | null            | null           | null         |</span><br><span class="line">+---------------------------------------------------------------------------------------------------+-----------------+----------------+--------------+</span><br><span class="line">2 rows selected (0.021 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看出是通过 RANGE SCAN 直接查询了索引表</li>
</ul>
<h4 id="3-4-异步索引"><a href="#3-4-异步索引" class="headerlink" title="3.4  异步索引"></a>3.4  异步索引</h4><ul>
<li>一般我们可以使用CREATE INDEX来创建一个索引，这是一种同步的方法。但是有时候我们创建索引的表非常大，我们需要等很长时间。Phoenix 4.5以后有一个异步创建索引的方式，使用关键字ASYNC来创建索引。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX async_index ON my_schema.my_table (v) ASYNC</span><br></pre></td></tr></table></figure>

<ul>
<li>这时候创建的索引表中不会有数据。你还必须要单独的使用命令行工具来执行数据的创建。当语句给执行的时候，后端会启动一个map reduce任务，只有等到这个任务结束，数据都被生成在索引表中后，这个索引才能被使用。启动工具的方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;HBASE_HOME&#125;&#x2F;bin&#x2F;hbase </span><br><span class="line">org.apache.phoenix.mapreduce.index.IndexTool</span><br><span class="line">  --schema MY_SCHEMA </span><br><span class="line">  --data-table MY_TABLE </span><br><span class="line">  --index-table ASYNC_IDX</span><br><span class="line">  --output-path ASYNC_IDX_HFILES</span><br></pre></td></tr></table></figure>

<ul>
<li>如果一口气导入海量的数据到 HBase 可以使用异步来执行。</li>
<li>但是还可以使用 Bulk_DataLoad。</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://phoenix.apache.org/bulk_dataload.html">Bulk_DataLoad（官网）</a></p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">phoenix</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2020/02/05/Phoenix%20%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Phoenix 入门基础" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2020/01/20/Phoenix%20%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/" target="_blank">Phoenix 入门基础</a>
  
    </h1>
  


  
  
<a href="/2020/01/20/Phoenix%20%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/" class="archive-article-date">
        <time datetime="2020-01-20T13:25:26.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-01-20</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="Phoenix-入门基础"><a href="#Phoenix-入门基础" class="headerlink" title="Phoenix 入门基础"></a><center>Phoenix 入门基础</center></h2><p><a target="_blank" rel="noopener" href="http://phoenix.apache.org/">Phoenix 官网</a></p>
<ul>
<li>Phoenix是构建在HBase上的一个SQL层，能让我们用标准的JDBC APIs而不是HBase客户端APIs来创建表，插入数据和对HBase数据进行查询。Phoenix完全使用Java编写，作为HBase内嵌的JDBC驱动。Phoenix查询引擎会将SQL查询转换为一个或多个HBase扫描，并编排执行以生成标准的JDBC结果集。</li>
</ul>
<h3 id="1-部署-Phoenix"><a href="#1-部署-Phoenix" class="headerlink" title="1. 部署 Phoenix"></a>1. 部署 Phoenix</h3><ul>
<li>本次部署 Phoenix 使用的是 cdh 5.16.2 系列</li>
</ul>
<h4 id="1-1-部署前提"><a href="#1-1-部署前提" class="headerlink" title="1.1 部署前提"></a>1.1 部署前提</h4><ul>
<li>需要部署 HBase</li>
</ul>
<h4 id="1-2-下载并解压-Phoenix"><a href="#1-2-下载并解压-Phoenix" class="headerlink" title="1.2 下载并解压 Phoenix"></a>1.2 下载并解压 Phoenix</h4><ul>
<li>下载的是 CDH 5.14.2 系列的 Phoenix ，与 CDH 5.16.2 系列的 HBase 是可以兼容的</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.apache.org/dyn/closer.lua/phoenix/apache-phoenix-4.14.0-cdh5.14.2/bin/apache-phoenix-4.14.0-cdh5.14.2-bin.tar.gz">下载地址</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ cd software&#x2F;</span><br><span class="line">[hadoop@bigdata software]$ wget http:&#x2F;&#x2F;www.apache.org&#x2F;dyn&#x2F;closer.lua&#x2F;phoenix&#x2F;apache-phoenix-4.14.0-cdh5.14.2&#x2F;bin&#x2F;apache-phoenix-4.14.0-cdh5.14.2-bin.tar.gz</span><br><span class="line">[hadoop@bigdata software]$ tar -xzvf apache-phoenix-4.14.0-cdh5.14.2-bin.tar.gz -C ~&#x2F;app&#x2F;</span><br><span class="line">[hadoop@bigdata software]$ cd ~&#x2F;app&#x2F;</span><br><span class="line">[hadoop@bigdata app]$ ln -s apache-phoenix-4.14.0-cdh5.14.2-bin phoenix</span><br><span class="line">[hadoop@bigdata app]$ cd phoenix&#x2F;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-重新部署-HBase"><a href="#1-3-重新部署-HBase" class="headerlink" title="1.3 重新部署 HBase"></a>1.3 重新部署 HBase</h4><ul>
<li>停止 HBase，删除 HBase 在 HDFS 上面的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata phoenix]$ hdfs dfs -rmr &#x2F;hbase</span><br><span class="line">rmr: DEPRECATED: Please use &#39;rm -r&#39; instead.</span><br><span class="line">21&#x2F;02&#x2F;08 13:23:48 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">Deleted &#x2F;hbase</span><br></pre></td></tr></table></figure>

<ul>
<li>删除 ZK 上面的 HBase 元数据信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata phoenix]$ zkCli.sh </span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls &#x2F;hbase</span><br><span class="line">[replication, meta-region-server, rs, splitWAL, backup-masters, table-lock, flush-table-proc, master-maintenance, region-in-transition, online-snapshot, switch, master, running, recovering-regions, draining, namespace, hbaseid, table]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 2] rmr &#x2F;hbase</span><br><span class="line">[zk: localhost:2181(CONNECTED) 3] ls &#x2F;</span><br><span class="line">[cluster, controller_epoch, brokers, zookeeper, kafka, admin, isr_change_notification, consumers, log_dir_event_notification, latest_producer_id_block, config]</span><br></pre></td></tr></table></figure>

<ul>
<li>修改 HBase 配置文件并启动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata phoenix]$ cd ~</span><br><span class="line">[hadoop@bigdata ~]$ cd app&#x2F;hbase</span><br><span class="line">[hadoop@bigdata hbase]$ vim conf&#x2F;hbase-site.xml </span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;hbase.table.sanity.checks&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;false&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;hbase.regionserver.wal.codec&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;phoenix.schema.isNamespaceMappingEnabled&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;phoenix.schema.mapSystemTablesToNamespace&lt;&#x2F;name&gt;</span><br><span class="line">        &lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>增加 Phoenix 里面的 jar</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata hbase]$ cd ~&#x2F;app&#x2F;phoenix&#x2F;</span><br><span class="line">[hadoop@bigdata phoenix]$ cp phoenix-4.14.0-cdh5.14.2-server.jar ~&#x2F;app&#x2F;hbase&#x2F;lib&#x2F;</span><br></pre></td></tr></table></figure>

<ul>
<li>重启 HBase</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata phoenix]$ start-hbase.sh</span><br><span class="line">[hadoop@bigdata phoenix]$ hbase shell</span><br><span class="line">hbase(main):001:0&gt; list</span><br><span class="line">TABLE                                                                                                                                                                                                                                            </span><br><span class="line">0 row(s) in 0.1220 seconds</span><br><span class="line"></span><br><span class="line">&#x3D;&gt; []</span><br></pre></td></tr></table></figure>

<ul>
<li>说明没有问题</li>
</ul>
<h4 id="1-4-启动-PHoenix"><a href="#1-4-启动-PHoenix" class="headerlink" title="1.4 启动 PHoenix"></a>1.4 启动 PHoenix</h4><ul>
<li>修改 Phoenix 里面 hbase-site.xml文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata phoenix]$ cd ~&#x2F;app&#x2F;phoenix&#x2F;</span><br><span class="line">[hadoop@bigdata phoenix]$ cd bin</span><br><span class="line">[hadoop@bigdata bin]$ rm -rf hbase-site.xml </span><br><span class="line">[hadoop@bigdata bin]$ ln -s &#x2F;home&#x2F;hadoop&#x2F;app&#x2F;hbase&#x2F;conf&#x2F;hbase-site.xml hbase-site.xml</span><br></pre></td></tr></table></figure>

<ul>
<li>启动 Phoenix</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata bin]$ .&#x2F;sqlline.py bigdata:2181</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; </span><br></pre></td></tr></table></figure>

<h3 id="2-Phoenix-数据类型"><a href="#2-Phoenix-数据类型" class="headerlink" title="2. Phoenix 数据类型"></a>2. Phoenix 数据类型</h3><p><a target="_blank" rel="noopener" href="http://phoenix.apache.org/language/datatypes.html">数据类型（官网）</a></p>
<ul>
<li>常用的数据类型有：</li>
</ul>
<ol>
<li>INTEGER</li>
<li>BIGINT</li>
<li>FLOAT</li>
<li>DECIMAL</li>
<li>BOOLEAN</li>
<li>TIMESTAMP</li>
<li>VARCHAR</li>
</ol>
<ul>
<li>对标 Mysql 数据库：<ul>
<li>Mysql 中的 int 改成了 INTEGER</li>
<li>Mysql 中的日期类型可以在 Phoenix 中统一使用 TIMESTAMP</li>
<li>Mysql 中的 char、varchar 在 Phoenix 中统一用 VARCHAR</li>
</ul>
</li>
</ul>
<h3 id="3-Phoenix-常用语法"><a href="#3-Phoenix-常用语法" class="headerlink" title="3. Phoenix 常用语法"></a>3. Phoenix 常用语法</h3><p><a target="_blank" rel="noopener" href="http://phoenix.apache.org/language/index.html">基础语法</a></p>
<h4 id="3-1-创建一个-DataBase"><a href="#3-1-创建一个-DataBase" class="headerlink" title="3.1 创建一个 DataBase"></a>3.1 创建一个 DataBase</h4><ul>
<li>官方案例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line"></span><br><span class="line">CREATE SCHEMA IF NOT EXISTS my_schema</span><br><span class="line">CREATE SCHEMA my_schema</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; CREATE SCHEMA bigdata;</span><br><span class="line">No rows affected (0.021 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase 里面的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):003:0&gt; list_namespace</span><br><span class="line">NAMESPACE</span><br><span class="line">BIGDATA</span><br><span class="line">SYSTEM</span><br><span class="line">default</span><br><span class="line">hbase</span><br><span class="line">4 row(s) in 0.0240 seconds</span><br></pre></td></tr></table></figure>

<h4 id="3-2-创建表"><a href="#3-2-创建表" class="headerlink" title="3.2 创建表"></a>3.2 创建表</h4><ul>
<li>官方案例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line"></span><br><span class="line">CREATE TABLE my_schema.my_table ( id BIGINT not null primary key, date Date)</span><br><span class="line">CREATE TABLE my_table ( id INTEGER not null primary key desc, date DATE not null,</span><br><span class="line">    m.db_utilization DECIMAL, i.db_utilization)</span><br><span class="line">    m.DATA_BLOCK_ENCODING&#x3D;&#39;DIFF&#39;</span><br><span class="line">CREATE TABLE stats.prod_metrics ( host char(50) not null, created_date date not null,</span><br><span class="line">    txn_count bigint CONSTRAINT pk PRIMARY KEY (host, created_date) )</span><br><span class="line">CREATE TABLE IF NOT EXISTS &quot;my_case_sensitive_table&quot;</span><br><span class="line">    ( &quot;id&quot; char(10) not null primary key, &quot;value&quot; integer)</span><br><span class="line">    DATA_BLOCK_ENCODING&#x3D;&#39;NONE&#39;,VERSIONS&#x3D;5,MAX_FILESIZE&#x3D;2000000 split on (?, ?, ?)</span><br><span class="line">CREATE TABLE IF NOT EXISTS my_schema.my_table (</span><br><span class="line">    org_id CHAR(15), entity_id CHAR(15), payload binary(1000),</span><br><span class="line">    CONSTRAINT pk PRIMARY KEY (org_id, entity_id) )</span><br><span class="line">    TTL&#x3D;86400</span><br></pre></td></tr></table></figure>

<ul>
<li>!tables：查看当前所有的表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; CREATE TABLE bigdata.test ( id BIGINT not null primary key, name varchar)</span><br><span class="line">. . . . . . . . . . . . . . &gt; ;</span><br><span class="line">No rows affected (2.26 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; !tables</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------------+</span><br><span class="line">| TABLE_CAT  | TABLE_SCHEM  | TABLE_NAME  |  TABLE_TYPE   | REMARKS  | TYPE_NAME  | SELF_REFERENCING_COL_NAME  | REF_GENERATION  | INDEX_STATE  | IMMUTABLE_ROWS  | SALT_BUCKETS  | MULTI_TENANT  | VIEW_STATEMENT  | VIEW_TYPE  | INDEX_TYPE   |</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------------+</span><br><span class="line">|            | SYSTEM       | CATALOG     | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | FUNCTION    | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | LOG         | SYSTEM TABLE  |          |            |                            |                 |              | true            | 32            | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | SEQUENCE    | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | STATS       | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">|            | BIGDATA      | TEST        | TABLE         |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>Phoenix 里面指定了 primary key 对应了 HBase 中的 RowKey</li>
<li>查看 HBase 中 bigdata namespace 下面的所有表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):005:0&gt; list_namespace_tables &#39;BIGDATA&#39;</span><br><span class="line">TABLE</span><br><span class="line"></span><br><span class="line">TEST</span><br><span class="line"></span><br><span class="line">1 row(s) in 0.0090 seconds</span><br></pre></td></tr></table></figure>

<h4 id="3-3-插入数据"><a href="#3-3-插入数据" class="headerlink" title="3.3 插入数据"></a>3.3 插入数据</h4><ul>
<li>官方案例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line"></span><br><span class="line">UPSERT INTO TEST VALUES(&#39;foo&#39;,&#39;bar&#39;,3);</span><br><span class="line">UPSERT INTO TEST(NAME,ID) VALUES(&#39;foo&#39;,123);</span><br><span class="line">UPSERT INTO TEST(ID, COUNTER) VALUES(123, 0) ON DUPLICATE KEY UPDATE COUNTER &#x3D; COUNTER + 1;</span><br><span class="line">UPSERT INTO TEST(ID, MY_COL) VALUES(123, 0) ON DUPLICATE KEY IGNORE;</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line"></span><br><span class="line">UPSERT INTO test.targetTable(col1, col2) SELECT col3, col4 FROM test.sourceTable WHERE col5 &lt; 100</span><br><span class="line">UPSERT INTO foo SELECT * FROM bar;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; upsert into bigdata.test values (1,&#39;hadoop&#39;);</span><br><span class="line">1 row affected (0.012 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase 中的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):007:0&gt; scan &#39;BIGDATA:TEST&#39;</span><br><span class="line">ROW                                                           COLUMN+CELL</span><br><span class="line">          </span><br><span class="line"> \x80\x00\x00\x00\x00\x00\x00\x01                             column&#x3D;0:\x00\x00\x00\x00, timestamp&#x3D;1612765603313, value&#x3D;x</span><br><span class="line"> \x80\x00\x00\x00\x00\x00\x00\x01                             column&#x3D;0:\x80\x0B, timestamp&#x3D;1612765603313, value&#x3D;hadoop</span><br></pre></td></tr></table></figure>

<h4 id="3-4-查询数据"><a href="#3-4-查询数据" class="headerlink" title="3.4 查询数据"></a>3.4 查询数据</h4><ul>
<li>官方案例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line"></span><br><span class="line">SELECT * FROM TEST LIMIT 1000;</span><br><span class="line">SELECT * FROM TEST LIMIT 1000 OFFSET 100;</span><br><span class="line">SELECT full_name FROM SALES_PERSON WHERE ranking &gt;&#x3D; 5.0</span><br><span class="line">    UNION ALL SELECT reviewer_name FROM CUSTOMER_REVIEW WHERE score &gt;&#x3D; 8.0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; select * from bigdata.test;</span><br><span class="line">+-----+---------+</span><br><span class="line">| ID  |  NAME   |</span><br><span class="line">+-----+---------+</span><br><span class="line">| 1   | hadoop  |</span><br><span class="line">+-----+---------+</span><br><span class="line">1 row selected (0.026 seconds)</span><br></pre></td></tr></table></figure>

<h4 id="3-5-删除数据"><a href="#3-5-删除数据" class="headerlink" title="3.5 删除数据"></a>3.5 删除数据</h4><ul>
<li>官方案例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line"></span><br><span class="line">DELETE FROM TEST;</span><br><span class="line">DELETE FROM TEST WHERE ID&#x3D;123;</span><br><span class="line">DELETE FROM TEST WHERE NAME LIKE &#39;foo%&#39;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; delete from bigdata.test;</span><br><span class="line">1 row affected (0.009 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; select * from bigdata.test;</span><br><span class="line">+-----+-------+</span><br><span class="line">| ID  | NAME  |</span><br><span class="line">+-----+-------+</span><br><span class="line">+-----+-------+</span><br><span class="line">No rows selected (0.015 seconds)</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase 里面的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):008:0&gt; scan &#39;BIGDATA:TEST&#39;</span><br><span class="line">ROW                                                           COLUMN+CELL</span><br><span class="line">0 row(s) in 0.0130 seconds</span><br></pre></td></tr></table></figure>

<h4 id="3-6-删除表"><a href="#3-6-删除表" class="headerlink" title="3.6 删除表"></a>3.6 删除表</h4><ul>
<li>官方案例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line"></span><br><span class="line">DROP TABLE my_schema.my_table;</span><br><span class="line">DROP TABLE IF EXISTS my_table;</span><br><span class="line">DROP TABLE my_schema.my_table CASCADE;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:bigdata:2181&gt; DROP TABLE bigdata.test;</span><br><span class="line">No rows affected (3.469 seconds)</span><br><span class="line">0: jdbc:phoenix:bigdata:2181&gt; !tables</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------------+</span><br><span class="line">| TABLE_CAT  | TABLE_SCHEM  | TABLE_NAME  |  TABLE_TYPE   | REMARKS  | TYPE_NAME  | SELF_REFERENCING_COL_NAME  | REF_GENERATION  | INDEX_STATE  | IMMUTABLE_ROWS  | SALT_BUCKETS  | MULTI_TENANT  | VIEW_STATEMENT  | VIEW_TYPE  | INDEX_TYPE   |</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------------+</span><br><span class="line">|            | SYSTEM       | CATALOG     | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | FUNCTION    | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | LOG         | SYSTEM TABLE  |          |            |                            |                 |              | true            | 32            | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | SEQUENCE    | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">|            | SYSTEM       | STATS       | SYSTEM TABLE  |          |            |                            |                 |              | false           | null          | false         |                 |            |              |</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+-----------------+------------+--------------+</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase bigdata namespace 下面的表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):009:0&gt; list_namespace_tables &#39;BIGDATA&#39;</span><br><span class="line">TABLE</span><br><span class="line"></span><br><span class="line">0 row(s) in 0.0090 seconds</span><br></pre></td></tr></table></figure>
    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">phoenix</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2020/01/20/Phoenix%20%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Hbase 进阶" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2020/01/10/Hbase%20%E8%BF%9B%E9%98%B6/" target="_blank">Hbase 进阶</a>
  
    </h1>
  


  
  
<a href="/2020/01/10/Hbase%20%E8%BF%9B%E9%98%B6/" class="archive-article-date">
        <time datetime="2020-01-10T15:20:55.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-01-10</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="Hbase-进阶"><a href="#Hbase-进阶" class="headerlink" title="Hbase 进阶"></a><center>Hbase 进阶</center></h2><p><a target="_blank" rel="noopener" href="http://hbase.apache.org/1.4/book.html#config.files">HBase 1.4 参数地址</a></p>
<h3 id="1-HBase-MemStore-Flush"><a href="#1-HBase-MemStore-Flush" class="headerlink" title="1. HBase MemStore Flush"></a>1. HBase MemStore Flush</h3><h4 id="1-1-MemStore-概述"><a href="#1-1-MemStore-概述" class="headerlink" title="1.1 MemStore 概述"></a>1.1 MemStore 概述</h4><ul>
<li>之前给大家简单介绍了 MemStore，这里需要介绍 MemStore 的 Flush，再介绍一下 MemStore。</li>
<li>在 HBase 中，Region 是最小的数据服务单元，一个表是由一个或者多个 Region 组成的。在 Region 中又根据 ColumnFamily （列簇）的数量分为一个或者多个 Store，一个ColumnFamily 对应一个 Store。每个 Store 分成 一个 MemStore 和多个 HFile。</li>
</ul>
<p><img src="/img/hbase/Region%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="Region 结构图"></p>
<ul>
<li>HBase 中所有的数据在做更新或者插入操作之前，都是先把数据写入到 MemStore 里面，达到指定大小之后再把这些操作写入磁盘中，生成一个新的 HFile 文件，这种设计极大的提高了 HBase 的写入性，数据在写入到 MemStore 中的同时会按照顺序把数据写入到 HLog 中。</li>
<li>HBase 为了方便 RowKey 进行检索，数据在 MemStore 中会先进行一次排序，然后再写入到 HFile中，HFile 中的数据都要按照 RowKey 进行排序，是数据保持有序。</li>
<li>HBase 在读取数据先从 MemStore 中读取数据，如果没有找到则会去 HFile 中找，最后要是再找不到，则会去 HLog 中找，把最终结果 Merge 之后返回给用户。</li>
<li>可见在 HBase 中无论是写入数据还是读取数据，MemStore 都至关重要，接下来重点针对 MemStore 的 Flush 操作进行深入的解析。</li>
</ul>
<h4 id="1-2-MemStore-Flush-触发条件"><a href="#1-2-MemStore-Flush-触发条件" class="headerlink" title="1.2 MemStore Flush 触发条件"></a>1.2 MemStore Flush 触发条件</h4><ul>
<li>MemStore 级别限制：<ul>
<li>当 Region 中任一 MemStore 的大小达到了刷新的阈值（hbase.hregion.memstore.flush.size ，默认是128M），会触发该 MemStore 的 Flush。</li>
</ul>
</li>
<li>Region 级别限制：<ul>
<li>当一个 Region 中所有的 MemStore 大小总和达到了上限（hbase.hregion.memstore.block.multiplier * hbase.hregion.memstore.flush.size，默认是 4 * 128M ），会触发该 Region 里面所有的 MemStore Flush 操作，在 Flush 的同时，会阻塞所有写入该 Store 的写请求，继续对该 Region 发送请求的时候，会抛错  region too busy exception 异常。</li>
</ul>
</li>
<li>Region Server 级别限制：<ul>
<li> 当 Region Server 中的所有 MemStore 大小总和达到了上限 （hbase.regionserver.global.memstore.upperLimit * hbase_heapsize），会触发该 Region Server 的 MemStore Flush，按照 MemStore 的大小由大到小执行 Flush，直到该 Region Server 里所有的 MemStore 低于阈值（hbase.regionserver.global.memstore.lowerLimit * hbase_heapsize）则停止刷新。</li>
</ul>
</li>
<li>Hlog级别限制：<ul>
<li>当一个 Region Server 中 HLog 数据达到阈值（hbase.regionserver.maxlogs）时，系统会选取最早的一个 HLog 对应的一个或者多个 Region 进行 Flush。</li>
</ul>
</li>
<li>HBase 定期刷新 MemStore：<ul>
<li>设置 HBase 定期刷新的参数为：hbase.regionserver.optionalcacheflushinterval ，默认为一个小时，为了避免所有的 MemStore 都在统一时刻 Flush 导致无法写入任何数据，定期的 Flush 会有一定的随机延时，设置为0，表示禁用。</li>
</ul>
</li>
<li>手动执行 Flush：<ul>
<li>用户可以通过shell命令 flush ‘tablename’或者flush ‘region name’分别对一个表或者一个 Region 进行 Flush。 </li>
</ul>
</li>
<li>总结：<ul>
<li>在生产上面，唯独触发 Region Server 级别的 Flush ，是属于灾难级别的，会阻塞所有落在该 Region Server 上面的读写请求，阻塞时间较长，其他级别的 Flush ，只会阻塞对应的 Region 上面的读写请求，阻塞时间较短。</li>
</ul>
</li>
</ul>
<h3 id="2-HBase-Compaction"><a href="#2-HBase-Compaction" class="headerlink" title="2.HBase Compaction"></a>2.HBase Compaction</h3><ul>
<li>随着 HBase 运行的时间越来越长，MemStore 会 Flush 生成多个 HFile，可能会导致，随机读取一条数据，需要检索多个 HFile ，而且会在 HDFS 上面生成多个小文件，基于这些，HBase 提供了 Compaction。</li>
<li>Compaction 的作用：<ul>
<li>小文件合并，减少文件的数量，减少稳定度的延迟。</li>
<li>对于删除、过期、多版本冗余的数据进行清除，降低存储空间，提高数据的本地化率。</li>
</ul>
</li>
<li>Compaction 的分类：<ul>
<li>Minor Compaction：只合并小文件，对TTL过期数据设置过期清理，不会对文件内容进行清除操作。</li>
<li>Major Compaction：对 Region 下同一个 Column family 的 StoreFile 合并为一个大文件，并且清除删除、过期、多余版本的数据。</li>
</ul>
</li>
<li>Compaction 的触发条件：<ul>
<li>当每次 MemStore Flush 的时候，将数据写入到 HFile 中，每次 Flush 会对当前的 Store 里面的总文件数进行检验，一旦总文件数超过阈值（hbase.hstore.compactionThreshold 默认是3），则触发 Compaction 操作。</li>
<li>后台线程定期检查：后台线程（CompactionChecker）定期检查是否需要执行合并，检查周期为（hbase.server.thread.wakefrequency * hbase.server.compactchecker.interval.multiplier 默认值：10000ms*1000）。</li>
<li>手动触发：执行命令 major_compact 、 compact。</li>
<li>当文件小于阈值（hbase.hstore.compaction.min.size 默认 128M），则会立即被添加到 Major Compaction 合并的队列，当 HFile 数量超过阈值（hbase.hstore.compaction.min 默认3），则启动 Minor Compaction。</li>
</ul>
</li>
<li>生产上（建议）：<ul>
<li> hbase.hregion.majorcompaction = 0 ，关闭 Major Compaction。</li>
<li> hbase.hstore.compactionThreshold = 6 （默认3），修改 发生 Minor Compaction 的文件数量。</li>
</ul>
</li>
</ul>
<h3 id="3-Region-Move"><a href="#3-Region-Move" class="headerlink" title="3. Region Move"></a>3. Region Move</h3><ul>
<li>在工作中，某个 Region Server 上面如果有很多大的 Region ，且读写请求比较频繁，其他的 Region Server 比较空闲，导致请求不均匀。这时候可以手动 Move Region 到空闲的 Region Server，使集群资源充分利用。</li>
<li>Move 是 Region 的迁移，是一个轻量级的操作，因为本身 HBase 数据存储在 HDFS 上面，不需要独立管理数据，因此 Region 的迁移，真实不需要迁移数据，只是把这个 Region 中的读写服务都放在另一台 Region Server 上面。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Move a region.  Optionally specify target regionserver else we choose one</span><br><span class="line">at random.  NOTE: You pass the encoded region name, not the region name so</span><br><span class="line">this command is a little different to the others.  The encoded region name</span><br><span class="line">is the hash suffix on region names: e.g. if the region name were</span><br><span class="line">TestTable,0094429456,1289497600452.527db22f95c8a9e0116f0cc13c680396. then</span><br><span class="line">the encoded region name portion is 527db22f95c8a9e0116f0cc13c680396</span><br><span class="line">A server name is its host, port plus startcode. For example:</span><br><span class="line">host187.example.com,60020,1289493121758</span><br><span class="line">Examples:</span><br><span class="line"></span><br><span class="line">  hbase&gt; move &#39;ENCODED_REGIONNAME&#39;</span><br><span class="line">  hbase&gt; move &#39;ENCODED_REGIONNAME&#39;, &#39;SERVER_NAME&#39;</span><br></pre></td></tr></table></figure>

<h3 id="4-Region-Spilt"><a href="#4-Region-Spilt" class="headerlink" title="4. Region Spilt"></a>4. Region Spilt</h3><h4 id="4-1-HBase-Region-Spilt-类型"><a href="#4-1-HBase-Region-Spilt-类型" class="headerlink" title="4.1 HBase Region Spilt 类型"></a>4.1 HBase Region Spilt 类型</h4><p><img src="/img/hbase/Region-Split-Type.png" alt="Region-Spilt-Type"></p>
<ul>
<li>ConstantSizeRegionSplitPolicy：0.94版本前默认切分策略。这是最容易理解但也最容易产生误解的切分策略，从字面意思来看，当 Region 大小大于某个阈值（hbase.hregion.max.filesize）之后就会触发切分，实际上并不是这样，真正实现中这个阈值是对于某个 Store 来说的，即一个 Region 中最大 Store 的大小大于设置阈值之后才会触发切分。另外一个大家比较关心的问题是这里所说的 Store 大小是压缩后的文件总大小还是未压缩文件总大小，实际实现中 Store 大小为压缩后的文件大小（采用压缩的场景）。ConstantSizeRegionSplitPolicy 相对来来说最容易想到，但是在生产线上这种切分策略却有相当大的弊端：切分策略对于大表和小表没有明显的区分。阈值（hbase.hregion.max.filesize）设置较大对大表比较友好，但是小表就有可能不会触发分裂，极端情况下可能就1个，这对业务来说并不是什么好事。如果设置较小则对小表友好，但一个大表就会在整个集群产生大量的region，这对于集群的管理、资源使用、failover来说都不是一件好事。</li>
<li>IncreasingToUpperBoundRegionSplitPolicy: 0.94版本~2.0版本默认切分策略。这种切分策略微微有些复杂，总体来看和 ConstantSizeRegionSplitPolicy 思路相同，一个 Region 中最大 Store 大小大于设置阈值就会触发切分。但是这个阈值并不像 ConstantSizeRegionSplitPolicy 是一个固定的值，而是会在一定条件下不断调整，调整规则和 Region 所属表在当前 Region Server 上的 Region 个数有关系 ：(#region个数)^3 * flush size * 2，当然阈值并不会无限增大，最大值为用户设置的 MaxRegionFileSize。这种切分策略很好的弥补了 ConstantSizeRegionSplitPolicy 的短板，能够自适应大表和小表。而且在大集群条件下对于很多大表来说表现很优秀，但并不完美，这种策略下很多小表会在大集群中产生大量小 Region，分散在整个集群中。而且在发生 Region 迁移时也可能会触发 Region 分裂。</li>
<li>SteppingSplitPolicy: 2.0版本默认切分策略。这种切分策略的切分阈值又发生了变化，相比 IncreasingToUpperBoundRegionSplitPolicy 简单了一些，依然和待分裂 Region 所属表在当前 RegionServer 上的 Region 个数有关系，如果 Region 个数等于1，切分阈值为 flush size * 2，否则为 MaxRegionFileSize。这种切分策略对于大集群中的大表、小表会比 IncreasingToUpperBoundRegionSplitPolicy 更加友好，小表不会再产生大量的小 Region，而是适可而止。</li>
<li>建议使用：==ConstantSizeRegionSplitPolicy==</li>
</ul>
<h4 id="4-2-HBase-Region-Spilt-流程"><a href="#4-2-HBase-Region-Spilt-流程" class="headerlink" title="4.2 HBase Region Spilt 流程"></a>4.2 HBase Region Spilt 流程</h4><p><img src="/img/hbase/split.jpg" alt="HBase-Region-Spilt流程"></p>
<ul>
<li>Region In Transition: RIT</li>
</ul>
<ol>
<li>Region Server 更改ZK节点 /hbase/region-in-transition 中该 Region 的状态为 SPLITING。</li>
<li>Master通过watch节点 /hbase/region-in-transition 检测到 Region 状态改变，并修改内存中 Region 的状态，在 Master 页面RIT模块就可以看到 Region 执行 Split 的状态信息。</li>
<li>在父存储目录下新建临时文件夹.split保存 Split 后的daughter region信息。</li>
<li>关闭 Parent Region：Parent Region 关闭数据写入并触发 Flush 操作，将写入 Region 的数据全部持久化到磁盘。此后短时间内客户端落在父 Region 上的请求都会抛出异常 NotServingRegionException。</li>
<li>核心分裂步骤：在.split文件夹下新建两个子文件夹，称之为daughter A、daughter B，并在文件夹中生成 reference 文件，分别指向父 Region 中对应文件。</li>
<li>父 Region 分裂为两个子 Region 后，将daughter A、daughter B拷贝到 HBase 根目录下，形成两个新的 Region。</li>
<li>Parent Region 通知修改 hbase.meta 表后下线，不再提供服务。下线后 Parent  Region在 meta 表中的信息并不会马上删除，而是标注 Split 列、offline列为true，并记录两个子 Region。</li>
<li>开启daughter A、daughter B两个子 Region 。通知修改 hbase.meta 表，正式对外提供服务。</li>
</ol>
<h3 id="5-Region-Merge"><a href="#5-Region-Merge" class="headerlink" title="5. Region Merge"></a>5. Region Merge</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Merge two regions. Passing &#39;true&#39; as the optional third parameter will force</span><br><span class="line">a merge (&#39;force&#39; merges regardless else merge will fail unless passed</span><br><span class="line">adjacent regions. &#39;force&#39; is for expert use only).</span><br><span class="line"></span><br><span class="line">You can pass the encoded region name or the full region name.  The encoded</span><br><span class="line">region name is the hash suffix on region names: e.g. if the region name were</span><br><span class="line">TestTable,0094429456,1289497600452.527db22f95c8a9e0116f0cc13c680396. then</span><br><span class="line">the encoded region name portion is 527db22f95c8a9e0116f0cc13c680396</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line"></span><br><span class="line">  hbase&gt; merge_region &#39;FULL_REGIONNAME&#39;, &#39;FULL_REGIONNAME&#39;</span><br><span class="line">  hbase&gt; merge_region &#39;FULL_REGIONNAME&#39;, &#39;FULL_REGIONNAME&#39;, true</span><br><span class="line"></span><br><span class="line">  hbase&gt; merge_region &#39;ENCODED_REGIONNAME&#39;, &#39;ENCODED_REGIONNAME&#39;</span><br><span class="line">  hbase&gt; merge_region &#39;ENCODED_REGIONNAME&#39;, &#39;ENCODED_REGIONNAME&#39;, true</span><br></pre></td></tr></table></figure>

<h4 id="5-1-Region-Merge-场景"><a href="#5-1-Region-Merge-场景" class="headerlink" title="5.1 Region Merge 场景"></a>5.1 Region Merge 场景</h4><ul>
<li>当某个 Region 长时间没有被写入数据，而且该 Region 里面的数据可能是因为 TTL（数据存活时间） 过期而删除，在这种情况下，该 Region 存在没什么意义。一旦空闲的 Region 很多，会导致集群的运维成本上升，所以将相邻的空闲 Region 进行 Merge，可以有效的减少 Region 的数量。</li>
</ul>
<h4 id="5-2-Region-Merge-流程"><a href="#5-2-Region-Merge-流程" class="headerlink" title="5.2 Region Merge 流程"></a>5.2 Region Merge 流程</h4><ol>
<li>客户端发送 Merge 请求到 Master。</li>
<li>Master 将待 Merge 的 Region 放在一个 Region Server 里面。</li>
<li>Master 发送合并请求给 Region Server 。</li>
<li>Region Server 接受到 Merge 请求，启动本地事务执行 Merge 操作。</li>
<li>在 Merge 操作中首先是先把两个带合并的 Region 下线，然后再进行 Merge 操作。</li>
<li>将 meta 表中合并前的两个 Region 信息删除，合并结束后再把新的 Region 的信息写入到 meta 表中。</li>
<li>上线新的 Region。</li>
</ol>
<h3 id="6-RowKey-设计"><a href="#6-RowKey-设计" class="headerlink" title="6. RowKey 设计"></a>6. RowKey 设计</h3><h4 id="6-1-RowKey-设计规范"><a href="#6-1-RowKey-设计规范" class="headerlink" title="6.1 RowKey 设计规范"></a>6.1 RowKey 设计规范</h4><ul>
<li>Region 中 有两个重要的指标 SartKey、EndKey，这两个指的是 Region 中 RowKey 的范围。</li>
<li>在 HBase 中获取数据有两种方式：<ul>
<li>通过 RowKey 得到数据。</li>
<li>全表查询数据。</li>
</ul>
</li>
</ul>
<ol>
<li>RowKey 唯一原则<ul>
<li>HBase 中的 RowKey 相当于关系型数据库中的主键。</li>
</ul>
</li>
<li>RowKey 长度原则<ul>
<li>为了减少 RowKey 带来的磁盘消耗，RowKey 是一个二进制的字符，最大长度为64KB，建议不要超过 16 字节。</li>
<li>HBase 中的存储结构是 Key Value 格式存储的，如果 RowKey 过长，会极大的影响 HFile 文件的存储效率，会频繁的触发 MemStore Flush 机制。</li>
</ul>
</li>
</ol>
<h4 id="6-2-常用的-RowKey-设计"><a href="#6-2-常用的-RowKey-设计" class="headerlink" title="6.2 常用的 RowKey 设计"></a>6.2 常用的 RowKey 设计</h4><h5 id="6-2-1-Salt-RowKey"><a href="#6-2-1-Salt-RowKey" class="headerlink" title="6.2.1 Salt RowKey"></a>6.2.1 Salt RowKey</h5><ul>
<li>固定长度的随机数 + 原始表的主键 ==&gt; RowKey</li>
<li>优点：<ul>
<li>极大的提高了写入数据的吞吐量，保障所有的 Region 负载均衡。</li>
</ul>
</li>
<li>缺点：<ul>
<li>由于添加的是随机数，基于原表查询的时候不知道 前面的随机数是什么，无法准确的锁定一条数据。</li>
<li>由于不知道前面增加的随机数是什么，无法更新数据，导致数据会重复。</li>
</ul>
</li>
</ul>
<h5 id="6-2-2-Hash-RowKey（建议使用）"><a href="#6-2-2-Hash-RowKey（建议使用）" class="headerlink" title="6.2.2 Hash RowKey（建议使用）"></a>6.2.2 Hash RowKey（建议使用）</h5><ul>
<li>基于原表主键进行 Hash ，将 Hash 值作为 RowKey 前缀，然后再加上原表前缀。</li>
<li>算法包：md5 sha1 sha256 sha512</li>
<li>优点：<ul>
<li>同一条数据只会生成一个 RowKey，不会重复数据。</li>
<li>极大的提高了写入数据的吞吐量，保障所有的 Region 负载均衡。</li>
<li>对通过 RowKey 得到一条数据十分有利。</li>
</ul>
</li>
<li>缺点：<ul>
<li>不利于全表查询数据，由于 RowKey 是通过 Hash 之后计算出来的，数据只根据 RowKey 进行排序，原始的数据则是无序的。</li>
</ul>
</li>
</ul>
<h5 id="6-2-3-Reverse-RowKey"><a href="#6-2-3-Reverse-RowKey" class="headerlink" title="6.2.3 Reverse RowKey"></a>6.2.3 Reverse RowKey</h5><ul>
<li>如果原表的主键类似于手机号码、身份证号，数据开头为1、3比较密集，会导致数据的分布不均匀，可以先把原表主键翻转作为 RowKey。</li>
<li>优点：<ul>
<li>同一条数据只会生成一个 RowKey，不会重复数据。</li>
<li>极大的提高了写入数据的吞吐量，保障所有的 Region 负载均衡。</li>
<li>对通过 RowKey 得到一条数据十分有利。</li>
</ul>
</li>
<li>缺点：<ul>
<li>不利于全表查询数据，由于 RowKey 是通过 Hash 之后计算出来的，数据只根据 RowKey 进行排序，原始的数据则是无序的。</li>
<li>原表主键要是手机号、身份证号这种类型的。</li>
</ul>
</li>
</ul>
<h5 id="6-2-4-单调递增-RowKey"><a href="#6-2-4-单调递增-RowKey" class="headerlink" title="6.2.4 单调递增 RowKey"></a>6.2.4 单调递增 RowKey</h5><ul>
<li>单调递增的行键</li>
<li>客户端的请求都通过 这个 Region 响应，当这个 Region 写完了之后才会进行其他 Region 的写的操作。</li>
</ul>
<h5 id="6-2-5-倒序时间戳-RowKey"><a href="#6-2-5-倒序时间戳-RowKey" class="headerlink" title="6.2.5 倒序时间戳 RowKey"></a>6.2.5 倒序时间戳 RowKey</h5><ul>
<li>把时间戳倒序作为 RowKey</li>
</ul>
<h3 id="7-协处理器"><a href="#7-协处理器" class="headerlink" title="7. 协处理器"></a>7. 协处理器</h3><ul>
<li>协处理器作用是类似于触发器的作用，再把数据写入到 HBase 的时候，会同步写入到 ES（ElasticSearch） 里面，有时候由于业务的原因，需要 OLAP，HBase 重写轻读，不能更好的处理业务，则需要引用 ES ，把 Hbase 中的数据下发到 ES 里面。</li>
</ul>
<h4 id="7-1-POM-文件"><a href="#7-1-POM-文件" class="headerlink" title="7.1 POM 文件"></a>7.1 POM 文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;7.9.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.hbase&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hbase-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.0-cdh5.16.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.hbase&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hbase-server&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.0-cdh5.16.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-lang3&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.11&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-Code"><a href="#7-2-Code" class="headerlink" title="7.2 Code"></a>7.2 Code</h4><h5 id="7-2-1-ESUtils-Code"><a href="#7-2-1-ESUtils-Code" class="headerlink" title="7.2.1 ESUtils Code"></a>7.2.1 ESUtils Code</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.hbase.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ESUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ElasticSearch的集群名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String clusterName;</span><br><span class="line">    <span class="comment">// ElasticSearch的host</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String nodeHost;</span><br><span class="line">    <span class="comment">// ElasticSearch的端口（Java API用的是Transport端口，也就是TCP）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> nodePort;</span><br><span class="line">    <span class="comment">// ElasticSearch的索引名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String indexName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">iniClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        client = <span class="keyword">new</span> RestHighLevelClient(RestClient.builder(</span><br><span class="line">                <span class="keyword">new</span> HttpHost(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>)</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到 ESUtils 里面配置的常量数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; fields = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Field f : ESUtils.class.getDeclaredFields()) &#123;</span><br><span class="line">                fields.add(f.getName() + <span class="string">&quot;=&quot;</span> + f.get(<span class="keyword">null</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> StringUtils.join(fields, <span class="string">&quot;, &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stopClient</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != client) &#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="7-2-2-HBaseElasticsearchObserver-Code"><a href="#7-2-2-HBaseElasticsearchObserver-Code" class="headerlink" title="7.2.2 HBaseElasticsearchObserver Code"></a>7.2.2 HBaseElasticsearchObserver Code</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.hbase.observer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xk.bigdata.hbase.utils.ESUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.Cell;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.CellUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.CoprocessorEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Durability;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.coprocessor.BaseRegionObserver;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.coprocessor.ObserverContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.coprocessor.RegionCoprocessorEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.regionserver.wal.WALEdit;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.DocWriteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.NavigableMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBaseElasticsearchObserver</span> <span class="keyword">extends</span> <span class="title">BaseRegionObserver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log LOG = LogFactory.getLog(HBaseElasticsearchObserver.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取配置文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> env 上下文</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readConfiguration</span><span class="params">(CoprocessorEnvironment env)</span> </span>&#123;</span><br><span class="line">        Configuration conf = env.getConfiguration();</span><br><span class="line">        ESUtils.clusterName = conf.get(<span class="string">&quot;es_cluster&quot;</span>);</span><br><span class="line">        ESUtils.nodeHost = conf.get(<span class="string">&quot;es_host&quot;</span>);</span><br><span class="line">        ESUtils.nodePort = conf.getInt(<span class="string">&quot;es_port&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">        ESUtils.indexName = conf.get(<span class="string">&quot;es_index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开始之前执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(CoprocessorEnvironment e)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 读取配置文件</span></span><br><span class="line">        readConfiguration(e);</span><br><span class="line">        <span class="comment">// 初始化 ES</span></span><br><span class="line">        ESUtils.iniClient();</span><br><span class="line">        LOG.error(<span class="string">&quot;------observer init EsClient ------&quot;</span> + ESUtils.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">(CoprocessorEnvironment e)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ESUtils.stopClient();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postPut</span><span class="params">(ObserverContext&lt;RegionCoprocessorEnvironment&gt; e, Put put, WALEdit edit, Durability durability)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String indexId = <span class="keyword">new</span> String(put.getRow());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            NavigableMap&lt;<span class="keyword">byte</span>[], List&lt;Cell&gt;&gt; familyMap = put.getFamilyCellMap();</span><br><span class="line">            Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;<span class="keyword">byte</span>[], List&lt;Cell&gt;&gt; entry : familyMap.entrySet()) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Cell cell : entry.getValue()) &#123;</span><br><span class="line">                    String key = Bytes.toString(CellUtil.cloneQualifier(cell));</span><br><span class="line">                    String value = Bytes.toString(CellUtil.cloneValue(cell));</span><br><span class="line">                    map.put(key, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(ESUtils.indexName).id(indexId);</span><br><span class="line">            indexRequest.source(map);</span><br><span class="line">            IndexResponse indexResponse =</span><br><span class="line">                    ESUtils.client.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (indexResponse.getResult() == DocWriteResponse.Result.CREATED) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;create success:&quot;</span> + ESUtils.indexName + <span class="string">&quot; : &quot;</span> + indexId);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (indexResponse.getResult() == DocWriteResponse.Result.UPDATED) &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;update success: &quot;</span> + ESUtils.indexName + <span class="string">&quot; : &quot;</span> + indexId);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;create/update fail: &quot;</span> + ESUtils.indexName + <span class="string">&quot; : &quot;</span> + indexId + <span class="string">&quot; : &quot;</span> + indexResponse.getResult().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            LOG.error(ex);</span><br><span class="line">            LOG.error(<span class="string">&quot;observer put  a doc, index [ &quot;</span> + ESUtils.indexName + <span class="string">&quot; ]&quot;</span> + <span class="string">&quot;indexId [&quot;</span> + indexId + <span class="string">&quot;] error : &quot;</span> + ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postDelete</span><span class="params">(ObserverContext&lt;RegionCoprocessorEnvironment&gt; e, Delete delete, WALEdit edit, Durability durability)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String indexId = <span class="keyword">new</span> String(delete.getRow());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DeleteRequest request = <span class="keyword">new</span> DeleteRequest(</span><br><span class="line">                    ESUtils.indexName,</span><br><span class="line">                    indexId);</span><br><span class="line"></span><br><span class="line">            DeleteResponse deleteResponse = ESUtils.client.delete(</span><br><span class="line">                    request, RequestOptions.DEFAULT);</span><br><span class="line">            <span class="keyword">if</span> (deleteResponse.getResult() == DocWriteResponse.Result.DELETED) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;delete success: &quot;</span> + ESUtils.indexName + <span class="string">&quot; : &quot;</span> + indexId);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;delete fail: &quot;</span> + ESUtils.indexName + <span class="string">&quot; : &quot;</span> + indexId + <span class="string">&quot; : &quot;</span> + deleteResponse.getResult().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            LOG.error(ex);</span><br><span class="line">            LOG.error(<span class="string">&quot;observer delete  a doc, index [ &quot;</span> + ESUtils.indexName + <span class="string">&quot; ]&quot;</span> + <span class="string">&quot;indexId [&quot;</span> + indexId + <span class="string">&quot;] error : &quot;</span> + ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-3-增加协处理器"><a href="#7-3-增加协处理器" class="headerlink" title="7.3 增加协处理器"></a>7.3 增加协处理器</h4><ul>
<li>上传 Jar 到 HDFS </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata ~]$ cd lib&#x2F;</span><br><span class="line">[hadoop@bigdata lib]$ ll</span><br><span class="line">总用量 88052</span><br><span class="line">-rw-r--r--. 1 hadoop hadoop 90161640 2月   6 21:16 hbase-basic-1.0-jar-with-dependencies.jar</span><br><span class="line">[hadoop@bigdata lib]$ hadoop fs -mkdir &#x2F;lib</span><br><span class="line">21&#x2F;02&#x2F;06 21:17:42 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">[hadoop@bigdata lib]$ hadoop fs -put hbase-basic-1.0-jar-with-dependencies.jar &#x2F;lib</span><br><span class="line">21&#x2F;02&#x2F;06 21:18:01 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br></pre></td></tr></table></figure>

<ul>
<li>添加协处理器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata lib]$ cd ~</span><br><span class="line">[hadoop@bigdata ~]$ cd app&#x2F;hbase</span><br><span class="line">[hadoop@bigdata hbase]$ bin&#x2F;hbase shell</span><br><span class="line"></span><br><span class="line">hbase(main):001:0&gt; create &#39;hbasetoes&#39;,&#39;info&#39;</span><br><span class="line">0 row(s) in 1.4130 seconds</span><br><span class="line"></span><br><span class="line">&#x3D;&gt; Hbase::Table - hbasetoes</span><br><span class="line">hbase(main):002:0&gt; disable &#39;hbasetoes&#39;</span><br><span class="line">0 row(s) in 2.3290 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):003:0&gt; alter &#39;hbasetoes&#39;, METHOD &#x3D;&gt; &#39;table_att&#39;,&#39;coprocessor&#39;&#x3D;&gt;&#39;hdfs:&#x2F;&#x2F;bigdata:9000&#x2F;lib&#x2F;hbase-basic-1.0-jar-with-dependencies.jar|com.xk.bigdata.hbase.observer.HBaseElasticsearchObserver|1001|es_cluster&#x3D;hbasetoes_es,es_host&#x3D;bigdata,es_port&#x3D;9200,es_index&#x3D;hbasetoes_index&#39;</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">1&#x2F;1 regions updated.</span><br><span class="line">Done.</span><br><span class="line">0 row(s) in 1.9500 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):004:0&gt; enable &#39;hbasetoes&#39;</span><br><span class="line">0 row(s) in 4.2700 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):005:0&gt; put &#39;hbasetoes&#39;,&#39;key1&#39;,&#39;info:c1&#39;,&#39;100&#39;</span><br><span class="line">0 row(s) in 1.1430 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):006:0&gt; put &#39;hbasetoes&#39;,&#39;key1&#39;,&#39;info:c1&#39;,&#39;10&#39;</span><br><span class="line">0 row(s) in 0.0090 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 HBase Region Server 日志</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-02-06 22:58:57,314 ERROR [RS_OPEN_REGION-bigdata:60020-0] observer.HBaseElasticsearchObserver: ------observer init EsClient ------clusterName&#x3D;hbasetoes_es, nodeHost&#x3D;bigdata, nodePort&#x3D;9200, indexName&#x3D;hbasetoes_index, client&#x3D;org.elasticsearch.client.RestHighLevelClient@e099b57</span><br><span class="line">2021-02-06 22:58:57,315 INFO  [RS_OPEN_REGION-bigdata:60020-0] regionserver.RegionCoprocessorHost: Loaded coprocessor com.xk.bigdata.hbase.observer.HBaseElasticsearchObserver from HTD of hbasetoes successfully.</span><br></pre></td></tr></table></figure>

<ul>
<li>查询 es</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">GET hbasetoes_index&#x2F;_search</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 0,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 1,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : 1.0,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;hbasetoes_index&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;key1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;c1&quot; : &quot;10&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>卸载协处理器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):007:0&gt; disable &#39;hbasetoes&#39;</span><br><span class="line">0 row(s) in 2.2480 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):008:0&gt; alter &#39;hbasetoes&#39;, METHOD &#x3D;&gt; &#39;table_att_unset&#39;, NAME &#x3D;&gt; &#39;coprocessor$1&#39;</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">1&#x2F;1 regions updated.</span><br><span class="line">Done.</span><br><span class="line">0 row(s) in 1.8960 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):009:0&gt; enable &#39;hbasetoes&#39;</span><br><span class="line">0 row(s) in 1.2380 seconds</span><br></pre></td></tr></table></figure>

<h4 id="7-4-报错"><a href="#7-4-报错" class="headerlink" title="7.4 报错"></a>7.4 报错</h4><ul>
<li>报错内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.NoClassDefFoundError: org&#x2F;apache&#x2F;http&#x2F;client&#x2F;config</span><br></pre></td></tr></table></figure>

<ul>
<li>排查原因，发现是 httpclient、guava 冲突，具体的 POM 如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;hbase-project&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.xk.bigdata&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;hbase-basic&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hbase&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hbase-server&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;artifactId&gt;httpcore&lt;&#x2F;artifactId&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;artifactId&gt;guava&lt;&#x2F;artifactId&gt;</span><br><span class="line">                    &lt;groupId&gt;com.google.guava&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">            &lt;&#x2F;exclusions&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hbase&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hbase-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;exclusions&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">                &lt;exclusion&gt;</span><br><span class="line">                    &lt;artifactId&gt;httpcore&lt;&#x2F;artifactId&gt;</span><br><span class="line">                    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;&#x2F;exclusion&gt;</span><br><span class="line">            &lt;&#x2F;exclusions&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang3&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.5.13&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;&#x2F;encoding&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;descriptorRefs&gt;</span><br><span class="line">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;&#x2F;descriptorRef&gt;</span><br><span class="line">                    &lt;&#x2F;descriptorRefs&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;make-assembly&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;single&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>还有疑问可以翻看 GitHub上面代码</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Rayxk94/hbase-project/blob/main/hbase-basic/src/main/java/com/xk/bigdata/hbase/observer/HBaseElasticsearchObserver.java">GitHub 代码</a></p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">hbase</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2020/01/10/Hbase%20%E8%BF%9B%E9%98%B6/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Hbase 的基础入门" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2020/01/05/Hbase%20%E7%9A%84%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" target="_blank">Hbase 的基础入门</a>
  
    </h1>
  


  
  
<a href="/2020/01/05/Hbase%20%E7%9A%84%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" class="archive-article-date">
        <time datetime="2020-01-05T13:16:35.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-01-05</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="Hbase-的基础入门"><a href="#Hbase-的基础入门" class="headerlink" title="Hbase 的基础入门"></a><center>Hbase 的基础入门</center></h2><p><a target="_blank" rel="noopener" href="http://hbase.apache.org/">HBase 官网</a></p>
<ul>
<li>本次安装部署的是 cdh 5.16.2 系列</li>
</ul>
<h3 id="1-HBase-部署"><a href="#1-HBase-部署" class="headerlink" title="1. HBase 部署"></a>1. HBase 部署</h3><p><a target="_blank" rel="noopener" href="http://archive.cloudera.com/cdh5/cdh/5/hbase-1.2.0-cdh5.16.2.tar.gz">HBase 下载地址</a></p>
<h4 id="1-1-HBase-部署前提"><a href="#1-1-HBase-部署前提" class="headerlink" title="1.1 HBase 部署前提"></a>1.1 HBase 部署前提</h4><ul>
<li>需要部署 Hadoop，HBase 的数据最终存储在 HDFS 上面</li>
<li>需要部署Zookeeper，HBase 的元数据存储在 Zookeeper 上面</li>
</ul>
<h4 id="1-2-HBase-下载以及修改配置文件"><a href="#1-2-HBase-下载以及修改配置文件" class="headerlink" title="1.2 HBase 下载以及修改配置文件"></a>1.2 HBase 下载以及修改配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 ~]# cd software&#x2F;</span><br><span class="line">[root@bigdatatest01 software]# wget http:&#x2F;&#x2F;archive.cloudera.com&#x2F;cdh5&#x2F;cdh&#x2F;5&#x2F;hbase-1.2.0-cdh5.16.2.tar.gz</span><br><span class="line">[root@bigdatatest01 software]# tar -xzvf hbase-1.2.0-cdh5.16.2.tar.gz -C ~&#x2F;app&#x2F;</span><br><span class="line">[root@bigdatatest01 software]# cd ~&#x2F;app&#x2F;</span><br><span class="line">[root@bigdatatest01 app]# cd hbase-1.2.0-cdh5.16.2&#x2F;conf&#x2F;</span><br><span class="line">[root@bigdatatest01 conf]# ll</span><br><span class="line">total 40</span><br><span class="line">-rw-r--r-- 1 1106 4001 1811 Jun  3  2019 hadoop-metrics2-hbase.properties</span><br><span class="line">-rw-r--r-- 1 1106 4001 4603 Jun  3  2019 hbase-env.cmd</span><br><span class="line">-rw-r--r-- 1 1106 4001 7530 Jun  3  2019 hbase-env.sh</span><br><span class="line">-rw-r--r-- 1 1106 4001 2257 Jun  3  2019 hbase-policy.xml</span><br><span class="line">-rw-r--r-- 1 1106 4001  934 Jun  3  2019 hbase-site.xml</span><br><span class="line">-rw-r--r-- 1 1106 4001 4603 Jun  3  2019 log4j.properties</span><br><span class="line">-rw-r--r-- 1 1106 4001   10 Jun  3  2019 regionservers</span><br></pre></td></tr></table></figure>

<h4 id="1-3-修改配置文件"><a href="#1-3-修改配置文件" class="headerlink" title="1.3 修改配置文件"></a>1.3 修改配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 conf]# vim hbase-env.sh </span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_151</span><br><span class="line">export HBASE_MANAGES_ZK&#x3D;false</span><br><span class="line"></span><br><span class="line">[root@bigdatatest01 conf]# vim hbase-site.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type&#x3D;&quot;text&#x2F;xsl&quot; href&#x3D;&quot;configuration.xsl&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">        &lt;!--hbase.rootdir的前端与$HADOOP_HOME&#x2F;conf&#x2F;core-site.xml的fs.defaultFS一致 --&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.rootdir&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;hdfs:&#x2F;&#x2F;bigdatatest02:8020&#x2F;hbase&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.cluster.distributed&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!--本地文件系统的临时文件夹。可以修改到一个更为持久的目录上。(&#x2F;tmp会在重启时清除) --&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.tmp.dir&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;&#x2F;root&#x2F;tmp&#x2F;hbase&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!--如果只设置单个 Hmaster，那么 hbase.master 属性参数需要设置为 master5:60000 (主机名:60000) --&gt;</span><br><span class="line">                &lt;!--如果要设置多个 Hmaster，那么我们只需要提供端口 60000，因为选择真正的 master 的事情会有 zookeeper 去处理 --&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.master&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;60000&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!--这个参数用户设置 ZooKeeper 快照的存储位置，默认值为 &#x2F;tmp，显然在重启的时候会清空。因为笔者的 ZooKeeper 是独立安装的，所以这里路径是指向了 $ZOOKEEPER_HOME&#x2F;conf&#x2F;zoo.cfg 中 dataDir 所设定的位置 --&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.zookeeper.property.dataDir&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;&#x2F;root&#x2F;tmp&#x2F;zk1&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.zookeeper.quorum&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;bigdatatest01&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line">                &lt;!--表示客户端连接 ZooKeeper 的端口 --&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.zookeeper.property.clientPort&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;2181&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line">                &lt;!--ZooKeeper 会话超时。Hbase 把这个值传递改 zk 集群，向它推荐一个会话的最大超时时间 --&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;zookeeper.session.timeout&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;120000&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!--当 regionserver 遇到 ZooKeeper session expired ， regionserver 将选择 restart 而不是 abort --&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hbase.regionserver.restart.on.zk.expire&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br><span class="line">		&lt;property&gt;</span><br><span class="line">				&lt;name&gt;hbase.online.schema.update.enable&lt;&#x2F;name&gt;</span><br><span class="line">				&lt;value&gt;true&lt;&#x2F;value&gt;</span><br><span class="line">		&lt;&#x2F;property&gt;</span><br><span class="line"></span><br><span class="line">		&lt;property&gt;</span><br><span class="line">				&lt;name&gt;hbase.coprocessor.abortonerror&lt;&#x2F;name&gt;</span><br><span class="line">				&lt;value&gt;false&lt;&#x2F;value&gt;</span><br><span class="line">		&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br><span class="line"></span><br><span class="line">[root@bigdatatest01 conf]# vim regionservers</span><br><span class="line">bigdatatest01</span><br></pre></td></tr></table></figure>

<ul>
<li>HBASE_MANAGES_ZK：是否使用 HBase 内置的 Zookeeper</li>
</ul>
<h4 id="1-4-启动-HBase"><a href="#1-4-启动-HBase" class="headerlink" title="1.4 启动 HBase"></a>1.4 启动 HBase</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 conf]# cd ..&#x2F;</span><br><span class="line">[root@bigdatatest01 hbase-1.2.0-cdh5.16.2]# bin&#x2F;start-hbase.</span><br><span class="line">start-hbase.cmd  start-hbase.sh   </span><br><span class="line">[root@bigdatatest01 hbase-1.2.0-cdh5.16.2]# bin&#x2F;start-hbase.sh </span><br><span class="line">starting master, logging to &#x2F;root&#x2F;app&#x2F;hbase-1.2.0-cdh5.16.2&#x2F;bin&#x2F;..&#x2F;logs&#x2F;hbase-root-master-bigdatatest01.out</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line">The authenticity of host &#39;bigdatatest01 (192.168.20.66)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:ubGg3eXeUXlLZLkDjezmag&#x2F;lpWFbRFEl30lMiQ&#x2F;Is6M.</span><br><span class="line">ECDSA key fingerprint is MD5:eb:fa:c5:d9:2a:2e:d5:18:39:fc:41:18:8c:4a:76:f6.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no)? yes</span><br><span class="line">bigdatatest01: Warning: Permanently added &#39;bigdatatest01&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">bigdatatest01: starting regionserver, logging to &#x2F;root&#x2F;app&#x2F;hbase-1.2.0-cdh5.16.2&#x2F;bin&#x2F;..&#x2F;logs&#x2F;hbase-root-regionserver-bigdatatest01.out</span><br><span class="line">bigdatatest01: Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line">bigdatatest01: Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br></pre></td></tr></table></figure>

<ul>
<li>遇到报错</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.AccessControlException): Permission denied: user&#x3D;root, access&#x3D;WRITE, inode&#x3D;&quot;&#x2F;hbase&quot;:hbase:hbase:drwxr-xr-x</span><br></pre></td></tr></table></figure>

<ul>
<li>解决报错</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 ~]# su - hdfs</span><br><span class="line">Last login: Tue Feb  2 10:31:56 CST 2021 on pts&#x2F;1</span><br><span class="line">[hdfs@bigdatatest01 ~]$ hadoop fs -chmod 777 &#x2F;hbase</span><br></pre></td></tr></table></figure>

<ul>
<li>重启服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 hbase-1.2.0-cdh5.16.2]# bin&#x2F;stop-hbase.sh </span><br><span class="line">stopping hbasecat: &#x2F;tmp&#x2F;hbase-root-master.pid: No such file or directory</span><br><span class="line"></span><br><span class="line">[root@bigdatatest01 hbase-1.2.0-cdh5.16.2]# bin&#x2F;start-hbase.sh </span><br><span class="line">starting master, logging to &#x2F;root&#x2F;app&#x2F;hbase-1.2.0-cdh5.16.2&#x2F;bin&#x2F;..&#x2F;logs&#x2F;hbase-root-master-bigdatatest01.out</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line">bigdatatest01: regionserver running as process 26211. Stop it first.</span><br></pre></td></tr></table></figure>

<ul>
<li>查看日志，发现权限依旧不足</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.AccessControlException): Permission denied: user&#x3D;root, access&#x3D;ALL, inode&#x3D;&quot;&#x2F;hbase&#x2F;.tmp&quot;:hbase:hbase:drwxr-xr-x</span><br></pre></td></tr></table></figure>

<ul>
<li>增加 /hbase/.tmp 权限</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hdfs@bigdatatest01 ~]$ hadoop fs -chmod 777 &#x2F;hbase&#x2F;.tmp</span><br><span class="line">[hdfs@bigdatatest01 ~]$ hadoop fs -chmod -R  777 &#x2F;hbase&#x2F;.tmp</span><br><span class="line">[hdfs@bigdatatest01 ~]$ hadoop fs -chmod -R  777 &#x2F;hbase</span><br></pre></td></tr></table></figure>

<ul>
<li>重启 Hbase 服务</li>
<li>jps 查看服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 hbase-1.2.0-cdh5.16.2]# jps</span><br><span class="line">800 QuorumPeerMain</span><br><span class="line">26211 HRegionServer</span><br><span class="line">1060 Jps</span><br><span class="line">525 QuorumPeerMain</span><br><span class="line">18994 DataNode</span><br><span class="line">32374 HMaster</span><br><span class="line">19354 NodeManager</span><br><span class="line">669 QuorumPeerMain</span><br></pre></td></tr></table></figure>

<ul>
<li>HBase 是主从架构</li>
<li>HMaster：主节点</li>
<li>HRegionServer：子节点</li>
</ul>
<h3 id="2-HBase-架构"><a href="#2-HBase-架构" class="headerlink" title="2. HBase 架构"></a>2. HBase 架构</h3><p><img src="/img/hbase/HBase%E6%9E%B6%E6%9E%84.png" alt="HBase 架构"></p>
<ul>
<li>Client：<ul>
<li>HBase 有一张特殊表：META<ul>
<li>META.：记录了用户所有表拆分出来的的 Region 映射信息，META 可以有多个 Regoin 。</li>
</ul>
</li>
<li> Client 访问用户数据前需要首先访问 ZooKeeper，找到 META 表的 Region 所在的位置，然后才能找到用户数据的位置去访问，中间需要多次网络操作，不过 client 端会做 cache 缓存。</li>
</ul>
</li>
<li>ZooKeeper：<ul>
<li>ZooKeeper 为 HBase 提供 Failover 机制，选举 Master，避免单点 Master 单点故障问题。</li>
<li>实时监控 RegionServer 的状态，将 RegionServer 的上线和下线信息实时通知给 Master。</li>
<li>存储 HBase 的 Schema，包括有哪些 Table，每个 Table 有哪些 Column Family。</li>
<li>存储 hbase:meta 表的地址和 Master 地址</li>
</ul>
</li>
<li>Master：<ul>
<li>为 RegionServer 分配 Region。</li>
<li>负责 RegionServer 的负载均衡。</li>
<li>发现失效的 RegionServer 并重新分配其上的 Region。</li>
<li>HDFS 上的垃圾文件（HBase）回收。</li>
<li>处理 Schema 更新请求（表的创建，删除，修改，列簇的增加等等）。</li>
</ul>
</li>
<li>RegionServer：<ul>
<li>RegionServer 维护 Master 分配给它的 Region，处理对这些 Region 的 IO 请求。</li>
<li>RegionServer 负责 Split 在运行过程中变得过大的 Region，负责 Compact 操作。<ul>
<li>可以看到，client 访问 HBase 上数据的过程并不需要 Master 参与（寻址访问 Zookeeper 和 RegioneServer，数据读写访问 RegioneServer），Master 仅仅维护者 Table 和 Region 的元数据信息，负载很低。</li>
<li>META 存的是所有的 Region 的位置信息，那么 RegioneServer 当中 Region 在进行分裂之后 的新产生的 Region，是由 Master 来决定发到哪个 RegioneServer，这就意味着，只有 Master 知道 new Region 的位置信息，所以，由 Master 来管理 META 这个表当中的数据的 CRUD。</li>
<li>所以结合以上两点表明，在没有 Region 分裂的情况，Master 宕机一段时间是可以忍受的。</li>
</ul>
</li>
</ul>
</li>
<li>HRegion：<ul>
<li>Table 在行的方向上分隔为多个Region。Region是HBase中分布式存储和负载均衡的最小单元，即不同的 Region 可以分别在不同的 Region Server 上，但同一个Region是不会拆分到多个 Server 上。</li>
<li>Region按大小分隔，每个表一般是只有一个 Region。随着数据不断插入表，Region不断增大，当 Region 的某个列族达到一个阈值时就会分成两个新的 Region。</li>
<li>每个 Region 由以下信息标识：&lt; 表名,startRowkey,创建时间&gt;。</li>
<li>由目录表( META )记录该 Region 的 endRowkey。</li>
</ul>
</li>
<li>Store：<ul>
<li>每一个 Region 由一个或多个 Store 组成，至少是一个 Store，HBase会把一起访问的数据放在一个 Store 里面，即为每个 ColumnFamily 建一个 Store，如果有几个ColumnFamily，也就有几个 Store。一个 Store由一个 MemStore和0或者 多个 StoreFile组成。 HBase以 Store的大小来判断是否需要切分 Region。</li>
</ul>
</li>
<li>MemStore：<ul>
<li>MemStore 是放在内存里的。保存修改的数据即keyValues。当 MemStore 的大小达到一个阀值（默认128MB）时，MemStore会被flush到文 件，即生成一个快照。目前 HBase 会有一个线程来负责MemStore的flush操作。 </li>
</ul>
</li>
<li>StoreFile：<ul>
<li>MemStore内存中的数据写到文件后就是 StoreFile，StoreFile底层是以 HFile的格式保存。当 StoreFile文件的数量增长到一定阈值后，系统会进行合并（minor、major compaction），在合并过程中会进行版本合并和删除工作（majar），形成更大的 StoreFile。</li>
</ul>
</li>
<li>HFile：<ul>
<li> HBase中KeyValue数据的存储格式，HFile是Hadoop的 二进制格式文件，实际上 StoreFile 就是对 Hfile 做了轻量级包装，即 StoreFile 底层就是 HFile。</li>
</ul>
</li>
<li>HLog：<ul>
<li>HLog(WAL log)：WAL意为 Write Ahead Log，用来做灾难恢复使用，HLog记录数据的所有变更，一旦 Region Server 宕机，就可以从 HLog 中进行恢复。</li>
<li>HLog文件就是一个普通的Hadoop Sequence File， Sequence File的value是key时HLogKey对象，其中记录了写入数据的归属信息，除了 Table 和 Region 名字外，还同时包括 sequence number和timestamp，timestamp是写入时间，sequence number的起始值为0，或者是最近一次存入文件系统中的sequence number。 Sequence File的value是HBase的KeyValue对象，即对应HFile中的KeyValue。</li>
</ul>
</li>
<li>BlockCache：读取中的缓存。<ul>
<li>存储在 RegionServer 中，一个 RegionServer 只会有一个 BlockCache。</li>
<li>在 RegionServer 启动时完成 BlockCache 初始化的工作。</li>
</ul>
</li>
</ul>
<h3 id="3-HBase-物理存储模型"><a href="#3-HBase-物理存储模型" class="headerlink" title="3. HBase 物理存储模型"></a>3. HBase 物理存储模型</h3><p><img src="/img/hbase/HBase%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B.png" alt="HBase 物理存储模型"></p>
<ul>
<li>HBase 每个单元格包含的数据：<ul>
<li>RowKey：主键。</li>
<li>Column Family：列簇，把表竖向切割，一个表中可以有多个列簇，一个列簇下面有多个字段。</li>
<li>Column：字段。</li>
<li>Version Number：long类型 默认是系统时间戳  用户也自定义。</li>
<li>value：存储的值。</li>
</ul>
</li>
<li>Table 中的所有行都按照 RowKey 的字典序排列。</li>
<li>Table 在行的方向上分割为多个 HRegion。</li>
<li>HRegion 按大小分割的，每个表一开始只有一个 HRegion，随着数据不断插入 表，HRegion 不断增大，当增大到一个阀值的时候，HRegion 就会等分会两个新的 HRegion。 当表中的行不断增多，就会有越来越多的 HRegion。</li>
<li>HRegion 是 Hbase 中分布式存储和负载均衡的最小单元。最小单元就表示不同的 HRegion 可以分布在不同的 HRegion Server 上。但一个 HRegion 是不会拆分到多个 Server 上的。</li>
<li>HRegion 虽然是负载均衡的最小单元，但并不是物理存储的最小单元。事实上，HRegion 由一个或者多个 Store 组成，每个 Store 保存一个 Column Family。每个 Strore 又由一个 MemStore 和 0 至多个 StoreFile 组成。</li>
</ul>
<h3 id="4-HBase-读写流程"><a href="#4-HBase-读写流程" class="headerlink" title="4. HBase 读写流程"></a>4. HBase 读写流程</h3><ul>
<li>HBase 一次范围查询可能涉及多个 Region 、多个 MemStore，甚至是多个 StoreFile。</li>
<li>HBase 的更新、删除操作底层实现都是往 HBase 里面插入一笔数据，都没有真正的更新真正的数据，而是通过时间戳来实现多个版本，删除操作也没有真正的删除原始数据，而且打了一个 delete 的标签，类似于我们通常所说的逻辑删除。</li>
<li>这种操作极大的简化了更新、删除操作，但是给读取数据带了一些压力。通过多个版本和删除标记进行过滤。</li>
</ul>
<h4 id="4-1-HBase-读流程"><a href="#4-1-HBase-读流程" class="headerlink" title="4.1 HBase 读流程"></a>4.1 HBase 读流程</h4><p><img src="/img/hbase/HBase%E8%AF%BB%E6%B5%81%E7%A8%8B.png" alt="HBase 读流程"></p>
<ul>
<li>Client 发送读取数据的请求。</li>
<li>先去 Zookeeper 里面获取 hbase:meta 表所在的 Region 节点。</li>
<li>base:meta 表中根据 RowKey 确定目标 RegionServer 所在的节点以及 Region 信息。</li>
<li>读取顺序：MemStore –&gt; BlockCache –&gt; HFile 文件</li>
<li>将读请求进行封装，发送给 RegionServer 节点，RegionServer 收到读取数据的请求后，解析数据，查询出所有的数据后并返回。</li>
</ul>
<h4 id="4-2-HBase-写流程"><a href="#4-2-HBase-写流程" class="headerlink" title="4.2 HBase 写流程"></a>4.2 HBase 写流程</h4><p><img src="/img/hbase/HBase%E5%86%99%E6%B5%81%E7%A8%8B.png" alt="HBase 写流程"></p>
<ul>
<li>Client 发送写数据的请求。</li>
<li>先去 Zookeeper 里面获取 hbase:meta 表所在的 Region 节点。</li>
<li>base:meta 表中根据 RowKey 确定目标 RegionServer 所在的节点以及 Region 信息。</li>
<li>将写请求与对应的 RegionServer 进行通信，RegionServer 接收到写请求，解析数据，先写到 HLog，再写对应 Region 列簇 Store 中的 MemStore。</li>
<li>当 MemStore 触发异步 Flush，把内存中 MemStore 写入到 StoreFile 文件中。</li>
</ul>
<h3 id="5-HBase-Shell"><a href="#5-HBase-Shell" class="headerlink" title="5. HBase Shell"></a>5. HBase Shell</h3><h4 id="5-1-查看帮助命令"><a href="#5-1-查看帮助命令" class="headerlink" title="5.1 查看帮助命令"></a>5.1 查看帮助命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):005:0&gt; help</span><br></pre></td></tr></table></figure>

<h4 id="5-2-创建一个-namespace"><a href="#5-2-创建一个-namespace" class="headerlink" title="5.2 创建一个 namespace"></a>5.2 创建一个 namespace</h4><ul>
<li>HBase 中的 namespace 类似于 ORACLE 中的 schema、Mysql 中的 database</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Group name: namespace</span><br><span class="line">  Commands: alter_namespace, create_namespace, describe_namespace, drop_namespace, list_namespace, list_namespace_tables</span><br></pre></td></tr></table></figure>

<ul>
<li>alter_namespace：修改 namespace </li>
<li>create_namespace：创建 namespace</li>
<li>describe_namespace：namespace 的描述</li>
<li>drop_namespace：删除 namespace</li>
<li>list_namespace：namespace 列表</li>
<li>list_namespace_tables + ‘$namespace 名称’：查询 namespace 下面的所有</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):014:0&gt; create_namespace &#39;test&#39;</span><br><span class="line">Took 0.7759 seconds</span><br><span class="line">hbase(main):015:0&gt; list_namespace</span><br><span class="line">NAMESPACE</span><br><span class="line">SYSTEM</span><br><span class="line">bigdata</span><br><span class="line">default</span><br><span class="line">hbase</span><br><span class="line">test</span><br><span class="line">8 row(s)</span><br><span class="line">Took 0.0082 seconds</span><br><span class="line">hbase(main):016:0&gt; list_namespace_tables &#39;test&#39;</span><br><span class="line">TABLE</span><br><span class="line">0 row(s)</span><br><span class="line">Took 0.0060 seconds</span><br></pre></td></tr></table></figure>

<h4 id="5-3-创建一个表"><a href="#5-3-创建一个表" class="headerlink" title="5.3 创建一个表"></a>5.3 创建一个表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Group name: ddl</span><br><span class="line"> Commands: alter, alter_async, alter_status, clone_table_schema, create, describe, disable, disable_all, drop, drop_all, enable, enable_all, exists, get_table, is_disabled, is_enabled, list, list_regions, locate_region, show_filters</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 create 的命令帮助</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):020:0&gt; help &#39;create&#39;</span><br><span class="line">Creates a table. Pass a table name, and a set of column family</span><br><span class="line">specifications (at least one), and, optionally, table configuration.</span><br><span class="line">Column specification can be a simple string (name), or a dictionary</span><br><span class="line">(dictionaries are described below in main help output), necessarily</span><br><span class="line">including NAME attribute.</span><br><span class="line">Examples:</span><br><span class="line"></span><br><span class="line">Create a table with namespace&#x3D;ns1 and table qualifier&#x3D;t1</span><br><span class="line">  hbase&gt; create &#39;ns1:t1&#39;, &#123;NAME &#x3D;&gt; &#39;f1&#39;, VERSIONS &#x3D;&gt; 5&#125;</span><br><span class="line"></span><br><span class="line">Create a table with namespace&#x3D;default and table qualifier&#x3D;t1</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#123;NAME &#x3D;&gt; &#39;f1&#39;&#125;, &#123;NAME &#x3D;&gt; &#39;f2&#39;&#125;, &#123;NAME &#x3D;&gt; &#39;f3&#39;&#125;</span><br><span class="line">  hbase&gt; # The above in shorthand would be the following:</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#39;f1&#39;, &#39;f2&#39;, &#39;f3&#39;</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#123;NAME &#x3D;&gt; &#39;f1&#39;, VERSIONS &#x3D;&gt; 1, TTL &#x3D;&gt; 2592000, BLOCKCACHE &#x3D;&gt; true&#125;</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#123;NAME &#x3D;&gt; &#39;f1&#39;, CONFIGURATION &#x3D;&gt; &#123;&#39;hbase.hstore.blockingStoreFiles&#39; &#x3D;&gt; &#39;10&#39;&#125;&#125;</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#123;NAME &#x3D;&gt; &#39;f1&#39;, IS_MOB &#x3D;&gt; true, MOB_THRESHOLD &#x3D;&gt; 1000000, MOB_COMPACT_PARTITION_POLICY &#x3D;&gt; &#39;weekly&#39;&#125;</span><br><span class="line"></span><br><span class="line">Table configuration options can be put at the end.</span><br><span class="line">Examples:</span><br><span class="line"></span><br><span class="line">  hbase&gt; create &#39;ns1:t1&#39;, &#39;f1&#39;, SPLITS &#x3D;&gt; [&#39;10&#39;, &#39;20&#39;, &#39;30&#39;, &#39;40&#39;]</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#39;f1&#39;, SPLITS &#x3D;&gt; [&#39;10&#39;, &#39;20&#39;, &#39;30&#39;, &#39;40&#39;]</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#39;f1&#39;, SPLITS_FILE &#x3D;&gt; &#39;splits.txt&#39;, OWNER &#x3D;&gt; &#39;johndoe&#39;</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#123;NAME &#x3D;&gt; &#39;f1&#39;, VERSIONS &#x3D;&gt; 5&#125;, METADATA &#x3D;&gt; &#123; &#39;mykey&#39; &#x3D;&gt; &#39;myvalue&#39; &#125;</span><br><span class="line">  hbase&gt; # Optionally pre-split the table into NUMREGIONS, using</span><br><span class="line">  hbase&gt; # SPLITALGO (&quot;HexStringSplit&quot;, &quot;UniformSplit&quot; or classname)</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#39;f1&#39;, &#123;NUMREGIONS &#x3D;&gt; 15, SPLITALGO &#x3D;&gt; &#39;HexStringSplit&#39;&#125;</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#39;f1&#39;, &#123;NUMREGIONS &#x3D;&gt; 15, SPLITALGO &#x3D;&gt; &#39;HexStringSplit&#39;, REGION_REPLICATION &#x3D;&gt; 2, CONFIGURATION &#x3D;&gt; &#123;&#39;hbase.hregion.scan.loadColumnFamiliesOnDemand&#39; &#x3D;&gt; &#39;true&#39;&#125;&#125;</span><br><span class="line">  hbase&gt; create &#39;t1&#39;, &#123;NAME &#x3D;&gt; &#39;f1&#39;, DFS_REPLICATION &#x3D;&gt; 1&#125;</span><br><span class="line"></span><br><span class="line">You can also keep around a reference to the created table:</span><br><span class="line"></span><br><span class="line">  hbase&gt; t1 &#x3D; create &#39;t1&#39;, &#39;f1&#39;</span><br><span class="line"></span><br><span class="line">Which gives you a reference to the table named &#39;t1&#39;, on which you can then</span><br></pre></td></tr></table></figure>

<ul>
<li>创建表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):021:0&gt; create &#39;test:demo&#39;, &#39;o&#39;</span><br><span class="line">Created table test:demo</span><br><span class="line">Took 1.3342 seconds</span><br><span class="line">&#x3D;&gt; Hbase::Table - test:demo</span><br></pre></td></tr></table></figure>

<h4 id="5-4-CRUD"><a href="#5-4-CRUD" class="headerlink" title="5.4 CRUD"></a>5.4 CRUD</h4><h5 id="5-4-1-插入数据"><a href="#5-4-1-插入数据" class="headerlink" title="5.4.1 插入数据"></a>5.4.1 插入数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):028:0&gt; put &#39;test:demo&#39;, &#39;row1&#39; , &#39;o:id&#39;, &#39;1&#39;</span><br><span class="line">Took 0.0427 seconds</span><br></pre></td></tr></table></figure>

<h5 id="5-4-2-查看所有数据"><a href="#5-4-2-查看所有数据" class="headerlink" title="5.4.2 查看所有数据"></a>5.4.2 查看所有数据</h5><ul>
<li>查看表中所有的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):022:0&gt; scan &#39;test:demo&#39;</span><br><span class="line">ROW                                                         COLUMN+CELL</span><br><span class="line">0 row(s)</span><br><span class="line">Took 0.0342 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>查看一行的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):029:0&gt; get &#39;test:demo&#39;,&#39;row1&#39;</span><br><span class="line">COLUMN                                                      CELL</span><br><span class="line"> o:id                                                       timestamp&#x3D;1612256670990, value&#x3D;1</span><br><span class="line"> 1 row(s)</span><br><span class="line">Took 0.0230 seconds </span><br></pre></td></tr></table></figure>

<h5 id="5-4-3-更新数据"><a href="#5-4-3-更新数据" class="headerlink" title="5.4.3 更新数据"></a>5.4.3 更新数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):030:0&gt; put &#39;test:demo&#39;, &#39;row1&#39; , &#39;o:id&#39;, &#39;2&#39;</span><br><span class="line">Took 0.0094 seconds</span><br><span class="line">hbase(main):031:0&gt; get &#39;test:demo&#39;,&#39;row1&#39;</span><br><span class="line">COLUMN                                                      CELL</span><br><span class="line"> o:id                                                       timestamp&#x3D;1612256869333, value&#x3D;2</span><br><span class="line"> 1 row(s)</span><br><span class="line">Took 0.0123 seconds </span><br></pre></td></tr></table></figure>

<h5 id="5-4-4-删除数据"><a href="#5-4-4-删除数据" class="headerlink" title="5.4.4 删除数据"></a>5.4.4 删除数据</h5><ul>
<li>删除数据：只能删除最新版本的数据，如果这个数据有多个版本，删除这个单元格数据，会显示上个版本这个单元格的数据。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):032:0&gt; delete &#39;test:demo&#39;, &#39;row1&#39;, &#39;o:id&#39;</span><br><span class="line">Took 0.0161 seconds</span><br><span class="line">hbase(main):033:0&gt; get &#39;test:demo&#39;,&#39;row1&#39;</span><br><span class="line">COLUMN                                                      CELL</span><br><span class="line"> o:id                                                       timestamp&#x3D;1612256670990, value&#x3D;1</span><br><span class="line"> 1 row(s)</span><br><span class="line">Took 0.0072 seconds </span><br></pre></td></tr></table></figure>

<h3 id="6-HBase-API-CRUD"><a href="#6-HBase-API-CRUD" class="headerlink" title="6. HBase API CRUD"></a>6. HBase API CRUD</h3><h4 id="6-1-POM-文件"><a href="#6-1-POM-文件" class="headerlink" title="6.1 POM 文件"></a>6.1 POM 文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.hbase&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hbase-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.0-cdh5.16.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.hbase&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hbase-server&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.0-cdh5.16.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="6-2-HBaseUtils-Code"><a href="#6-2-HBaseUtils-Code" class="headerlink" title="6.2 HBaseUtils Code"></a>6.2 HBaseUtils Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.hbase.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBaseUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection connection;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> zookeeperQuorum ： Zookeeper 连接地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(String zookeeperQuorum)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration hbaseConf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        hbaseConf.set(HConstants.ZOOKEEPER_QUORUM, zookeeperQuorum);</span><br><span class="line">        Configuration conf = HBaseConfiguration.create(hbaseConf);</span><br><span class="line">        connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!connection.isClosed()) &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName ：表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> familys   ：列簇数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">(String tableName, String[] familys)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Admin admin = connection.getAdmin();</span><br><span class="line">        <span class="keyword">if</span> (admin.tableExists(TableName.valueOf(tableName))) &#123;</span><br><span class="line">            System.out.println(tableName + <span class="string">&quot;已经存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            HTableDescriptor tableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(tableName));</span><br><span class="line">            <span class="keyword">for</span> (String family : familys) &#123;</span><br><span class="line">                tableDescriptor.addFamily(<span class="keyword">new</span> HColumnDescriptor(family));</span><br><span class="line">            &#125;</span><br><span class="line">            admin.createTable(tableDescriptor);</span><br><span class="line">            System.out.println(tableName + <span class="string">&quot;创建成功！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName ： 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey    ： 主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> family    ： 列簇</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> qualifier ： 字段名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value     ： 字段数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putRecord</span><span class="params">(String tableName, String rowKey, String family, String qualifier, String value)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line">        Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line">        put.addColumn(Bytes.toBytes(family), Bytes.toBytes(qualifier), Bytes.toBytes(value));</span><br><span class="line">        table.put(put);</span><br><span class="line">        System.out.println(tableName + <span class="string">&quot;中字段：&quot;</span> + qualifier + <span class="string">&quot;插入成功！！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到 hbase 中的一条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName ：表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey    ： 主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getOneRecord</span><span class="params">(String tableName, String rowKey)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line">        Get get = <span class="keyword">new</span> Get(Bytes.toBytes(rowKey));</span><br><span class="line">        Result result = table.get(get);</span><br><span class="line">        <span class="keyword">for</span> (Cell cell : result.rawCells()) &#123;</span><br><span class="line">            System.out.println(Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength())</span><br><span class="line">                    + <span class="string">&quot; : &quot;</span> + Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength())</span><br><span class="line">                    + <span class="string">&quot;:&quot;</span> + Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength())</span><br><span class="line">                    + <span class="string">&quot; : &quot;</span> + Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到表中的所有数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getAllRecord</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">        ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">        <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cell cell : result.rawCells()) &#123;</span><br><span class="line">                System.out.println(Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength())</span><br><span class="line">                        + <span class="string">&quot; : &quot;</span> + Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength())</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span> + Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength())</span><br><span class="line">                        + <span class="string">&quot; : &quot;</span> + Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName ：表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey    ：主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteRecord</span><span class="params">(String tableName, String rowKey)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line">        Delete delete = <span class="keyword">new</span> Delete(Bytes.toBytes(tableName));</span><br><span class="line">        table.delete(delete);</span><br><span class="line">        System.out.println(tableName + <span class="string">&quot;=====》&quot;</span> + rowKey + <span class="string">&quot;删除成功！！！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-3-HBaseUtilsTest-Code"><a href="#6-3-HBaseUtilsTest-Code" class="headerlink" title="6.3 HBaseUtilsTest Code"></a>6.3 HBaseUtilsTest Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.hbase.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBaseUtilsTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String zookeeperQuorum = <span class="string">&quot;bigdatatest02&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HBaseUtils.init(zookeeperQuorum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cleanUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HBaseUtils.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateTable</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HBaseUtils.createTable(<span class="string">&quot;test:demo1&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;o&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPutRecord</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HBaseUtils.putRecord(<span class="string">&quot;test:demo1&quot;</span>, <span class="string">&quot;row2&quot;</span>, <span class="string">&quot;o&quot;</span>, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetOneRecord</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HBaseUtils.getOneRecord(<span class="string">&quot;test:demo1&quot;</span>, <span class="string">&quot;row1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetAllRecord</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HBaseUtils.getAllRecord(<span class="string">&quot;test:demo1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteRecord</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HBaseUtils.deleteRecord(<span class="string">&quot;test:demo1&quot;</span>, <span class="string">&quot;row2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-HBase-API-（多版本控制）"><a href="#7-HBase-API-（多版本控制）" class="headerlink" title="7. HBase API （多版本控制）"></a>7. HBase API （多版本控制）</h3><h4 id="7-1-HBaseMultiVersion-Code"><a href="#7-1-HBaseMultiVersion-Code" class="headerlink" title="7.1 HBaseMultiVersion Code"></a>7.1 HBaseMultiVersion Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.hbase.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.Cell;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HBaseConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HConstants;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.TableName;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBaseMultiVersion</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection connection;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> zookeeperQuorum ： Zookeeper 连接地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(String zookeeperQuorum)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration hbaseConf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        hbaseConf.set(HConstants.ZOOKEEPER_QUORUM, zookeeperQuorum);</span><br><span class="line">        Configuration conf = HBaseConfiguration.create(hbaseConf);</span><br><span class="line">        connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!connection.isClosed()) &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到固定版本的整条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName ： 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> version   ： 版本号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getAllVersionRecord</span><span class="params">(String tableName, Integer version)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">        scan.setMaxVersions(version);</span><br><span class="line">        ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">        <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cell cell : result.rawCells()) &#123;</span><br><span class="line">                System.out.println(Bytes.toString(cell.getRowArray(), cell.getRowOffset(), cell.getRowLength())</span><br><span class="line">                        + <span class="string">&quot; : &quot;</span> + Bytes.toString(cell.getFamilyArray(), cell.getFamilyOffset(), cell.getFamilyLength())</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span> + Bytes.toString(cell.getQualifierArray(), cell.getQualifierOffset(), cell.getQualifierLength())</span><br><span class="line">                        + <span class="string">&quot; : &quot;</span> + Bytes.toString(cell.getValueArray(), cell.getValueOffset(), cell.getValueLength()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-HBaseMultiVersionTest-Code"><a href="#7-2-HBaseMultiVersionTest-Code" class="headerlink" title="7.2 HBaseMultiVersionTest Code"></a>7.2 HBaseMultiVersionTest Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.hbase.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HBaseMultiVersionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String zookeeperQuorum = <span class="string">&quot;bigdatatest02&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HBaseMultiVersion.init(zookeeperQuorum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cleanUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HBaseMultiVersion.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetAllVersionRecord</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HBaseMultiVersion.getAllVersionRecord(<span class="string">&quot;test:demo1&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">hbase</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2020/01/05/Hbase%20%E7%9A%84%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Kafka--API使用以及优化" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2019/12/23/Kafka--API%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E4%BC%98%E5%8C%96/" target="_blank">Kafka--API使用以及优化</a>
  
    </h1>
  


  
  
<a href="/2019/12/23/Kafka--API%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E4%BC%98%E5%8C%96/" class="archive-article-date">
        <time datetime="2019-12-23T14:20:37.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-12-23</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="Kafka–API使用以及优化"><a href="#Kafka–API使用以及优化" class="headerlink" title="Kafka–API使用以及优化"></a><center>Kafka–API使用以及优化</center></h2><h3 id="1-Kafka-Producer-API"><a href="#1-Kafka-Producer-API" class="headerlink" title="1. Kafka Producer API"></a>1. Kafka Producer API</h3><ul>
<li>Kafka 一般在大数据中是作为流式处理中的消息中间件使用的，数据生产者一般为：1） Canal/Maxwell(Mysql Binlog 收集工具) 2） Flume 日志收集工具 。数据通常是下发到 Spark/Flink 流式计算框架，写入到 实时数仓中的。</li>
<li>我们这里通过调用 Kafka Producer 的 API 来生产数据，并把消费者的数据打印在控制台上面输出。</li>
</ul>
<h4 id="1-1-创建一个Topic"><a href="#1-1-创建一个Topic" class="headerlink" title="1.1 创建一个Topic"></a>1.1 创建一个Topic</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 ~]# cd app&#x2F;kafka01&#x2F;bin&#x2F;</span><br><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --create \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">&gt; --partitions 3 \</span><br><span class="line">&gt; --replication-factor 3 \</span><br><span class="line">&gt; --topic kafka-test</span><br><span class="line">Created topic kafka-test.</span><br><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --list \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka</span><br><span class="line">__consumer_offsets</span><br><span class="line">bigdata</span><br><span class="line">kafka-test</span><br><span class="line">test</span><br></pre></td></tr></table></figure>

<h4 id="1-2-启动一个测试-Topic-的消费者"><a href="#1-2-启动一个测试-Topic-的消费者" class="headerlink" title="1.2 启动一个测试 Topic 的消费者"></a>1.2 启动一个测试 Topic 的消费者</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-console-consumer.sh \</span><br><span class="line">&gt; --bootstrap-server bigdatatest01:9092,bigdatatest01:9093,bigdatatest01:9094 \</span><br><span class="line">&gt; --topic kafka-test \</span><br><span class="line">&gt; --from-beginning</span><br></pre></td></tr></table></figure>

<h4 id="1-3-Kafka-Producer-API"><a href="#1-3-Kafka-Producer-API" class="headerlink" title="1.3 Kafka Producer API"></a>1.3 Kafka Producer API</h4><ul>
<li>增加 POM 文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.kafka&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kafka-clients&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.kafka.basic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * kafka Producer API </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC = <span class="string">&quot;kafka-test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">        <span class="comment">// 指定请求的kafka集群列表</span></span><br><span class="line">        pro.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">&quot;bigdatatest01:9092,bigdatatest01:9093,bigdatatest01:94&quot;</span>);</span><br><span class="line">        pro.put(ProducerConfig.CLIENT_ID_CONFIG,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当所有的 Kafka borkers 都写入成功之后 返回 ack 包才标识写入成功</span></span><br><span class="line">        pro.put(ProducerConfig.ACKS_CONFIG, <span class="string">&quot;all&quot;</span>);</span><br><span class="line">        <span class="comment">// 指定value的序列化方式</span></span><br><span class="line">        pro.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">        <span class="comment">// 指定key的序列化方式, key是用于存放数据对应的offset</span></span><br><span class="line">        pro.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">        <span class="comment">// 配置超时时间</span></span><br><span class="line">        pro.put(<span class="string">&quot;request.timeout.ms&quot;</span>, <span class="string">&quot;60000&quot;</span>);</span><br><span class="line">        <span class="comment">// 最大尝试次数</span></span><br><span class="line">        pro.put(<span class="string">&quot;retries&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建一个消费者 API的对象</span></span><br><span class="line">            producer = <span class="keyword">new</span> KafkaProducer&lt;&gt;(pro);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                producer.send(<span class="keyword">new</span> ProducerRecord&lt;String, String&gt;(TOPIC, String.valueOf(i), <span class="string">&quot;test&quot;</span> + i)).get();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != producer)&#123;</span><br><span class="line">                producer.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>运行结果</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-console-consumer.sh \</span><br><span class="line">&gt; --bootstrap-server bigdatatest01:9092,bigdatatest01:9093,bigdatatest01:9094 \</span><br><span class="line">&gt; --topic kafka-test \</span><br><span class="line">&gt; --from-beginning</span><br><span class="line">test0</span><br><span class="line">test1</span><br><span class="line">test2</span><br><span class="line">test3</span><br><span class="line">test4</span><br><span class="line">test5</span><br><span class="line">test6</span><br><span class="line">test7</span><br><span class="line">test8</span><br><span class="line">test9</span><br></pre></td></tr></table></figure>

<h3 id="2-查看Kafka-数据目录里面的数据"><a href="#2-查看Kafka-数据目录里面的数据" class="headerlink" title="2. 查看Kafka 数据目录里面的数据"></a>2. 查看Kafka 数据目录里面的数据</h3><ul>
<li>查看 Kafka 里面 ==log.dirs== 这个参数指的是：Kafka 数据存储在哪里，一般不放在 /tmp目录下，因为Linux /tmp 目录会自动清除数据。</li>
<li>数据存储在xxxx.log里面，文件名就是这个文件里面起始的偏移量。</li>
<li>索引数据存储在xxxx.index 里面，文件名就是这个文件里面起始的偏移量。</li>
<li>查看数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 ~]# cd &#x2F;root&#x2F;tmp&#x2F;kafka03</span><br><span class="line">[root@bigdatatest01 kafka03]# cd kafka-test-1&#x2F;</span><br><span class="line">[root@bigdatatest01 kafka-test-1]# ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 10485760 Jan 30 15:58 00000000000000000000.index</span><br><span class="line">-rw-r--r-- 1 root root      434 Jan 30 15:59 00000000000000000000.log</span><br><span class="line">-rw-r--r-- 1 root root 10485756 Jan 30 15:58 00000000000000000000.timeindex</span><br><span class="line">-rw-r--r-- 1 root root       10 Jan 30 15:58 00000000000000000004.snapshot</span><br><span class="line">-rw-r--r-- 1 root root       16 Jan 30 15:59 leader-epoch-checkpoint</span><br><span class="line">[root@bigdatatest01 kafka-test-1]# pwd</span><br><span class="line">&#x2F;root&#x2F;tmp&#x2F;kafka03&#x2F;kafka-test-1</span><br><span class="line">[root@bigdatatest01 kafka-test-1]# &#x2F;root&#x2F;app&#x2F;kafka02&#x2F;bin&#x2F;kafka-run-class.sh \</span><br><span class="line">&gt; kafka.tools.DumpLogSegments \</span><br><span class="line">&gt; --files &#x2F;root&#x2F;tmp&#x2F;kafka03&#x2F;kafka-test-1&#x2F;00000000000000000000.log \</span><br><span class="line">&gt; --print-data-log \</span><br><span class="line">&gt; &gt; 0.txt</span><br><span class="line">[root@bigdatatest01 kafka-test-1]# cat 0.txt </span><br><span class="line">Dumping &#x2F;root&#x2F;tmp&#x2F;kafka03&#x2F;kafka-test-1&#x2F;00000000000000000000.log</span><br><span class="line">Starting offset: 0</span><br><span class="line">baseOffset: 0 lastOffset: 0 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 0 CreateTime: 1611990840584 size: 69 magic: 2 compresscodec: NONE crc: 4080240511 isvalid: true</span><br><span class="line">| offset: 0 CreateTime: 1611990840584 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 2</span><br><span class="line">baseOffset: 1 lastOffset: 1 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 0 isTransactional: false isControl: false position: 69 CreateTime: 1611991305553 size: 69 magic: 2 compresscodec: NONE crc: 1878548313 isvalid: true</span><br><span class="line">| offset: 1 CreateTime: 1611991305553 keysize: -1 valuesize: 1 sequence: -1 headerKeys: [] payload: 2</span><br><span class="line">baseOffset: 2 lastOffset: 2 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 4 isTransactional: false isControl: false position: 138 CreateTime: 1611993310225 size: 74 magic: 2 compresscodec: NONE crc: 949833390 isvalid: true</span><br><span class="line">| offset: 2 CreateTime: 1611993310225 keysize: 1 valuesize: 5 sequence: -1 headerKeys: [] key: 4 payload: test4</span><br><span class="line">baseOffset: 3 lastOffset: 3 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 4 isTransactional: false isControl: false position: 212 CreateTime: 1611993310285 size: 74 magic: 2 compresscodec: NONE crc: 4165060188 isvalid: true</span><br><span class="line">| offset: 3 CreateTime: 1611993310285 keysize: 1 valuesize: 5 sequence: -1 headerKeys: [] key: 6 payload: test6</span><br><span class="line">baseOffset: 4 lastOffset: 4 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 5 isTransactional: false isControl: false position: 286 CreateTime: 1611993561401 size: 74 magic: 2 compresscodec: NONE crc: 604816250 isvalid: true</span><br><span class="line">| offset: 4 CreateTime: 1611993561401 keysize: 1 valuesize: 5 sequence: -1 headerKeys: [] key: 4 payload: test4</span><br><span class="line">baseOffset: 5 lastOffset: 5 count: 1 baseSequence: -1 lastSequence: -1 producerId: -1 producerEpoch: -1 partitionLeaderEpoch: 5 isTransactional: false isControl: false position: 360 CreateTime: 1611993561426 size: 74 magic: 2 compresscodec: NONE crc: 294887224 isvalid: true</span><br><span class="line">| offset: 5 CreateTime: 1611993561426 keysize: 1 valuesize: 5 sequence: -1 headerKeys: [] key: 6 payload: test6</span><br></pre></td></tr></table></figure>

<ul>
<li>数据量比较小的时候，索引里面没有数据，又跑了1W条数据</li>
<li>查看偏移量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 kafka-test-1]# &#x2F;root&#x2F;app&#x2F;kafka02&#x2F;bin&#x2F;kafka-run-class.sh \</span><br><span class="line">&gt; kafka.tools.DumpLogSegments \</span><br><span class="line">&gt; --files &#x2F;root&#x2F;tmp&#x2F;kafka03&#x2F;kafka-test-1&#x2F;00000000000000000000.index \</span><br><span class="line">&gt; --print-data-log \</span><br><span class="line">&gt; &gt; 0.index</span><br><span class="line">[root@bigdatatest01 kafka-test-1]# cat 0.index </span><br><span class="line">Dumping &#x2F;root&#x2F;tmp&#x2F;kafka03&#x2F;kafka-test-1&#x2F;00000000000000000000.index</span><br><span class="line">offset: 58 position: 4420</span><br><span class="line">offset: 111 position: 8554</span><br><span class="line">offset: 164 position: 12688</span><br><span class="line">offset: 217 position: 16822</span><br><span class="line">offset: 270 position: 20956</span><br><span class="line">offset: 323 position: 25090</span><br><span class="line">offset: 375 position: 29226</span><br><span class="line">offset: 427 position: 33386</span><br><span class="line">offset: 479 position: 37546</span><br><span class="line">offset: 531 position: 41706</span><br><span class="line">offset: 583 position: 45866</span><br><span class="line">offset: 635 position: 50026</span><br><span class="line">offset: 687 position: 54186</span><br><span class="line">offset: 739 position: 58346</span><br><span class="line">offset: 791 position: 62506</span><br><span class="line">offset: 843 position: 66666</span><br><span class="line">offset: 895 position: 70826</span><br><span class="line">offset: 947 position: 74986</span><br><span class="line">offset: 999 position: 79146</span><br><span class="line">offset: 1051 position: 83306</span><br><span class="line">offset: 1103 position: 87466</span><br><span class="line">offset: 1155 position: 91626</span><br><span class="line">offset: 1207 position: 95786</span><br><span class="line">offset: 1259 position: 99946</span><br><span class="line">offset: 1311 position: 104106</span><br><span class="line">offset: 1363 position: 108266</span><br><span class="line">offset: 1415 position: 112426</span><br><span class="line">offset: 1467 position: 116586</span><br><span class="line">offset: 1519 position: 120746</span><br><span class="line">offset: 1571 position: 124906</span><br><span class="line">offset: 1623 position: 129066</span><br><span class="line">offset: 1675 position: 133226</span><br><span class="line">offset: 1727 position: 137386</span><br><span class="line">offset: 1779 position: 141546</span><br></pre></td></tr></table></figure>

<ul>
<li>offset 是 Kafka 偏移量数据</li>
<li>position 是对应的 log 文件中这条数据的具体偏移量数据</li>
</ul>
<h3 id="3-Kafka-参数调优"><a href="#3-Kafka-参数调优" class="headerlink" title="3. Kafka 参数调优"></a>3. Kafka 参数调优</h3><p><a target="_blank" rel="noopener" href="http://kafka.apache.org/documentation/">Kafka 参数地址</a></p>
<h4 id="3-1-Kafka-Broker-参数"><a href="#3-1-Kafka-Broker-参数" class="headerlink" title="3.1 Kafka Broker 参数"></a>3.1 Kafka Broker 参数</h4><ul>
<li>log.segment.bytes：指的是Kafka 日志文件大小，单位是字节</li>
<li>message.max.bytes=2560KB：一条消息的大小</li>
<li>zookeeper.session.timeout.ms=180000：ZK客户端 timeout 时间</li>
<li>replica.fetch.max.bytes=5M：大于message.max.bytes，为每个分区尝试获取最大的消息字节数，单位字节。</li>
<li>num.replica.fetchers=6：拉取线程数,fetcher配置多可以提高follower的I/O并发度，单位时间内leader持有更多请求，相应负载会增大，需要根据机器硬件资源做权衡，建议适当调大。</li>
<li>replica.lag.max.messages=6000：Kafka通过replica.lag.max.messages和replica.lag.time.max.ms两个参数来度量Follower同步的情况。其中replica.lag.max.messages用于配置Follower可落后的最大消息数量，replica.lag.time.max.ms用于配置Follower和Leader通信的最大时延。由于replica.lag.max.messages是全局配置，需要根据经验配置，配置的不好会导致节点不断的加入和移出ISR，后续版本已经删除此参数，是保留replica.lag.time.max.ms一个参数。</li>
<li>replica.lag.time.max.ms=15000</li>
<li>log.flush.interval.messages=10000：在将消息刷新到磁盘之前在日志分区上累积的消息数。</li>
<li>log.flush.interval.ms=5s：任何主题中的消息在刷新到磁盘之前保留在内存中的最长时间（毫秒）。</li>
</ul>
<h4 id="3-2-Kafka-Producer-参数"><a href="#3-2-Kafka-Producer-参数" class="headerlink" title="3.2 Kafka Producer 参数"></a>3.2 Kafka Producer 参数</h4><ul>
<li>acks=all：当所有的 Kafka borkers 都写入成功之后 返回 ack 包才标识写入成功。</li>
<li>buffer.memory=536870912：缓存区域的大小。</li>
<li>compression.type=snappy：压缩格式为snappy。</li>
<li>retries=100：如果没有写入成功尝试次数。</li>
<li>max.in.flight.requests.per.connection=1：在阻塞之前，客户端将在单个连接上发送的最大未确认请求数。</li>
<li>batch.size：1024字节：每当多个记录被发送到同一分区时，生产者将尝试将记录批处理到一起，以减少请求。</li>
<li>max.request.size=2097152：请求的最大大小（字节）。</li>
<li>request.timeout.ms=360000：大于 replica.lag.time.max.ms ，配置控制客户端等待请求响应的最长时间。</li>
<li>metadata.fetch.timeout.ms：36000：指定了生产者在获取元数据（比如目标分区的Leader是谁）时等待服务器返回响应的时间。如果等待响应超时，那么生产者要么重试发送数据，要么返回一个错误（抛出异常或执行回调）。</li>
<li>timeout.ms：36000：超时时间。</li>
<li>linger.ms=5s：该参数指定了生产者在发送批次之前等待更多消息加入批次的时间（==生产不用==）。</li>
<li>max.block.ms=1800000：该参数指定了在调用send()方法或使用partitionsFor()方法获取元数据时生产者的阻塞时间。</li>
</ul>
<h4 id="3-3-Kafka-Consumer-参数"><a href="#3-3-Kafka-Consumer-参数" class="headerlink" title="3.3 Kafka Consumer 参数"></a>3.3 Kafka Consumer 参数</h4><ul>
<li>max.partition.fetch.bytes=5242880：默认值是1MB,该属性指定了服务器从每个分区里返回给消费者的最大字节数。</li>
<li>request.timeout.ms=90000：指定了生产者在发送数据时等待服务器返回响应的时间。</li>
<li>session.timeout.ms=60000：该属性指定了消费者在被认为死亡之前可以与服务器断开连接的时间。</li>
<li>heartbeat.interval.ms=5000：心跳时间间隔。</li>
<li>receive.buffer.bytes=10485760：指定了TCP socket 接收数据包的缓冲区大小，如果它们被设为-1，就使用操作系统的默认值。</li>
</ul>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">kafka</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2019/12/23/Kafka--API%E4%BD%BF%E7%94%A8%E4%BB%A5%E5%8F%8A%E4%BC%98%E5%8C%96/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Kafka简介以及部署" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2019/12/15/Kafka%E7%AE%80%E4%BB%8B%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/" target="_blank">Kafka简介以及部署</a>
  
    </h1>
  


  
  
<a href="/2019/12/15/Kafka%E7%AE%80%E4%BB%8B%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/" class="archive-article-date">
        <time datetime="2019-12-15T12:19:16.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-12-15</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="Kafka简介以及部署"><a href="#Kafka简介以及部署" class="headerlink" title="Kafka简介以及部署"></a><center>Kafka简介以及部署</center></h2><p><a target="_blank" rel="noopener" href="https://kafka.apache.org/">Kafka 官网</a></p>
<h3 id="1-Kafka-介绍"><a href="#1-Kafka-介绍" class="headerlink" title="1. Kafka 介绍"></a>1. Kafka 介绍</h3><ul>
<li>推荐一个可以监控 Kafka Topic 的工具：==kafka-eagle==</li>
</ul>
<h4 id="1-1-什么是Kafka"><a href="#1-1-什么是Kafka" class="headerlink" title="1.1 什么是Kafka"></a>1.1 什么是Kafka</h4><ul>
<li>Kafka是一个分布式消息队列。</li>
<li>Kafka对消息保存时根据Topic进行归类，发送消息者称为Producer，消息接受者称为Consumer，此外kafka集群有多个kafka实例组成，每个实例(server)称为broker。无论是kafka集群，还是consumer都依赖于Zookeeper集群保存一些meta信息，来保证系统可用性。</li>
</ul>
<h4 id="1-2-Kafka-优点"><a href="#1-2-Kafka-优点" class="headerlink" title="1.2 Kafka 优点"></a>1.2 Kafka 优点</h4><ul>
<li>==解耦==：在项目启动之初来预测将来项目会碰到什么需求，是极其困难的。消息系统在处理过程中间插入了一个隐含的、基于数据的接口层，两边的处理过程都要实现这一接口。这允许你独立的扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束。</li>
<li>==冗余（副本）==：有些情况下，处理数据的过程会失败。除非数据被持久化，否则将造成丢失。消息队列把数据进行持久化直到它们已经被完全处理，通过这一方式规避了数据丢失风险。许多消息队列所采用的”插入-获取-删除”范式中，在把一个消息从队列中删除之前，需要你的处理系统明确的指出该消息已经被处理完毕，从而确保你的数据被安全的保存直到你使用完毕。</li>
<li>==扩展性==：因为消息队列解耦了你的处理过程，所以增大消息入队和处理的频率是很容易的，只要另外增加处理过程即可。不需要改变代码、不需要调节参数。扩展就像调大电力按钮一样简单。</li>
<li>==灵活性&amp;峰值处理能力==：在访问量剧增的情况下，应用仍然需要继续发挥作用，但是这样的突发流量并不常见；如果为以能处理这类峰值访问为标准来投入资源随时待命无疑是巨大的浪费。使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。</li>
<li>==可恢复性==：系统的一部分组件失效时，不会影响到整个系统。消息队列降低了进程间的耦合度，所以即使一个处理消息的进程挂掉，加入队列中的消息仍然可以在系统恢复后被处理。</li>
<li>==顺序保证==：在大多使用场景下，数据处理的顺序都很重要。大部分消息队列本来就是排序的，并且能保证数据会按照特定的顺序来处理。Kafka保证一个Partition内的消息的有序性。</li>
<li>==缓冲==：在任何重要的系统中，都会有需要不同的处理时间的元素。例如，加载一张图片比应用过滤器花费更少的时间。消息队列通过一个缓冲层来帮助任务最高效率的执行———写入队列的处理会尽可能的快速。该缓冲有助于控制和优化数据流经过系统的速度。</li>
<li>==异步通信==：很多时候，用户不想也不需要立即处理消息。消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。想向队列中放入多少消息就放多少，然后在需要的时候再去处理它们。</li>
</ul>
<h4 id="1-3-Kafka-架构"><a href="#1-3-Kafka-架构" class="headerlink" title="1.3 Kafka 架构"></a>1.3 Kafka 架构</h4><p><img src="/img/kafka/Kafka%E6%9E%B6%E6%9E%84.png" alt="Kafka架构"></p>
<ul>
<li>broker：Kafka 集群包含一个或多个服务器，服务器节点称为broker。broker存储topic的数据。<ul>
<li>如果某topic有N个partition，集群有N个broker，那么每个broker存储该topic的一个partition。</li>
<li>如果某topic有N个partition，集群有(N+M)个broker，那么其中有N个broker存储该topic的一个partition，剩下的M个broker不存储该topic的partition数据。</li>
<li>如果某topic有N个partition，集群中broker数目少于N个，那么一个broker存储该topic的一个或多个partition。在实际生产环境中，尽量避免这种情况的发生，这种情况容易导致Kafka集群数据不均衡。</li>
</ul>
</li>
<li>Topic：每条发布到Kafka集群的消息都有一个类别，这个类别被称为Topic。（物理上不同Topic的消息分开存储，逻辑上一个Topic的消息虽然保存于一个或多个broker上但用户只需指定消息的Topic即可生产或消费数据而不必关心数据存于何处），类似于数据库的表名。</li>
<li>Partition：topic中的数据分割为一个或多个partition。每个topic至少有一个partition。每个partition中的数据使用多个segment文件存储。partition中的数据是有序的，不同partition间的数据丢失了数据的顺序。如果topic有多个partition，消费数据时就不能保证数据的顺序。其实就是一个文件夹，文件夹的命名规则为topic名称-序号。</li>
<li>Producer：生产者即数据的发布者，该角色将消息发布到Kafka的topic中。broker接收到生产者发送的消息后，broker将该消息追加到当前用于追加数据的segment文件中。生产者发送的消息，存储到一个partition中，生产者也可以指定数据存储的partition。</li>
<li>Consumer：消费者可以从broker中读取数据。消费者可以消费多个topic中的数据。</li>
<li>Consumer Group：简称（CG），每个Consumer属于一个特定的Consumer Group（可为每个Consumer指定group name，若不指定group name则属于默认的group）。这是kafka用来实现一个topic消息的广播（发给所有的consumer）和单播（发给任意一个consumer）的手段。一个topic可以有多个CG。topic的消息会复制-给consumer。如果需要实现广播，只要每个consumer有一个独立的CG就可以了。要实现单播只要所有的consumer在同一个CG。用CG还可以将consumer进行自由的分组而不需要多次发送消息到不同的topic。</li>
<li>Leader：每个partition有多个副本，其中有且仅有一个作为Leader，Leader是当前负责数据的读写的partition。</li>
<li>Follower：Follower跟随Leader，所有写请求都通过Leader路由，数据变更会广播给所有Follower，Follower与Leader保持数据同步。如果Leader失效，则从Follower中选举出一个新的Leader。当Follower与Leader挂掉、卡住或者同步太慢，leader会把这个follower从“in sync replicas”（ISR）列表中删除，重新创建一个Follower。</li>
<li>Offset：某个或某组consumer读取某个partition的偏移量。 同一个partition不同的consumer有不同的offset。同时consumer有个组的概念，使用同一个group id，也就是同属于某个组的consumer，共用offset。</li>
</ul>
<h3 id="2-Kafka-集群部署"><a href="#2-Kafka-集群部署" class="headerlink" title="2. Kafka 集群部署"></a>2. Kafka 集群部署</h3><ul>
<li>本次部署是以CDH5.16.2为基准。</li>
<li>本次部署是在一个机器上面不是三个broker的Kafka。</li>
</ul>
<h4 id="2-1-部署前提"><a href="#2-1-部署前提" class="headerlink" title="2.1 部署前提"></a>2.1 部署前提</h4><ul>
<li>需要部署Zookeeper，之前文章已经完成Zookeeper集群部署了。</li>
</ul>
<h4 id="2-2-部署Kfaka"><a href="#2-2-部署Kfaka" class="headerlink" title="2.2 部署Kfaka"></a>2.2 部署Kfaka</h4><p><a target="_blank" rel="noopener" href="http://archive.cloudera.com/kafka/kafka/4/kafka-2.2.1-kafka4.1.0.tar.gz">下载</a></p>
<h5 id="2-2-1-开启Zookeeper-集群"><a href="#2-2-1-开启Zookeeper-集群" class="headerlink" title="2.2.1 开启Zookeeper 集群"></a>2.2.1 开启Zookeeper 集群</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 ~]# cd app&#x2F;</span><br><span class="line">[root@bigdatatest01 app]# cd zk1&#x2F;</span><br><span class="line">[root@bigdatatest01 zk1]# bin&#x2F;zkServer.sh start</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: &#x2F;root&#x2F;app&#x2F;zk1&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">[root@bigdatatest01 zk1]# cd ..&#x2F;zk2&#x2F;</span><br><span class="line">[root@bigdatatest01 zk2]# bin&#x2F;zkServer.sh start</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: &#x2F;root&#x2F;app&#x2F;zk2&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">[root@bigdatatest01 app]# zk3&#x2F;bin&#x2F;zkServer.sh start</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: &#x2F;root&#x2F;app&#x2F;zk3&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">[root@bigdatatest01 app]# zk1&#x2F;bin&#x2F;zkServer.sh status</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: &#x2F;root&#x2F;app&#x2F;zk1&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">Mode: follower</span><br><span class="line">[root@bigdatatest01 app]# zk2&#x2F;bin&#x2F;zkServer.sh status</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: &#x2F;root&#x2F;app&#x2F;zk2&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">Mode: leader</span><br><span class="line">[root@bigdatatest01 app]# zk3&#x2F;bin&#x2F;zkServer.sh status</span><br><span class="line">JMX enabled by default</span><br><span class="line">Using config: &#x2F;root&#x2F;app&#x2F;zk3&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">Mode: follower</span><br></pre></td></tr></table></figure>

<h5 id="2-2-2-下载文件并解压"><a href="#2-2-2-下载文件并解压" class="headerlink" title="2.2.2 下载文件并解压"></a>2.2.2 下载文件并解压</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 app]# cd ~&#x2F;software&#x2F;</span><br><span class="line">[root@bigdatatest01 software]# wget http:&#x2F;&#x2F;archive.cloudera.com&#x2F;kafka&#x2F;kafka&#x2F;4&#x2F;kafka-2.2.1-kafka4.1.0.tar.gz</span><br><span class="line">[root@bigdatatest01 software]# tar -xzvf kafka-2.2.1-kafka4.1.0.tar.gz -C ~&#x2F;app&#x2F;</span><br><span class="line">[root@bigdatatest01 software]# cd ~&#x2F;app&#x2F;</span><br><span class="line">[root@bigdatatest01 app]# cp -r kafka_2.11-2.2.1-kafka-4.1.0 kafka01</span><br><span class="line">[root@bigdatatest01 app]# cp -r kafka_2.11-2.2.1-kafka-4.1.0 kafka02</span><br><span class="line">[root@bigdatatest01 app]# cp -r kafka_2.11-2.2.1-kafka-4.1.0 kafka03</span><br></pre></td></tr></table></figure>

<h6 id="2-2-3-修改配置文件"><a href="#2-2-3-修改配置文件" class="headerlink" title="2.2.3 修改配置文件"></a>2.2.3 修改配置文件</h6><ul>
<li>创建Kafka日志存储文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 ~]# cd tmp&#x2F;</span><br><span class="line">[root@bigdatatest01 tmp]# mkdir kafka01</span><br><span class="line">[root@bigdatatest01 tmp]# mkdir kafka02</span><br><span class="line">[root@bigdatatest01 tmp]# mkdir kafka03</span><br><span class="line">[root@bigdatatest01 tmp]# cd kafka01</span><br><span class="line">[root@bigdatatest01 kafka01]# pwd</span><br><span class="line">&#x2F;root&#x2F;tmp&#x2F;kafka01</span><br></pre></td></tr></table></figure>

<ul>
<li>修改配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 app]# vim kafka01&#x2F;config&#x2F;server.properties </span><br><span class="line">broker.id&#x3D;0</span><br><span class="line">host.name&#x3D;localhost</span><br><span class="line">port&#x3D;9092</span><br><span class="line">log.dirs&#x3D;&#x2F;root&#x2F;tmp&#x2F;kafka01</span><br><span class="line">zookeeper.connect&#x3D;bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka</span><br><span class="line"></span><br><span class="line">[root@bigdatatest01 app]# vim kafka02&#x2F;config&#x2F;server.properties</span><br><span class="line">broker.id&#x3D;1</span><br><span class="line">host.name&#x3D;localhost</span><br><span class="line">port&#x3D;9093</span><br><span class="line">log.dirs&#x3D;&#x2F;root&#x2F;tmp&#x2F;kafka02</span><br><span class="line">zookeeper.connect&#x3D;bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka</span><br><span class="line"></span><br><span class="line">[root@bigdatatest01 app]# vim kafka03&#x2F;config&#x2F;server.properties</span><br><span class="line">broker.id&#x3D;2</span><br><span class="line">host.name&#x3D;localhost</span><br><span class="line">port&#x3D;9094</span><br><span class="line">log.dirs&#x3D;&#x2F;root&#x2F;tmp&#x2F;kafka03</span><br><span class="line">zookeeper.connect&#x3D;bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka</span><br></pre></td></tr></table></figure>

<h6 id="2-2-4-启动Kafka"><a href="#2-2-4-启动Kafka" class="headerlink" title="2.2.4 启动Kafka"></a>2.2.4 启动Kafka</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 app]# cd kafka01</span><br><span class="line">[root@bigdatatest01 kafka01]# nohup bin&#x2F;kafka-server-start.sh config&#x2F;server.properties &amp;</span><br><span class="line">[root@bigdatatest01 kafka01]# cd ..&#x2F;kafka02</span><br><span class="line">[root@bigdatatest01 kafka02]# nohup bin&#x2F;kafka-server-start.sh config&#x2F;server.properties &amp;</span><br><span class="line">[root@bigdatatest01 kafka02]# cd ..&#x2F;kafka03&#x2F;</span><br><span class="line">[root@bigdatatest01 kafka03]# nohup bin&#x2F;kafka-server-start.sh config&#x2F;server.properties &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>Zookeeper 中的 Kafka 数据是否存储 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# cd ~</span><br><span class="line">[root@bigdatatest01 ~]# cd app&#x2F;zk1&#x2F;bin&#x2F;</span><br><span class="line">[root@bigdatatest01 bin]# .&#x2F;zkCli.sh </span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls &#x2F;kafka</span><br><span class="line">[cluster, controller_epoch, controller, brokers, admin, isr_change_notification, consumers, log_dir_event_notification, latest_producer_id_block, config]</span><br></pre></td></tr></table></figure>

<h3 id="3-Kafka-常用命令"><a href="#3-Kafka-常用命令" class="headerlink" title="3. Kafka 常用命令"></a>3. Kafka 常用命令</h3><h4 id="3-1-创建-Topic"><a href="#3-1-创建-Topic" class="headerlink" title="3.1 创建 Topic"></a>3.1 创建 Topic</h4><ul>
<li>partitions ：==分区数据量和 broker 节点数没有关系==</li>
<li>replication-factor：==副本数必须小于等于 broker 节点数==</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 ~]# cd ~</span><br><span class="line">[root@bigdatatest01 ~]# cd app&#x2F;kafka01&#x2F;bin</span><br><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --create \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183 \</span><br><span class="line">&gt; --partitions 3 \</span><br><span class="line">&gt; --replication-factor 1 \</span><br><span class="line">&gt; --topic bigdata</span><br><span class="line">Error while executing topic command : Replication factor: 1 larger than available brokers: 0.</span><br><span class="line">[2021-01-27 15:46:33,919] ERROR org.apache.kafka.common.errors.InvalidReplicationFactorException: Replication factor: 1 larger than available brokers: 0.</span><br><span class="line"> (kafka.admin.TopicCommand$)</span><br></pre></td></tr></table></figure>

<ul>
<li>问题出错原因：配置文件名一样，改下配置文件名并启动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# cd ~</span><br><span class="line">[root@bigdatatest01 ~]# cd app&#x2F;kafka01&#x2F;config&#x2F;</span><br><span class="line">[root@bigdatatest01 config]# cp server.properties server-0.properties </span><br><span class="line">[root@bigdatatest01 kafka01]# nohup bin&#x2F;kafka-server-start.sh config&#x2F;server-0.properties &amp;</span><br><span class="line"></span><br><span class="line">[root@bigdatatest01 kafka01]# cd ..&#x2F;kafka02&#x2F;config&#x2F;</span><br><span class="line">[root@bigdatatest01 config]# cp server.properties server-1.properties </span><br><span class="line">[root@bigdatatest01 config]# cd ..&#x2F;</span><br><span class="line">[root@bigdatatest01 kafka02]# nohup bin&#x2F;kafka-server-start.sh config&#x2F;server-1.properties &amp;</span><br><span class="line"></span><br><span class="line">[root@bigdatatest01 kafka02]# cd ..&#x2F;kafka03&#x2F;config&#x2F;</span><br><span class="line">[root@bigdatatest01 config]# cp server.properties server-2.properties </span><br><span class="line">[root@bigdatatest01 config]# cd ..&#x2F;</span><br><span class="line">[root@bigdatatest01 kafka03]# nohup bin&#x2F;kafka-server-start.sh config&#x2F;server-2.properties &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>发现继续报错</li>
<li>命令有问题，修改命令。</li>
<li>问题原因是因为 Kafka 保存在 ZK上面元数据目录是：/kafka，所以在 –zookeeper 这个参数后面需要添加 /kafka </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;kafka-topics.sh --create \</span><br><span class="line">--zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">--partitions 3 \</span><br><span class="line">--replication-factor 3 \</span><br><span class="line">--topic bigdata</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 kafka03]# cd bin</span><br><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --create \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">&gt; --partitions 3 \</span><br><span class="line">&gt; --replication-factor 3 \</span><br><span class="line">&gt; --topic bigdata</span><br><span class="line">Created topic bigdata.</span><br></pre></td></tr></table></figure>

<h4 id="3-2-查看创建的-Topic"><a href="#3-2-查看创建的-Topic" class="headerlink" title="3.2 查看创建的 Topic"></a>3.2 查看创建的 Topic</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;kafka-topics.sh --list \</span><br><span class="line">--zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --list \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka</span><br><span class="line">bigdata</span><br></pre></td></tr></table></figure>

<h4 id="3-3-查看-Topic-具体描述"><a href="#3-3-查看-Topic-具体描述" class="headerlink" title="3.3 查看 Topic 具体描述"></a>3.3 查看 Topic 具体描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;kafka-topics.sh --describe \</span><br><span class="line">--zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">--topic bigdata</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --describe \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">&gt; --topic bigdata</span><br><span class="line">Topic:bigdata	PartitionCount:3	ReplicationFactor:3	Configs:</span><br><span class="line">	Topic: bigdata	Partition: 0	Leader: 1	Replicas: 1,2,0	Isr: 1,2,0</span><br><span class="line">	Topic: bigdata	Partition: 1	Leader: 2	Replicas: 2,0,1	Isr: 2,0,1</span><br><span class="line">	Topic: bigdata	Partition: 2	Leader: 0	Replicas: 0,1,2	Isr: 0,1,2</span><br></pre></td></tr></table></figure>

<ul>
<li>描述信息详解：<ul>
<li>第一行 ：topic的名称  分区数量 副本数量</li>
<li>第二行开始 ： 每一行列出每一个分区的信息，是第几个分区，leader是在哪个broker上，副本是位于哪些broker上，有哪些副本处理同步状态的。</li>
<li>Leader: 负责该分区的读写节点  另外两个同步数据的。</li>
<li>Isr：以第一条详细信息为例（Topic: bigdata    Partition: 0    Leader: 1    Replicas: 1,2,0    Isr: 1,2,0），此条信息中 Leader 为 1，Isr 代表几个 broker 的优先级，如果 1 挂了，则 Leader 由 2 顶上，如果 2 也挂了，才可以排到 0 作为 Leader。</li>
</ul>
</li>
</ul>
<h4 id="3-4-删除-Topic"><a href="#3-4-删除-Topic" class="headerlink" title="3.4 删除 Topic"></a>3.4 删除 Topic</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;kafka-topics.sh --delete \</span><br><span class="line">--zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">--topic bigdata</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --delete \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">&gt; --topic bigdata</span><br><span class="line">Topic bigdata is marked for deletion.</span><br><span class="line">Note: This will have no impact if delete.topic.enable is not set to true.</span><br><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --list \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka</span><br></pre></td></tr></table></figure>

<ul>
<li>生产上尽量不要删除 Topic，如果逼不得已需要删除，则需要删除：</li>
<li>Linux 磁盘文件夹 （log.dirs 这个参数配置），把对应的 Topic 文件夹给删除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 kafka01]# pwd</span><br><span class="line">&#x2F;root&#x2F;tmp&#x2F;kafka01</span><br><span class="line">[root@bigdatatest01 kafka01]# ll</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 2 root root 141 Jan 27 17:31 bigdata-0</span><br><span class="line">drwxr-xr-x 2 root root 141 Jan 27 17:31 bigdata-1</span><br><span class="line">drwxr-xr-x 2 root root 141 Jan 27 17:31 bigdata-2</span><br><span class="line">-rw-r--r-- 1 root root   4 Jan 27 17:28 cleaner-offset-checkpoint</span><br><span class="line">-rw-r--r-- 1 root root   4 Jan 27 17:32 log-start-offset-checkpoint</span><br><span class="line">-rw-r--r-- 1 root root  54 Jan 27 16:35 meta.properties</span><br><span class="line">-rw-r--r-- 1 root root  40 Jan 27 17:32 recovery-point-offset-checkpoint</span><br><span class="line">-rw-r--r-- 1 root root  40 Jan 27 17:32 replication-offset-checkpoint</span><br></pre></td></tr></table></figure>

<ul>
<li>ZK的元数据中对应的 Topic 数据也需要删除<ul>
<li> /kafka/brokers/topics</li>
<li> /kafka/config/topics</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 0] ls &#x2F;kafka&#x2F;brokers&#x2F;topics</span><br><span class="line">[bigdata]           </span><br><span class="line">[zk: localhost:2181(CONNECTED) 1] ls &#x2F;kafka&#x2F;config&#x2F;topics</span><br><span class="line">[bigdata]</span><br></pre></td></tr></table></figure>

<h4 id="3-5-修改-Topic-信息"><a href="#3-5-修改-Topic-信息" class="headerlink" title="3.5 修改 Topic 信息"></a>3.5 修改 Topic 信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;kafka-topics.sh --alter \</span><br><span class="line">--zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">--partitions 4 \</span><br><span class="line">--topic bigdata</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --alter \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">&gt; --partitions 4 \</span><br><span class="line">&gt; --topic bigdata</span><br><span class="line">WARNING: If partitions are increased for a topic that has a key, the partition logic or ordering of the messages will be affected</span><br><span class="line">Adding partitions succeeded!</span><br><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-topics.sh --describe \</span><br><span class="line">&gt; --zookeeper  bigdatatest01:2181,bigdatatest01:2182,bigdatatest01:2183&#x2F;kafka \</span><br><span class="line">&gt; --topic bigdata</span><br><span class="line">Topic:bigdata	PartitionCount:4	ReplicationFactor:3	Configs:</span><br><span class="line">	Topic: bigdata	Partition: 0	Leader: 0	Replicas: 0,1,2	Isr: 0,1,2</span><br><span class="line">	Topic: bigdata	Partition: 1	Leader: 1	Replicas: 1,2,0	Isr: 1,2,0</span><br><span class="line">	Topic: bigdata	Partition: 2	Leader: 2	Replicas: 2,0,1	Isr: 2,0,1</span><br><span class="line">	Topic: bigdata	Partition: 3	Leader: 0	Replicas: 0,2,1	Isr: 0,2,1</span><br></pre></td></tr></table></figure>

<h4 id="3-6-自动迁移数据到新的节点"><a href="#3-6-自动迁移数据到新的节点" class="headerlink" title="3.6 自动迁移数据到新的节点"></a>3.6 自动迁移数据到新的节点</h4><p><a target="_blank" rel="noopener" href="http://kafka.apache.org/22/documentation.html#basic_ops_automigrate">自动迁移数据到新的节点（官方提供）</a></p>
<h4 id="3-7-启动一个生产者"><a href="#3-7-启动一个生产者" class="headerlink" title="3.7 启动一个生产者"></a>3.7 启动一个生产者</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;kafka-console-producer.sh \</span><br><span class="line">--broker-list bigdatatest01:9092,bigdatatest01:9093,bigdatatest01:9094 \</span><br><span class="line">--topic bigdata</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-console-producer.sh \</span><br><span class="line">&gt; --broker-list bigdatatest01:9092,bigdatatest01:9093,bigdatatest01:9094 \</span><br><span class="line">&gt; --topic bigdata</span><br><span class="line">&gt;1</span><br><span class="line">&gt;2</span><br><span class="line">&gt;3</span><br></pre></td></tr></table></figure>

<h4 id="3-8-启动一个消费者"><a href="#3-8-启动一个消费者" class="headerlink" title="3.8 启动一个消费者"></a>3.8 启动一个消费者</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;kafka-console-consumer.sh \</span><br><span class="line">--bootstrap-server bigdatatest01:9092,bigdatatest01:9093,bigdatatest01:9094 \</span><br><span class="line">--topic bigdata \</span><br><span class="line">--from-beginning</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bigdatatest01 bin]# .&#x2F;kafka-console-consumer.sh \</span><br><span class="line">&gt; --bootstrap-server bigdatatest01:9092,bigdatatest01:9093,bigdatatest01:9094 \</span><br><span class="line">&gt; --topic bigdata \</span><br><span class="line">&gt; --from-beginning</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">kafka</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2019/12/15/Kafka%E7%AE%80%E4%BB%8B%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-初识Scalikejdbc" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2019/12/03/%E5%88%9D%E8%AF%86Scalikejdbc/" target="_blank">初识Scalikejdbc</a>
  
    </h1>
  


  
  
<a href="/2019/12/03/%E5%88%9D%E8%AF%86Scalikejdbc/" class="archive-article-date">
        <time datetime="2019-12-03T14:19:28.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-12-03</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="初识Scalikejdbc"><a href="#初识Scalikejdbc" class="headerlink" title="初识Scalikejdbc"></a><center>初识Scalikejdbc</center></h2><p><a target="_blank" rel="noopener" href="http://scalikejdbc.org/">官网</a></p>
<ul>
<li>ScalikeJDBC 是一款给 Scala 开发者使用的简洁 DB 访问类库，它是基于 SQL 的，使用者<br>只需要关注 SQL 逻辑的编写，所有的数据库操作都交给 ScalikeJDBC。这个类库内置包含了<br>JDBC API，并且给用户提供了简单易用并且非常灵活的 API。并且，QueryDSL(通用查询查询<br>框架)使你的代码类型安全的并且可重复使用。我们可以在生产环境大胆地使用这款 DB 访问<br>类库。</li>
<li>本次使用的 Scala 版本为 2.12.10</li>
</ul>
<h3 id="1-POM-中增加"><a href="#1-POM-中增加" class="headerlink" title="1. POM 中增加"></a>1. POM 中增加</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.scalikejdbc&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;scalikejdbc_2.12&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;3.4.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.scalikejdbc&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;scalikejdbc-config_2.12&lt;&#x2F;artifactId&gt;</span><br><span class="line">	&lt;version&gt;3.4.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.1.48&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-增加配置文件"><a href="#2-增加配置文件" class="headerlink" title="2. 增加配置文件"></a>2. 增加配置文件</h3><ul>
<li>配置文件默认路径： src/main/resources/application.conf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># JDBC settings</span><br><span class="line">db.default.driver&#x3D;&quot;com.mysql.jdbc.Driver&quot;</span><br><span class="line">db.default.url&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;bigdatatest01:3306&#x2F;bigdata&quot;</span><br><span class="line">db.default.user&#x3D;&quot;root&quot;</span><br><span class="line">db.default.password&#x3D;&quot;123456&quot;</span><br><span class="line"></span><br><span class="line"># Connection Pool settings</span><br><span class="line">db.default.poolInitialSize&#x3D;5</span><br><span class="line">db.default.poolMaxSize&#x3D;7</span><br><span class="line"># poolConnectionTimeoutMillis defines the amount of time a query will wait to acquire a connection</span><br><span class="line"># before throwing an exception. This used to be called &#96;connectionTimeoutMillis&#96;.</span><br><span class="line">db.default.poolConnectionTimeoutMillis&#x3D;1000</span><br><span class="line">db.default.poolValidationQuery&#x3D;&quot;select 1 as one&quot;</span><br><span class="line">db.default.poolFactoryName&#x3D;&quot;commons-dbcp2&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3-对数据库-CRUD-操作"><a href="#3-对数据库-CRUD-操作" class="headerlink" title="3. 对数据库 CRUD 操作"></a>3. 对数据库 CRUD 操作</h3><ul>
<li>插入数据</li>
<li>查询数据</li>
<li>删除数据</li>
<li>通过事务进行插入两条数据</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xk.bigdata.scala.scalikejdbc</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scalikejdbc.&#123;<span class="type">DB</span>, <span class="type">SQL</span>&#125;</span><br><span class="line"><span class="keyword">import</span> scalikejdbc.config.<span class="type">DBs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. 插入数据</span></span><br><span class="line"><span class="comment"> * 2. 查询数据</span></span><br><span class="line"><span class="comment"> * 3. 删除数据</span></span><br><span class="line"><span class="comment"> * 4. 通过事务进行插入两条数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">CRUDDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 插入数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">insert</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="type">DB</span>.autoCommit(<span class="keyword">implicit</span> session =&gt; &#123;</span><br><span class="line">      <span class="type">SQL</span>(<span class="string">&quot;insert into tes1t (id,name) values(?,?)&quot;</span>)</span><br><span class="line">        .bind(<span class="number">10</span>, <span class="string">&quot;10&quot;</span>)</span><br><span class="line">        .update()</span><br><span class="line">        .apply()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 查询数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">query</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="type">DB</span>.readOnly(<span class="keyword">implicit</span> session =&gt; &#123;</span><br><span class="line">      <span class="keyword">val</span> data = <span class="type">SQL</span>(<span class="string">&quot;select * from tes1t&quot;</span>)</span><br><span class="line">        .map(rs =&gt; &#123;</span><br><span class="line">          tes1t(rs.int(<span class="string">&quot;id&quot;</span>), rs.string(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">        &#125;).toList().apply()</span><br><span class="line">      data.foreach(println)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 删除数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">delete</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="type">DB</span>.autoCommit(<span class="keyword">implicit</span> session =&gt; &#123;</span><br><span class="line">      <span class="type">SQL</span>(<span class="string">&quot;delete from tes1t where id = ?&quot;</span>)</span><br><span class="line">        .bind(<span class="number">10</span>)</span><br><span class="line">        .update()</span><br><span class="line">        .apply()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 通过事务进行插入两条数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">transaction</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="type">DB</span>.localTx(<span class="keyword">implicit</span> session =&gt; &#123;</span><br><span class="line">      <span class="type">SQL</span>(<span class="string">&quot;insert into tes1t (id,name) values(?,?)&quot;</span>)</span><br><span class="line">        .bind(<span class="number">11</span>, <span class="string">&quot;11&quot;</span>)</span><br><span class="line">        .update()</span><br><span class="line">        .apply()</span><br><span class="line">      <span class="type">SQL</span>(<span class="string">&quot;insert into tes1t (id,name) values(?,?)&quot;</span>)</span><br><span class="line">        .bind(<span class="number">12</span>, <span class="string">&quot;12&quot;</span>)</span><br><span class="line">        .update()</span><br><span class="line">        .apply()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 开启 Scalikejdbc，以及加载配置文件</span></span><br><span class="line">    <span class="type">DBs</span>.setupAll()</span><br><span class="line">    <span class="comment">// 插入数据</span></span><br><span class="line">    insert()</span><br><span class="line">    <span class="comment">// 查询数据</span></span><br><span class="line">    query()</span><br><span class="line">    <span class="comment">// 删除数据</span></span><br><span class="line">    delete()</span><br><span class="line">    <span class="comment">// 通过事务进行插入两条数据</span></span><br><span class="line">    transaction()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">tes1t</span>(<span class="params">id: <span class="type">Int</span>, name: <span class="type">String</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>
    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">scala</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2019/12/03/%E5%88%9D%E8%AF%86Scalikejdbc/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017-2021 <a href="https://rayxk94.github.io/" target="_blank">Ray</a>
    	</div>
      	<div class="footer-right">
			
			
      		GitHub:<a href="https://github.com/JoeyBling/hexo-theme-yilia-plus" target="_blank">hexo-theme-yilia-plus</a> by Litten
      	</div>
    </div>
  </div>
  
  
	<script src="/lib/busuanzi.pure.js"></script>
	
  
  
	
	<span id="busuanzi_container_site_pv" style="display:none">
		本站总访问量<span id="busuanzi_value_site_pv"></span>次	
	        <span class="post-meta-divider" >|</span>
	</span>
  	<span id="busuanzi_container_site_uv" style='display:none'>
  		本站访客数<span id="busuanzi_value_site_uv"></span>人
  	</span>
  
</footer>

    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(r){function e(t){if(i[t])return i[t].exports;var n=i[t]={exports:{},id:t,loaded:!1};return r[t].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};e.m=r,e.c=i,e.p="./",e(0)}([function(t,n,r){r(208),t.exports=r(205)},function(t,n,r){var d=r(3),y=r(46),g=r(26),b=r(27),x=r(47),m="prototype",S=function(t,n,r){var e,i,o,u,c=t&S.F,f=t&S.G,a=t&S.S,s=t&S.P,l=t&S.B,h=f?d:a?d[n]||(d[n]={}):(d[n]||{})[m],v=f?y:y[n]||(y[n]={}),p=v[m]||(v[m]={});for(e in f&&(r=n),r)o=((i=!c&&h&&void 0!==h[e])?h:r)[e],u=l&&i?x(o,d):s&&"function"==typeof o?x(Function.call,o):o,h&&b(h,e,o,t&S.U),v[e]!=o&&g(v,e,u),s&&p[e]!=o&&(p[e]=o)};d.core=y,S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(5);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n,r){var e=r(118)("wks"),i=r(79),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(49),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(174),o=r(53),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(20)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(24);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(22),i=r(60),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(96),i=r(34);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(40)("wks"),i=r(25),o=r(6).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(51);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(18);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=!0},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(11),i=r(75);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var o=r(3),u=r(26),c=r(30),f=r(79)("src"),e=r(219),i="toString",a=(""+e).split(i);r(46).inspectSource=function(t){return e.call(t)},(t.exports=function(t,n,r,e){var i="function"==typeof r;i&&(c(r,"name")||u(r,"name",n)),t[n]!==r&&(i&&(c(r,f)||u(r,f,t[n]?""+t[n]:a.join(String(n)))),t===o?t[n]=r:e?t[n]?t[n]=r:u(t,n,r):(delete t[n],u(t,n,r)))})(Function.prototype,i,function(){return"function"==typeof this&&this[f]||e.call(this)})},function(t,n,r){var e=r(1),i=r(4),u=r(51),c=/"/g,o=function(t,n,r,e){var i=String(u(t)),o="<"+n;return""!==r&&(o+=" "+r+'="'+String(e).replace(c,"&quot;")+'"'),o+">"+i+"</"+n+">"};t.exports=function(n,t){var r={};r[n]=t(o),e(e.P+e.F*i(function(){var t=""[n]('"');return t!==t.toLowerCase()||3<t.split('"').length}),"String",r)}},function(t,n,r){var e=r(65),i=r(35);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(117),i=r(75),o=r(33),u=r(53),c=r(30),f=r(174),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(30),i=r(17),o=r(154)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(116),i=r(51);t.exports=function(t){return e(i(t))}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(9),o=r(16)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(25);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(19),i=r(6),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(23)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var i=r(18);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(6),i=r(19),o=r(23),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(16)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n,r){var o=r(21);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){"use strict";var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var x=r(47),m=r(116),S=r(17),w=r(8),e=r(138);t.exports=function(l,t){var h=1==l,v=2==l,p=3==l,d=4==l,y=6==l,g=5==l||y,b=t||e;return function(t,n,r){for(var e,i,o=S(t),u=m(o),c=x(n,r,3),f=w(u.length),a=0,s=h?b(t,f):v?b(t,0):void 0;a<f;a++)if((g||a in u)&&(i=c(e=u[a],a,o),l))if(h)s[a]=i;else if(i)switch(l){case 3:return!0;case 5:return e;case 6:return a;case 2:s.push(e)}else if(d)return!1;return y?-1:p||d?d:s}}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var i=r(1),o=r(46),u=r(4);t.exports=function(t,n){var r=(o.Object||{})[t]||Object[t],e={};e[t]=n(r),i(i.S+i.F*u(function(){r(1)}),"Object",e)}},function(t,n,r){var i=r(5);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var d=r(6),y=r(19),g=r(93),b=r(13),x=r(9),m="prototype",S=function(t,n,r){var e,i,o,u=t&S.F,c=t&S.G,f=t&S.S,a=t&S.P,s=t&S.B,l=t&S.W,h=c?y:y[n]||(y[n]={}),v=h[m],p=c?d:f?d[n]:(d[n]||{})[m];for(e in c&&(r=n),r)(i=!u&&p&&void 0!==p[e])&&x(h,e)||(o=i?p[e]:r[e],h[e]=c&&"function"!=typeof p[e]?r[e]:s&&i?g(o,d):l&&p[e]==o?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[m]=e[m],t}(o):a&&"function"==typeof o?g(Function.call,o):o,a&&((h.virtual||(h.virtual={}))[e]=o,t&S.R&&v&&!v[e]&&b(v,e,o)))};S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(34);t.exports=function(t){return Object(e(t))}},function(t,n,r){var o=r(196),e=r(1),i=r(118)("metadata"),u=i.store||(i.store=new(r(200))),c=function(t,n,r){var e=u.get(t);if(!e){if(!r)return;u.set(t,e=new o)}var i=e.get(n);if(!i){if(!r)return;e.set(n,i=new o)}return i};t.exports={store:u,map:c,has:function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},get:function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},set:function(t,n,r,e){c(r,e,!0).set(t,n)},keys:function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){e(e.S,"Reflect",t)}}},function(t,n,r){"use strict";if(r(10)){var g=r(68),b=r(3),x=r(4),m=r(1),S=r(132),e=r(159),h=r(47),w=r(70),i=r(75),_=r(26),o=r(76),u=r(49),O=r(8),E=r(194),c=r(78),f=r(53),a=r(30),M=r(81),P=r(5),v=r(17),p=r(145),j=r(72),F=r(32),A=r(73).f,d=r(161),s=r(79),l=r(7),y=r(50),I=r(120),L=r(119),N=r(162),T=r(82),k=r(125),R=r(77),C=r(137),D=r(166),G=r(11),W=r(31),U=G.f,V=W.f,B=b.RangeError,q=b.TypeError,z=b.Uint8Array,K="ArrayBuffer",H="Shared"+K,J="BYTES_PER_ELEMENT",$="prototype",Y=Array[$],X=e.ArrayBuffer,Q=e.DataView,Z=y(0),tt=y(2),nt=y(3),rt=y(4),et=y(5),it=y(6),ot=I(!0),ut=I(!1),ct=N.values,ft=N.keys,at=N.entries,st=Y.lastIndexOf,lt=Y.reduce,ht=Y.reduceRight,vt=Y.join,pt=Y.sort,dt=Y.slice,yt=Y.toString,gt=Y.toLocaleString,bt=l("iterator"),xt=l("toStringTag"),mt=s("typed_constructor"),St=s("def_constructor"),wt=S.CONSTR,_t=S.TYPED,Ot=S.VIEW,Et="Wrong length!",Mt=y(1,function(t,n){return It(L(t,t[St]),n)}),Pt=x(function(){return 1===new z(new Uint16Array([1]).buffer)[0]}),jt=!!z&&!!z[$].set&&x(function(){new z(1).set({})}),Ft=function(t,n){var r=u(t);if(r<0||r%n)throw B("Wrong offset!");return r},At=function(t){if(P(t)&&_t in t)return t;throw q(t+" is not a typed array!")},It=function(t,n){if(!(P(t)&&mt in t))throw q("It is not a typed array constructor!");return new t(n)},Lt=function(t,n){return Nt(L(t,t[St]),n)},Nt=function(t,n){for(var r=0,e=n.length,i=It(t,e);r<e;)i[r]=n[r++];return i},Tt=function(t,n,r){U(t,n,{get:function(){return this._d[r]}})},kt=function(t){var n,r,e,i,o,u,c=v(t),f=arguments.length,a=1<f?arguments[1]:void 0,s=void 0!==a,l=d(c);if(null!=l&&!p(l)){for(u=l.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(s&&2<f&&(a=h(a,arguments[2],2)),n=0,r=O(c.length),i=It(this,r);n<r;n++)i[n]=s?a(c[n],n):c[n];return i},Rt=function(){for(var t=0,n=arguments.length,r=It(this,n);t<n;)r[t]=arguments[t++];return r},Ct=!!z&&x(function(){gt.call(new z(1))}),Dt=function(){return gt.apply(Ct?dt.call(At(this)):At(this),arguments)},Gt={copyWithin:function(t,n){return D.call(At(this),t,n,2<arguments.length?arguments[2]:void 0)},every:function(t){return rt(At(this),t,1<arguments.length?arguments[1]:void 0)},fill:function(t){return C.apply(At(this),arguments)},filter:function(t){return Lt(this,tt(At(this),t,1<arguments.length?arguments[1]:void 0))},find:function(t){return et(At(this),t,1<arguments.length?arguments[1]:void 0)},findIndex:function(t){return it(At(this),t,1<arguments.length?arguments[1]:void 0)},forEach:function(t){Z(At(this),t,1<arguments.length?arguments[1]:void 0)},indexOf:function(t){return ut(At(this),t,1<arguments.length?arguments[1]:void 0)},includes:function(t){return ot(At(this),t,1<arguments.length?arguments[1]:void 0)},join:function(t){return vt.apply(At(this),arguments)},lastIndexOf:function(t){return st.apply(At(this),arguments)},map:function(t){return Mt(At(this),t,1<arguments.length?arguments[1]:void 0)},reduce:function(t){return lt.apply(At(this),arguments)},reduceRight:function(t){return ht.apply(At(this),arguments)},reverse:function(){for(var t,n=this,r=At(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(At(this),t,1<arguments.length?arguments[1]:void 0)},sort:function(t){return pt.call(At(this),t)},subarray:function(t,n){var r=At(this),e=r.length,i=c(t,e);return new(L(r,r[St]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,O((void 0===n?e:c(n,e))-i))}},Wt=function(t,n){return Lt(this,dt.call(At(this),t,n))},Ut=function(t){At(this);var n=Ft(arguments[1],1),r=this.length,e=v(t),i=O(e.length),o=0;if(r<i+n)throw B(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(At(this))},keys:function(){return ft.call(At(this))},values:function(){return ct.call(At(this))}},Bt=function(t,n){return P(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return Bt(t,n=f(n,!0))?i(2,t[n]):V(t,n)},zt=function(t,n,r){return!(Bt(t,n=f(n,!0))&&P(r)&&a(r,"value"))||a(r,"get")||a(r,"set")||r.configurable||a(r,"writable")&&!r.writable||a(r,"enumerable")&&!r.enumerable?U(t,n,r):(t[n]=r.value,t)};wt||(W.f=qt,G.f=zt),m(m.S+m.F*!wt,"Object",{getOwnPropertyDescriptor:qt,defineProperty:zt}),x(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Kt=o({},Gt);o(Kt,Vt),_(Kt,bt,Vt.values),o(Kt,{slice:Wt,set:Ut,constructor:function(){},toString:yt,toLocaleString:Dt}),Tt(Kt,"buffer","b"),Tt(Kt,"byteOffset","o"),Tt(Kt,"byteLength","l"),Tt(Kt,"length","e"),U(Kt,xt,{get:function(){return this[_t]}}),t.exports=function(t,l,n,o){var h=t+((o=!!o)?"Clamped":"")+"Array",r="get"+t,u="set"+t,v=b[h],c=v||{},e=v&&F(v),i=!v||!S.ABV,f={},a=v&&v[$],p=function(t,i){U(t,i,{get:function(){return t=i,(n=this._d).v[r](t*l+n.o,Pt);var t,n},set:function(t){return n=i,r=t,e=this._d,o&&(r=(r=Math.round(r))<0?0:255<r?255:255&r),void e.v[u](n*l+e.o,r,Pt);var n,r,e},enumerable:!0})};i?(v=n(function(t,n,r,e){w(t,v,h,"_d");var i,o,u,c,f=0,a=0;if(P(n)){if(!(n instanceof X||(c=M(n))==K||c==H))return _t in n?Nt(v,n):kt.call(v,n);i=n,a=Ft(r,l);var s=n.byteLength;if(void 0===e){if(s%l)throw B(Et);if((o=s-a)<0)throw B(Et)}else if(s<(o=O(e)*l)+a)throw B(Et);u=o/l}else u=E(n),i=new X(o=u*l);for(_(t,"_d",{b:i,o:a,l:o,e:u,v:new Q(i)});f<u;)p(t,f++)}),a=v[$]=j(Kt),_(a,"constructor",v)):x(function(){v(1)})&&x(function(){new v(-1)})&&k(function(t){new v,new v(null),new v(1.5),new v(t)},!0)||(v=n(function(t,n,r,e){var i;return w(t,v,h),P(n)?n instanceof X||(i=M(n))==K||i==H?void 0!==e?new c(n,Ft(r,l),e):void 0!==r?new c(n,Ft(r,l)):new c(n):_t in n?Nt(v,n):kt.call(v,n):new c(E(n))}),Z(e!==Function.prototype?A(c).concat(A(e)):A(c),function(t){t in v||_(v,t,c[t])}),v[$]=a,g||(a.constructor=v));var s=a[bt],d=!!s&&("values"==s.name||null==s.name),y=Vt.values;_(v,mt,!0),_(a,_t,h),_(a,Ot,!0),_(a,St,v),(o?new v(1)[xt]==h:xt in a)||U(a,xt,{get:function(){return h}}),f[h]=v,m(m.G+m.W+m.F*(v!=c),f),m(m.S,h,{BYTES_PER_ELEMENT:l}),m(m.S+m.F*x(function(){c.of.call(v,1)}),h,{from:kt,of:Rt}),J in a||_(a,J,l),m(m.P,h,Gt),R(h),m(m.P+m.F*jt,h,{set:Ut}),m(m.P+m.F*!d,h,Vt),g||a.toString==yt||(a.toString=yt),m(m.P+m.F*x(function(){new v(1).slice()}),h,{slice:Wt}),m(m.P+m.F*(x(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!x(function(){a.toLocaleString.call([1,2])})),h,{toLocaleString:Dt}),T[h]=d?s:y,g||d||_(a,bt,y)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(18),i=r(6).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(20)(function(){return 7!=Object.defineProperty(r(59)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var x=r(23),m=r(54),S=r(66),w=r(13),_=r(36),O=r(98),E=r(38),M=r(104),P=r(16)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n,e){var i=e(22),o=e(101),u=e(35),c=e(39)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(59)("iframe"),r=u.length;for(n.style.display="none",e(95).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(65),i=r(35).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var u=r(9),c=r(15),f=r(92)(!1),a=r(39)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;null==i[e]&&r(26)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n){t.exports=!1},function(t,n,r){var e=r(79)("meta"),i=r(5),o=r(30),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n,r){var h=r(47),v=r(177),p=r(145),d=r(2),y=r(8),g=r(161),b={},x={};(n=t.exports=function(t,n,r,e,i){var o,u,c,f,a=i?function(){return t}:g(t),s=h(r,e,n?2:1),l=0;if("function"!=typeof a)throw TypeError(t+" is not iterable!");if(p(a)){for(o=y(t.length);l<o;l++)if((f=n?s(d(u=t[l])[0],u[1]):s(t[l]))===b||f===x)return f}else for(c=a.call(t);!(u=c.next()).done;)if((f=v(c,s,u.value,n))===b||f===x)return f}).BREAK=b,n.RETURN=x},function(t,n,e){var i=e(2),o=e(183),u=e(141),c=e(154)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(140)("iframe"),r=u.length;for(n.style.display="none",e(143).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(185),i=r(141).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(185),i=r(141);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,r){var i=r(27);t.exports=function(t,n,r){for(var e in n)i(t,e,n[e],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(49),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(5);t.exports=function(t,n){if(!e(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}},function(t,n,r){var i=r(45),o=r(7)("toStringTag"),u="Arguments"==i(function(){return arguments}());t.exports=function(t){var n,r,e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,n){try{return t[n]}catch(t){}}(n=Object(t),o))?r:u?i(n):"Object"==(e=i(n))&&"function"==typeof n.callee?"Arguments":e}},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(30),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var u=r(1),e=r(51),c=r(4),f=r(157),i="["+f+"]",o=RegExp("^"+i+i+"*"),a=RegExp(i+i+"*$"),s=function(t,n,r){var e={},i=c(function(){return!!f[t]()||"​"!="​"[t]()}),o=e[t]=i?n(l):f[t];r&&(e[r]=o),u(u.P+u.F*i,"String",e)},l=s.trim=function(t,n){return t=String(e(t)),1&n&&(t=t.replace(o,"")),2&n&&(t=t.replace(a,"")),t};t.exports=s},function(t,n,r){t.exports={default:r(88),__esModule:!0}},function(t,n,r){t.exports={default:r(89),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=e(r(86)),o=e(r(85)),u="function"==typeof o.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":typeof t};n.default="function"==typeof o.default&&"symbol"===u(i.default)?function(t){return void 0===t?"undefined":u(t)}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":void 0===t?"undefined":u(t)}},function(t,n,r){r(111),r(109),r(112),r(113),t.exports=r(19).Symbol},function(t,n,r){r(110),r(114),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var f=r(15),a=r(107),s=r(106);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){var o=r(90);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){var c=r(29),f=r(64),a=r(37);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){var e=r(6).document;t.exports=e&&e.documentElement},function(t,n,r){var e=r(58);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(58);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(62),i=r(24),o=r(38),u={};r(13)(u,r(16)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(25)("meta"),i=r(18),o=r(9),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(20)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n,r){var u=r(14),c=r(22),f=r(29);t.exports=r(12)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(24),o=r(15),u=r(42),c=r(9),f=r(60),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(15),i=r(63).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var e=r(9),i=r(55),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var f=r(41),a=r(34);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(91),i=r(99),o=r(36),u=r(15);t.exports=r(61)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(105)(!0);r(61)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(6),u=r(9),i=r(12),o=r(54),c=r(66),f=r(100).KEY,a=r(20),s=r(40),l=r(38),h=r(25),v=r(16),p=r(44),d=r(43),y=r(94),g=r(97),b=r(22),x=r(18),m=r(55),S=r(15),w=r(42),_=r(24),O=r(62),E=r(103),M=r(102),P=r(64),j=r(14),F=r(29),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(63).f=E.f=tt,r(37).f=Q,P.f=nt,i&&!r(23)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(13)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(108);for(var e=r(6),i=r(13),o=r(36),u=r(16)("toStringTag"),c="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),f=0;f<c.length;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(46),i=r(3),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(68)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n,r){var i=r(2),o=r(21),u=r(7)("species");t.exports=function(t,n){var r,e=i(t).constructor;return void 0===e||null==(r=i(e)[u])?n:o(r)}},function(t,n,r){var f=r(33),a=r(8),s=r(78);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){"use strict";var g=r(3),b=r(1),x=r(27),m=r(76),S=r(69),w=r(71),_=r(70),O=r(5),E=r(4),M=r(125),P=r(83),j=r(144);t.exports=function(e,t,n,r,i,o){var u=g[e],c=u,f=i?"set":"add",a=c&&c.prototype,s={},l=function(t){var r=a[t];x(a,t,"delete"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!O(t)?void 0:r.call(this,0===t?0:t)}:"add"==t?function(t){return r.call(this,0===t?0:t),this}:function(t,n){return r.call(this,0===t?0:t,n),this})};if("function"==typeof c&&(o||a.forEach&&!E(function(){(new c).entries().next()}))){var h=new c,v=h[f](o?{}:-0,1)!=h,p=E(function(){h.has(1)}),d=M(function(t){new c(t)}),y=!o&&E(function(){for(var t=new c,n=5;n--;)t[f](n,n);return!t.has(-0)});d||(((c=t(function(t,n){_(t,c,e);var r=j(new u,t,c);return null!=n&&w(n,i,r[f],r),r})).prototype=a).constructor=c),(p||y)&&(l("delete"),l("has"),i&&l("get")),(y||v)&&l(f),o&&a.clear&&delete a.clear}else c=r.getConstructor(t,e,i,f),m(c.prototype,n),S.NEED=!0;return P(c,e),s[e]=c,b(b.G+b.W+b.F*(c!=u),s),o||r.setStrong(c,e,i),c}},function(t,n,r){"use strict";r(197);var s=r(27),l=r(26),h=r(4),v=r(51),p=r(7),d=r(152),y=p("species"),g=!h(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}),b=function(){var t=/(?:)/,n=t.exec;t.exec=function(){return n.apply(this,arguments)};var r="ab".split(t);return 2===r.length&&"a"===r[0]&&"b"===r[1]}();t.exports=function(r,t,n){var e=p(r),o=!h(function(){var t={};return t[e]=function(){return 7},7!=""[r](t)}),i=o?!h(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===r&&(n.constructor={},n.constructor[y]=function(){return n}),n[e](""),!t}):void 0;if(!o||!i||"replace"===r&&!g||"split"===r&&!b){var u=/./[e],c=n(v,e,""[r],function(t,n,r,e,i){return n.exec===d?o&&!i?{done:!0,value:u.call(n,r,e)}:{done:!0,value:t.call(r,n,e)}:{done:!1}}),f=c[0],a=c[1];s(String.prototype,r,f),l(RegExp.prototype,e,2==t?function(t,n){return a.call(t,this,n)}:function(t){return a.call(t,this)})}}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){var e=r(5),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var o=r(7)("iterator"),u=!1;try{var e=[7][o]();e.return=function(){u=!0},Array.from(e,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!u)return!1;var r=!1;try{var e=[7],i=e[o]();i.next=function(){return{done:r=!0}},e[o]=function(){return i},t(e)}catch(t){}return r}},function(t,n,r){"use strict";t.exports=r(68)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){"use strict";var i=r(81),o=RegExp.prototype.exec;t.exports=function(t,n){var r=t.exec;if("function"==typeof r){var e=r.call(t,n);if("object"!=typeof e)throw new TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==i(t))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(t,n)}},function(t,n,r){"use strict";var e=r(1),u=r(21),c=r(47),f=r(71);t.exports=function(t){e(e.S,t,{from:function(t){var n,r,e,i,o=arguments[1];return u(this),(n=void 0!==o)&&u(o),null==t?new this:(r=[],n?(e=0,i=c(o,arguments[2],2),f(t,!1,function(t){r.push(i(t,e++))})):f(t,!1,r.push,r),new this(r))}})}},function(t,n,r){"use strict";var e=r(1);t.exports=function(t){e(e.S,t,{of:function(){for(var t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return new this(n)}})}},function(t,n,r){var f=r(49),a=r(51);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){for(var e,i=r(3),o=r(26),u=r(79),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n,r){var e=r(3).navigator;t.exports=e&&e.userAgent||""},function(t,n){"use strict";var r,e={versions:(r=window.navigator.userAgent,{trident:-1<r.indexOf("Trident"),presto:-1<r.indexOf("Presto"),webKit:-1<r.indexOf("AppleWebKit"),gecko:-1<r.indexOf("Gecko")&&-1==r.indexOf("KHTML"),mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<r.indexOf("Android")||-1<r.indexOf("Linux"),iPhone:-1<r.indexOf("iPhone")||-1<r.indexOf("Mac"),iPad:-1<r.indexOf("iPad"),webApp:-1==r.indexOf("Safari"),weixin:-1==r.indexOf("MicroMessenger")})};t.exports=e},function(t,n,r){"use strict";var e,i=r(87),l=(e=i)&&e.__esModule?e:{default:e},h=function(){function n(t,n,r){return n||r?String.fromCharCode(n||r):o[t]||t}function r(t){return s[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,i=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},u=/\u00a0/g,c=/<br\s*\/?>/gi,f=/\r?\n/g,a=/\s/g,s={};for(var t in o)s[o[t]]=t;return o["&apos;"]="'",s["'"]="&#39;",{encode:function(t){return t?(""+t).replace(i,r).replace(f,"<br/>").replace(a,"&nbsp;"):""},decode:function(t){return t?(""+t).replace(c,"\n").replace(e,n).replace(u," "):""},encodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;for(var n=[],r=0,e=(t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")})).length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;n<r;n++)t[n]=h.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,l.default)(t)))for(var e in t)t[e]=h.encodeObject(t[e]);else if("string"==typeof t)return h.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=h},function(t,n,r){"use strict";var e=r(131)(!0);t.exports=function(t,n,r){return n+(r?e(t,n).length:1)}},function(t,n,r){"use strict";var c=r(17),f=r(78),a=r(8);t.exports=function(t){for(var n=c(this),r=a(n.length),e=arguments.length,i=f(1<e?arguments[1]:void 0,r),o=2<e?arguments[2]:void 0,u=void 0===o?r:f(o,r);i<u;)n[i++]=t;return n}},function(t,n,r){var e=r(215);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(11),i=r(75);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(5),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(n){var r=/./;try{"/./"[n](r)}catch(t){try{return r[e]=!1,!"/./"[n](r)}catch(n){}}return!0}},function(t,n,r){var e=r(3).document;t.exports=e&&e.documentElement},function(t,n,r){var o=r(5),u=r(153).set;t.exports=function(t,n,r){var e,i=n.constructor;return i!==r&&"function"==typeof i&&(e=i.prototype)!==r.prototype&&o(e)&&u&&u(t,e),t}},function(t,n,r){var e=r(82),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){"use strict";var e=r(72),i=r(75),o=r(83),u={};r(26)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var x=r(68),m=r(1),S=r(27),w=r(26),_=r(82),O=r(146),E=r(83),M=r(32),P=r(7)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n){var r=Math.expm1;t.exports=!r||22025.465794806718<r(10)||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:-1e-6<t&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var c=r(3),f=r(158).set,a=c.MutationObserver||c.WebKitMutationObserver,s=c.process,l=c.Promise,h="process"==r(45)(s);t.exports=function(){var r,e,i,t=function(){var t,n;for(h&&(t=s.domain)&&t.exit();r;){n=r.fn,r=r.next;try{n()}catch(t){throw r?i():e=void 0,t}}e=void 0,t&&t.enter()};if(h)i=function(){s.nextTick(t)};else if(!a||c.navigator&&c.navigator.standalone)if(l&&l.resolve){var n=l.resolve(void 0);i=function(){n.then(t)}}else i=function(){f.call(c,t)};else{var o=!0,u=document.createTextNode("");new a(t).observe(u,{characterData:!0}),i=function(){u.data=o=!o}}return function(t){var n={fn:t,next:void 0};e&&(e.next=n),r||(r=n,i()),e=n}}},function(t,n,r){"use strict";function e(t){var r,e;this.promise=new t(function(t,n){if(void 0!==r||void 0!==e)throw TypeError("Bad Promise constructor");r=t,e=n}),this.resolve=i(r),this.reject=i(e)}var i=r(21);t.exports.f=function(t){return new e(t)}},function(t,n,r){"use strict";var e,i,u=r(115),c=RegExp.prototype.exec,f=String.prototype.replace,o=c,a="lastIndex",s=(e=/a/,i=/b*/g,c.call(e,"a"),c.call(i,"a"),0!==e[a]||0!==i[a]),l=void 0!==/()??/.exec("")[1];(s||l)&&(o=function(t){var n,r,e,i,o=this;return l&&(r=new RegExp("^"+o.source+"$(?!\\s)",u.call(o))),s&&(n=o[a]),e=c.call(o,t),s&&e&&(o[a]=o.global?e.index+e[0].length:n),l&&e&&1<e.length&&f.call(e[0],r,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(e[i]=void 0)}),e}),t.exports=o},function(t,n,i){var r=i(5),e=i(2),o=function(t,n){if(e(t),!r(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r,e){try{(e=i(47)(Function.call,i(31).f(Object.prototype,"__proto__").set,2))(t,[]),r=!(t instanceof Array)}catch(t){r=!0}return function(t,n){return o(t,n),r?t.__proto__=n:e(t,n),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(118)("keys"),i=r(79);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(124),i=r(51);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var i=r(49),o=r(51);t.exports=function(t){var n=String(o(this)),r="",e=i(t);if(e<0||e==1/0)throw RangeError("Count can't be negative");for(;0<e;(e>>>=1)&&(n+=n))1&e&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(47),c=r(175),f=r(143),a=r(140),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=s.Dispatch,y=0,g={},b="onreadystatechange",x=function(){var t=+this;if(g.hasOwnProperty(t)){var n=g[t];delete g[t],n()}},m=function(t){x.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return g[++y]=function(){c("function"==typeof t?t:Function(t),n)},e(y),y},v=function(t){delete g[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(x,t,1))}:d&&d.now?e=function(t){d.now(u(x,t,1))}:p?(o=(i=new p).port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=b in a("script")?function(t){f.appendChild(a("script"))[b]=function(){f.removeChild(this),x.call(t)}}:function(t){setTimeout(u(x,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";function e(t,n,r){var e,i,o,u=new Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?W(2,-24)-W(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for((t=G(t))!=t||t===C?(i=t!=t?1:0,e=f):(e=U(V(t)/B),t*(o=W(2,-e))<1&&(e--,o*=2),2<=(t+=1<=e+a?s/o:s*W(2,1-a))*o&&(e++,o/=2),f<=e+a?(i=0,e=f):1<=e+a?(i=(t*o-1)*W(2,n),e+=a):(i=t*W(2,a-1)*W(2,n),e=0));8<=n;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;0<c;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u}function i(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;0<c;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;0<c;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-C:C;e+=W(2,n),s-=u}return(a?-1:1)*e*W(2,s-n)}function o(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function u(t){return[255&t]}function c(t){return[255&t,t>>8&255]}function f(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function a(t){return e(t,52,8)}function s(t){return e(t,23,4)}function l(t,n,r){M(t[I],n,{get:function(){return this[r]}})}function h(t,n,r,e){var i=O(+r);if(i+n>t[H])throw R(L);var o=t[K]._b,u=i+t[J],c=o.slice(u,u+n);return e?c:c.reverse()}function v(t,n,r,e,i,o){var u=O(+r);if(u+n>t[H])throw R(L);for(var c=t[K]._b,f=u+t[J],a=e(+i),s=0;s<n;s++)c[f+s]=a[o?s:n-s-1]}var p=r(3),d=r(10),y=r(68),g=r(132),b=r(26),x=r(76),m=r(4),S=r(70),w=r(49),_=r(8),O=r(194),E=r(73).f,M=r(11).f,P=r(137),j=r(83),F="ArrayBuffer",A="DataView",I="prototype",L="Wrong index!",N=p[F],T=p[A],k=p.Math,R=p.RangeError,C=p.Infinity,D=N,G=k.abs,W=k.pow,U=k.floor,V=k.log,B=k.LN2,q="byteLength",z="byteOffset",K=d?"_b":"buffer",H=d?"_l":q,J=d?"_o":z;if(g.ABV){if(!m(function(){N(1)})||!m(function(){new N(-1)})||m(function(){return new N,new N(1.5),new N(NaN),N.name!=F})){for(var $,Y=(N=function(t){return S(this,N),new D(O(t))})[I]=D[I],X=E(D),Q=0;X.length>Q;)($=X[Q++])in N||b(N,$,D[$]);y||(Y.constructor=N)}var Z=new T(new N(2)),tt=T[I].setInt8;Z.setInt8(0,2147483648),Z.setInt8(1,2147483649),!Z.getInt8(0)&&Z.getInt8(1)||x(T[I],{setInt8:function(t,n){tt.call(this,t,n<<24>>24)},setUint8:function(t,n){tt.call(this,t,n<<24>>24)}},!0)}else N=function(t){S(this,N,F);var n=O(t);this._b=P.call(new Array(n),0),this[H]=n},T=function(t,n,r){S(this,T,A),S(t,N,A);var e=t[H],i=w(n);if(i<0||e<i)throw R("Wrong offset!");if(e<i+(r=void 0===r?e-i:_(r)))throw R("Wrong length!");this[K]=t,this[J]=i,this[H]=r},d&&(l(N,q,"_l"),l(T,"buffer","_b"),l(T,q,"_l"),l(T,z,"_o")),x(T[I],{getInt8:function(t){return h(this,1,t)[0]<<24>>24},getUint8:function(t){return h(this,1,t)[0]},getInt16:function(t){var n=h(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=h(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return o(h(this,4,t,arguments[1]))},getUint32:function(t){return o(h(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return i(h(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return i(h(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){v(this,1,t,u,n)},setUint8:function(t,n){v(this,1,t,u,n)},setInt16:function(t,n){v(this,2,t,c,n,arguments[2])},setUint16:function(t,n){v(this,2,t,c,n,arguments[2])},setInt32:function(t,n){v(this,4,t,f,n,arguments[2])},setUint32:function(t,n){v(this,4,t,f,n,arguments[2])},setFloat32:function(t,n){v(this,4,t,s,n,arguments[2])},setFloat64:function(t,n){v(this,8,t,a,n,arguments[2])}});j(N,F),j(T,A),b(T[I],g.VIEW,!0),n[F]=N,n[A]=T},function(t,n,r){var e=r(3),i=r(46),o=r(68),u=r(195),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(81),i=r(7)("iterator"),o=r(82);t.exports=r(46).getIteratorMethod=function(t){if(null!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(67),i=r(178),o=r(82),u=r(33);t.exports=r(147)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){t.exports=function(t,n){t.classList?t.classList.add(n):t.className+=" "+n}},function(t,n){t.exports=function(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var a=r(17),s=r(78),l=r(8);t.exports=[].copyWithin||function(t,n){var r=a(this),e=l(r.length),i=s(t,e),o=s(n,e),u=2<arguments.length?arguments[2]:void 0,c=Math.min((void 0===u?e:s(u,e))-o,e-i),f=1;for(o<i&&i<o+c&&(f=-1,o+=c-1,i+=c-1);0<c--;)o in r?r[i]=r[o]:delete r[i],i+=f,o+=f;return r}},function(t,n,r){var e=r(71);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var s=r(21),l=r(17),h=r(116),v=r(8);t.exports=function(t,n,r,e,i){s(n);var o=l(t),u=h(o),c=v(o.length),f=i?c-1:0,a=i?-1:1;if(r<2)for(;;){if(f in u){e=u[f],f+=a;break}if(f+=a,i?f<0:c<=f)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=f:f<c;f+=a)f in u&&(e=n(e,u[f],f,o));return e}},function(t,n,r){"use strict";var o=r(21),u=r(5),c=r(175),f=[].slice,a={};t.exports=Function.bind||function(n){var r=o(this),e=f.call(arguments,1),i=function(){var t=e.concat(f.call(arguments));return this instanceof i?function(t,n,r){if(!(n in a)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";a[n]=Function("F,a","return new F("+e.join(",")+")")}return a[n](t,r)}(r,t.length,t):c(r,t,n)};return u(r.prototype)&&(i.prototype=r.prototype),i}},function(t,n,r){"use strict";var u=r(11).f,c=r(72),f=r(76),a=r(47),s=r(70),l=r(71),e=r(147),i=r(178),o=r(77),h=r(10),v=r(69).fastKey,p=r(80),d=h?"_s":"size",y=function(t,n){var r,e=v(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,o,r,e){var i=t(function(t,n){s(t,i,o,"_i"),t._t=o,t._i=c(null),t._f=void 0,t._l=void 0,t[d]=0,null!=n&&l(n,r,t[e],t)});return f(i.prototype,{clear:function(){for(var t=p(this,o),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=p(this,o),r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){p(this,o);for(var n,r=a(t,1<arguments.length?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(p(this,o),t)}}),h&&u(i.prototype,"size",{get:function(){return p(this,o)[d]}}),i},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=v(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,r,n){e(t,r,function(t,n){this._t=p(t,r),this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?i(0,"keys"==n?r.k:"values"==n?r.v:[r.k,r.v]):(t._t=void 0,i(1))},n?"entries":"values",!n,!0),o(r)}}},function(t,n,r){var e=r(81),i=r(167);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var u=r(76),c=r(69).getWeak,i=r(2),f=r(5),a=r(70),s=r(71),e=r(50),l=r(30),h=r(80),o=e(5),v=e(6),p=0,d=function(t){return t._l||(t._l=new y)},y=function(){this.a=[]},g=function(t,n){return o(t.a,function(t){return t[0]===n})};y.prototype={get:function(t){var n=g(this,t);if(n)return n[1]},has:function(t){return!!g(this,t)},set:function(t,n){var r=g(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(n){var t=v(this.a,function(t){return t[0]===n});return~t&&this.a.splice(t,1),!!~t}},t.exports={getConstructor:function(t,r,e,i){var o=t(function(t,n){a(t,o,r,"_i"),t._t=r,t._i=p++,t._l=void 0,null!=n&&s(n,e,t[i],t)});return u(o.prototype,{delete:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).delete(t):n&&l(n,this._i)&&delete n[this._i]},has:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).has(t):n&&l(n,this._i)}}),o},def:function(t,n,r){var e=c(i(n),!0);return!0===e?d(t).set(n,r):e[t._i]=r,t},ufstore:d}},function(t,n,r){"use strict";var p=r(123),d=r(5),y=r(8),g=r(47),b=r(7)("isConcatSpreadable");t.exports=function t(n,r,e,i,o,u,c,f){for(var a,s,l=o,h=0,v=!!c&&g(c,f,3);h<i;){if(h in e){if(a=v?v(e[h],h,r):e[h],s=!1,d(a)&&(s=void 0!==(s=a[b])?!!s:p(a)),s&&0<u)l=t(n,r,a,y(a.length),l,u-1)-1;else{if(9007199254740991<=l)throw TypeError();n[l]=a}l++}h++}return l}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(140)("div"),"a",{get:function(){return 7}}).a})},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(5),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var o=r(2);t.exports=function(t,n,r,e){try{return e?n(o(r)[0],r[1]):n(r)}catch(n){var i=t.return;throw void 0!==i&&o(i.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var o=r(149),e=Math.pow,u=e(2,-52),c=e(2,-23),f=e(2,127)*(2-c),a=e(2,-126);t.exports=Math.fround||function(t){var n,r,e=Math.abs(t),i=o(t);return e<a?i*(e/a/c+1/u-1/u)*a*c:f<(r=(n=(1+c/u)*e)-(n-e))||r!=r?i*(1/0):i*r}},function(t,n){t.exports=Math.log1p||function(t){return-1e-8<(t=+t)&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n){t.exports=Math.scale||function(t,n,r,e,i){return 0===arguments.length||t!=t||n!=n||r!=r||e!=e||i!=i?NaN:t===1/0||t===-1/0?t:(t-n)*(i-e)/(r-n)+e}},function(t,n,r){"use strict";var h=r(10),v=r(74),p=r(127),d=r(117),y=r(17),g=r(116),i=Object.assign;t.exports=!i||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=i({},t)[r]||Object.keys(i({},n)).join("")!=e})?function(t,n){for(var r=y(t),e=arguments.length,i=1,o=p.f,u=d.f;i<e;)for(var c,f=g(arguments[i++]),a=o?v(f).concat(o(f)):v(f),s=a.length,l=0;l<s;)c=a[l++],h&&!u.call(f,c)||(r[c]=f[c]);return r}:i},function(t,n,r){var u=r(11),c=r(2),f=r(74);t.exports=r(10)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(33),i=r(73).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var u=r(30),c=r(33),f=r(120)(!1),a=r(154)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){var f=r(10),a=r(74),s=r(33),l=r(117).f;t.exports=function(c){return function(t){for(var n,r=s(t),e=a(r),i=e.length,o=0,u=[];o<i;)n=e[o++],f&&!l.call(r,n)||u.push(c?[n,r[n]]:r[n]);return u}}},function(t,n,r){var e=r(73),i=r(127),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(84).trim;t.exports=1/e(r(157)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(84).trim,o=r(157),u=/^[-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,n,r){var e=r(2),i=r(5),o=r(151);t.exports=function(t,n){if(e(t),i(n)&&n.constructor===t)return n;var r=o.f(t);return(0,r.resolve)(n),r.promise}},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var s=r(8),l=r(156),h=r(51);t.exports=function(t,n,r,e){var i=String(h(t)),o=i.length,u=void 0===r?" ":String(r),c=s(n);if(c<=o||""==u)return i;var f=c-o,a=l.call(u,Math.ceil(f/u.length));return a.length>f&&(a=a.slice(0,f)),e?a+i:i+a}},function(t,n,r){var e=r(49),i=r(8);t.exports=function(t){if(void 0===t)return 0;var n=e(t),r=i(n);if(n!==r)throw RangeError("Wrong length!");return r}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Map",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(i(this,"Map"),t);return n&&n.v},set:function(t,n){return e.def(i(this,"Map"),0===t?0:t,n)}},e,!0)},function(t,n,r){"use strict";var e=r(152);r(1)({target:"RegExp",proto:!0,forced:e!==/./.exec},{exec:e})},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(115)})},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Set",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"Set"),t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var o,e=r(3),i=r(50)(0),u=r(27),c=r(69),f=r(182),a=r(172),s=r(5),l=r(80),h=r(80),v=!e.ActiveXObject&&"ActiveXObject"in e,p="WeakMap",d=c.getWeak,y=Object.isExtensible,g=a.ufstore,b=function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},x={get:function(t){if(s(t)){var n=d(t);return!0===n?g(l(this,p)).get(t):n?n[this._i]:void 0}},set:function(t,n){return a.def(l(this,p),t,n)}},m=t.exports=r(121)(p,b,x,a,!0,!0);h&&v&&(f((o=a.getConstructor(b,p)).prototype,x),c.NEED=!0,i(["delete","has","get","set"],function(e){var t=m.prototype,i=t[e];u(t,e,function(t,n){if(!s(t)||y(t))return i.call(this,t,n);this._f||(this._f=new o);var r=this._f[e](t,n);return"set"==e?this:r})}))},,,,function(t,n){"use strict";t.exports={init:function(){var t=document.querySelector("#page-nav");t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new&&document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")}),yiliaConfig&&yiliaConfig.toc_hide_index&&document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n,r,e,i){var o=function(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}(t),u=function(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}(t)-n;if(u-r<=i){var c=t.$newDom;c||(c=t.cloneNode(!0),(0,a.default)(t,c),(t.$newDom=c).style.position="fixed",c.style.top=(r||u)+"px",c.style.left=o+"px",c.style.zIndex=e||2,c.style.width="100%",c.style.color="#fff"),c.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var f=t.$newDom;f&&(f.style.visibility="hidden")}}function o(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");i(t,document.body.scrollTop,-63,2,0),i(n,document.body.scrollTop,1,3,0)}var f=e(r(163)),a=e((e(r(164)),r(414))),u=e(r(134)),c=e(r(204)),s=r(135);u.default.versions.mobile&&window.screen.width<800&&(function(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var i=t[r];o=n,u=i.getAttribute("href"),c=/\/|index.html/g,o.replace(c,"")===u.replace(c,"")&&(0,f.default)(i,"active")}var o,u,c}(),document.querySelector("#container").addEventListener("scroll",function(t){o()}),window.addEventListener("scroll",function(t){o()}),o()),(0,s.addLoadEvent)(function(){c.default.init()}),t.exports={}},,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object.defineProperty(t,n,{writable:!0,configurable:!0,value:r})}if(r(413),r(209),r(211),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},function(L,t){(function(t){!function(t){"use strict";function o(t,n,r,e){var o,u,c,f,i=n&&n.prototype instanceof h?n:h,a=Object.create(i.prototype),s=new p(e||[]);return a._invoke=(o=t,u=r,c=s,f=_,function(t,n){if(f===E)throw new Error("Generator is already running");if(f===M){if("throw"===t)throw n;return d()}for(c.method=t,c.arg=n;;){var r=c.delegate;if(r){var e=v(r,c);if(e){if(e===P)continue;return e}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(f===_)throw f=M,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);f=E;var i=l(o,u,c);if("normal"===i.type){if(f=c.done?M:O,i.arg===P)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(f=M,c.method="throw",c.arg=i.arg)}}),a}function l(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function h(){}function r(){}function n(){}function e(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function u(c){function f(t,n,r,e){var i=l(c[t],c,n);if("throw"!==i.type){var o=i.arg,u=o.value;return u&&"object"==typeof u&&y.call(u,"__await")?Promise.resolve(u.__await).then(function(t){f("next",t,r,e)},function(t){f("throw",t,r,e)}):Promise.resolve(u).then(function(t){o.value=t,r(o)},e)}e(i.arg)}var n;"object"==typeof t.process&&t.process.domain&&(f=t.process.domain.bind(f)),this._invoke=function(r,e){function t(){return new Promise(function(t,n){f(r,e,t,n)})}return n=n?n.then(t,t):t()}}function v(t,n){var r=t.iterator[n.method];if(r===a){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=a,v(t,n),"throw"===n.method))return P;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return P}var e=l(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,P;var i=e.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=a),n.delegate=null,P):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,P)}function i(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function c(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(i,this),this.reset(!0)}function f(n){if(n){var t=n[b];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,e=function t(){for(;++r<n.length;)if(y.call(n,r))return t.value=n[r],t.done=!1,t;return t.value=a,t.done=!0,t};return e.next=e}}return{next:d}}function d(){return{value:a,done:!0}}var a,s=Object.prototype,y=s.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},b=g.iterator||"@@iterator",x=g.asyncIterator||"@@asyncIterator",m=g.toStringTag||"@@toStringTag",S="object"==typeof L,w=t.regeneratorRuntime;if(w)S&&(L.exports=w);else{(w=t.regeneratorRuntime=S?L.exports:{}).wrap=o;var _="suspendedStart",O="suspendedYield",E="executing",M="completed",P={},j={};j[b]=function(){return this};var F=Object.getPrototypeOf,A=F&&F(F(f([])));A&&A!==s&&y.call(A,b)&&(j=A);var I=n.prototype=h.prototype=Object.create(j);r.prototype=I.constructor=n,n.constructor=r,n[m]=r.displayName="GeneratorFunction",w.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===r||"GeneratorFunction"===(n.displayName||n.name))},w.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,n):(t.__proto__=n,m in t||(t[m]="GeneratorFunction")),t.prototype=Object.create(I),t},w.awrap=function(t){return{__await:t}},e(u.prototype),u.prototype[x]=function(){return this},w.AsyncIterator=u,w.async=function(t,n,r,e){var i=new u(o(t,n,r,e));return w.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},e(I),I[m]="Generator",I[b]=function(){return this},I.toString=function(){return"[object Generator]"},w.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},w.values=f,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(c),!t)for(var n in this)"t"===n.charAt(0)&&y.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=a)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){function t(t,n){return o.type="throw",o.arg=r,e.next=t,n&&(e.method="next",e.arg=a),!!n}if(this.done)throw r;for(var e=this,n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var u=y.call(i,"catchLoc"),c=y.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;0<=r;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&y.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,P):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),P},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),c(r),P}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;c(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:f(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=a),P}}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())},,function(t,n,r){r(221),t.exports=r(46).RegExp.escape},,,,function(t,n,r){var e=r(5),i=r(123),o=r(7)("species");t.exports=function(t){var n;return i(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&(null===(n=n[o])&&(n=void 0))),void 0===n?Array:n}},function(t,n,r){"use strict";var e=r(4),i=Date.prototype.getTime,o=Date.prototype.toISOString,u=function(t){return 9<t?t:"0"+t};t.exports=e(function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))})||!e(function(){o.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":9999<n?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(99<r?r:"0"+u(r))+"Z"}:o},function(t,n,r){"use strict";var e=r(2),i=r(53);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),"number"!=t)}},function(t,n,r){var c=r(74),f=r(127),a=r(117);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){t.exports=r(118)("native-function-to-string",Function.toString)},function(t,n){t.exports=function(n,r){var e=r===Object(r)?function(t){return r[t]}:r;return function(t){return String(t).replace(n,e)}}},function(t,n,r){var e=r(1),i=r(220)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(166)}),r(67)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(50)(4);e(e.P+e.F*!r(48)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(137)}),r(67)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(50)(2);e(e.P+e.F*!r(48)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(0),o=r(48)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var h=r(47),e=r(1),v=r(17),p=r(177),d=r(145),y=r(8),g=r(139),b=r(161);e(e.S+e.F*!r(125)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,e,i,o=v(t),u="function"==typeof this?this:Array,c=arguments.length,f=1<c?arguments[1]:void 0,a=void 0!==f,s=0,l=b(o);if(a&&(f=h(f,2<c?arguments[2]:void 0,2)),null==l||u==Array&&d(l))for(r=new u(n=y(o.length));s<n;s++)g(r,s,a?f(o[s],s):o[s]);else for(i=l.call(o),r=new u;!(e=i.next()).done;s++)g(r,s,a?p(i,f,[e.value,s],!0):e.value);return r.length=s,r}})},function(t,n,r){"use strict";var e=r(1),i=r(120)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(48)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(123)})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=[].join;e(e.P+e.F*(r(116)!=Object||!r(48)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=r(49),u=r(8),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(48)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(1<arguments.length&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);0<=e;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(1);e(e.P+e.F*!r(48)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(139);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);t<n;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(143),a=r(45),s=r(78),l=r(8),h=[].slice;e(e.P+e.F*r(4)(function(){i&&h.call(i)}),"Array",{slice:function(t,n){var r=l(this.length),e=a(this);if(n=void 0===n?r:n,"Array"==e)return h.call(this,t,n);for(var i=s(t,r),o=s(n,r),u=l(o-i),c=new Array(u),f=0;f<u;f++)c[f]="String"==e?this.charAt(i+f):this[i+f];return c}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(3);e(e.P+e.F*!r(48)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(21),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(48)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(77)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){var e=r(1),i=r(216);e(e.P+e.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(26)(i,e,r(217))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(27)(e,o,function(){var t=c.call(this);return t==t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(169)})},function(t,n,r){"use strict";var e=r(5),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||r(10)&&e(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(180),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:94906265.62425156<t?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){var e=r(1),i=Math.asinh;e(e.S+e.F*!(i&&0<1/i(0)),"Math",{asinh:function t(n){return isFinite(n=+n)&&0!=n?n<0?-t(-n):Math.log(n+Math.sqrt(n*n+1)):n}})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(149);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(148);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1);e(e.S,"Math",{fround:r(179)})},function(t,n,r){var e=r(1),f=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,i=0,o=0,u=arguments.length,c=0;o<u;)c<(r=f(arguments[o++]))?(i=i*(e=c/r)*e+1,c=r):0<r?i+=(e=r/c)*e:i+=r;return c===1/0?1/0:c*Math.sqrt(i)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(180)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(149)})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(0<t?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(30),o=r(45),u=r(144),s=r(53),c=r(4),f=r(73).f,a=r(31).f,l=r(11).f,h=r(84).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(72)(y))==v,b="trim"in String.prototype,x=function(t){var n=s(t,!1);if("string"==typeof n&&2<n.length){var r,e,i,o=(n=b?n.trim():h(n,3)).charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,c=n.slice(2),f=0,a=c.length;f<a;f++)if((u=c.charCodeAt(f))<48||i<u)return NaN;return parseInt(c,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?c(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(x(n)),r,p):x(n)};for(var m,S=r(10)?f(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;S.length>w;w++)i(d,m=S[w])&&!i(p,m)&&l(p,m,a(d,m));(p.prototype=y).constructor=p,r(27)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(176)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(176),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(188);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),a=r(49),s=r(165),l=r(156),i=1..toFixed,o=Math.floor,u=[0,0,0,0,0,0],h="Number.toFixed: incorrect invocation!",v=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*u[r],u[r]=e%1e7,e=o(e/1e7)},p=function(t){for(var n=6,r=0;0<=--n;)r+=u[n],u[n]=o(r/t),r=r%t*1e7},d=function(){for(var t=6,n="";0<=--t;)if(""!==n||0===t||0!==u[t]){var r=String(u[t]);n=""===n?r:n+l.call("0",7-r.length)+r}return n},y=function(t,n,r){return 0===n?r:n%2==1?y(t,n-1,r*t):y(t*t,n/2,r)};e(e.P+e.F*(!!i&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){i.call({})})),"Number",{toFixed:function(t){var n,r,e,i,o=s(this,h),u=a(t),c="",f="0";if(u<0||20<u)throw RangeError(h);if(o!=o)return"NaN";if(o<=-1e21||1e21<=o)return String(o);if(o<0&&(c="-",o=-o),1e-21<o)if(r=(n=function(t){for(var n=0,r=t;4096<=r;)n+=12,r/=4096;for(;2<=r;)n+=1,r/=2;return n}(o*y(2,69,1))-69)<0?o*y(2,-n,1):o/y(2,n,1),r*=4503599627370496,0<(n=52-n)){for(v(0,r),e=u;7<=e;)v(1e7,0),e-=7;for(v(y(10,e,1),0),e=n-1;23<=e;)p(1<<23),e-=23;p(1<<e),v(1,1),p(2),f=d()}else v(0,r),v(1<<-n,0),f=d()+l.call("0",u);return f=0<u?c+((i=f.length)<=u?"0."+l.call("0",u-i)+f:f.slice(0,i-u)+"."+f.slice(i-u)):c+f}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(165),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(182)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(72)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(183)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("freeze",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(33),i=r(31).f;r(52)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(52)("getOwnPropertyNames",function(){return r(184).f})},function(t,n,r){var e=r(17),i=r(32);r(52)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5);r(52)("isExtensible",function(n){return function(t){return!!e(t)&&(!n||n(t))}})},function(t,n,r){var e=r(5);r(52)("isFrozen",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(5);r(52)("isSealed",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(192)})},function(t,n,r){var e=r(17),i=r(74);r(52)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("preventExtensions",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("seal",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(153).set})},function(t,n,r){"use strict";var e=r(81),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(27)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(188);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u,c=r(68),f=r(3),a=r(47),s=r(81),l=r(1),h=r(5),v=r(21),p=r(70),d=r(71),y=r(119),g=r(158).set,b=r(150)(),x=r(151),m=r(190),S=r(133),w=r(191),_="Promise",O=f.TypeError,E=f.process,M=E&&E.versions,P=M&&M.v8||"",j=f[_],F="process"==s(E),A=function(){},I=i=x.f,L=!!function(){try{var t=j.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(A,A)};return(F||"function"==typeof PromiseRejectionEvent)&&t.then(A)instanceof n&&0!==P.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(t){}}(),N=function(t){var n;return!(!h(t)||"function"!=typeof(n=t.then))&&n},T=function(s,r){if(!s._n){s._n=!0;var e=s._c;b(function(){for(var f=s._v,a=1==s._s,t=0,n=function(t){var n,r,e,i=a?t.ok:t.fail,o=t.resolve,u=t.reject,c=t.domain;try{i?(a||(2==s._h&&C(s),s._h=1),!0===i?n=f:(c&&c.enter(),n=i(f),c&&(c.exit(),e=!0)),n===t.promise?u(O("Promise-chain cycle")):(r=N(n))?r.call(n,o,u):o(n)):u(f)}catch(t){c&&!e&&c.exit(),u(t)}};e.length>t;)n(e[t++]);s._c=[],s._n=!1,r&&!s._h&&k(s)})}},k=function(o){g.call(f,function(){var t,n,r,e=o._v,i=R(o);if(i&&(t=m(function(){F?E.emit("unhandledRejection",e,o):(n=f.onunhandledrejection)?n({promise:o,reason:e}):(r=f.console)&&r.error&&r.error("Unhandled promise rejection",e)}),o._h=F||R(o)?2:1),o._a=void 0,i&&t.e)throw t.v})},R=function(t){return 1!==t._h&&0===(t._a||t._c).length},C=function(n){g.call(f,function(){var t;F?E.emit("rejectionHandled",n):(t=f.onrejectionhandled)&&t({promise:n,reason:n._v})})},D=function(t){var n=this;n._d||(n._d=!0,(n=n._w||n)._v=t,n._s=2,n._a||(n._a=n._c.slice()),T(n,!0))},G=function(t){var r,e=this;if(!e._d){e._d=!0,e=e._w||e;try{if(e===t)throw O("Promise can't be resolved itself");(r=N(t))?b(function(){var n={_w:e,_d:!1};try{r.call(t,a(G,n,1),a(D,n,1))}catch(t){D.call(n,t)}}):(e._v=t,e._s=1,T(e,!1))}catch(t){D.call({_w:e,_d:!1},t)}}};L||(j=function(t){p(this,j,_,"_h"),v(t),e.call(this);try{t(a(G,this,1),a(D,this,1))}catch(t){D.call(this,t)}},(e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(76)(j.prototype,{then:function(t,n){var r=I(y(this,j));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=F?E.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&T(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new e;this.promise=t,this.resolve=a(G,t,1),this.reject=a(D,t,1)},x.f=I=function(t){return t===j||t===u?new o(t):i(t)}),l(l.G+l.W+l.F*!L,{Promise:j}),r(83)(j,_),r(77)(_),u=r(46)[_],l(l.S+l.F*!L,_,{reject:function(t){var n=I(this);return(0,n.reject)(t),n.promise}}),l(l.S+l.F*(c||!L),_,{resolve:function(t){return w(c&&this===u?j:this,t)}}),l(l.S+l.F*!(L&&r(125)(function(t){j.all(t).catch(A)})),_,{all:function(t){var u=this,n=I(u),c=n.resolve,f=n.reject,r=m(function(){var e=[],i=0,o=1;d(t,!1,function(t){var n=i++,r=!1;e.push(void 0),o++,u.resolve(t).then(function(t){r||(r=!0,e[n]=t,--o||c(e))},f)}),--o||c(e)});return r.e&&f(r.v),n.promise},race:function(t){var n=this,r=I(n),e=r.reject,i=m(function(){d(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i.e&&e(i.v),r.promise}})},function(t,n,r){var e=r(1),o=r(21),u=r(2),c=(r(3).Reflect||{}).apply,f=Function.apply;e(e.S+e.F*!r(4)(function(){c(function(){})}),"Reflect",{apply:function(t,n,r){var e=o(t),i=u(r);return c?c(e,n,i):f.call(e,n,i)}})},function(t,n,r){var e=r(1),c=r(72),f=r(21),a=r(2),s=r(5),i=r(4),l=r(169),h=(r(3).Reflect||{}).construct,v=i(function(){function t(){}return!(h(function(){},[],t)instanceof t)}),p=!i(function(){h(function(){})});e(e.S+e.F*(v||p),"Reflect",{construct:function(t,n){f(t),a(n);var r=arguments.length<3?t:f(arguments[2]);if(p&&!v)return h(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(l.apply(t,e))}var i=r.prototype,o=c(s(i)?i:Object.prototype),u=Function.apply.call(t,o,n);return s(u)?u:o}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(53);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(146)(o,"Object",function(){var t,n=this._k;do{if(this._i>=n.length)return{value:void 0,done:!0}}while(!((t=n[this._i++])in this._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){var u=r(31),c=r(32),f=r(30),e=r(1),a=r(5),s=r(2);e(e.S,"Reflect",{get:function t(n,r){var e,i,o=arguments.length<3?n:arguments[2];return s(n)===o?n[r]:(e=u.f(n,r))?f(e,"value")?e.value:void 0!==e.get?e.get.call(o):void 0:a(i=c(n))?t(i,r,o):void 0}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(187)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(153);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){var f=r(11),a=r(31),s=r(32),l=r(30),e=r(1),h=r(75),v=r(2),p=r(5);e(e.S,"Reflect",{set:function t(n,r,e){var i,o,u=arguments.length<4?n:arguments[3],c=a.f(v(n),r);if(!c){if(p(o=s(n)))return t(o,r,e,u);c=h(0)}if(l(c,"value")){if(!1===c.writable||!p(u))return!1;if(i=a.f(u,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=e,f.f(u,r,i)}else f.f(u,r,h(0,e));return!0}return void 0!==c.set&&(c.set.call(u,e),!0)}})},function(t,n,r){var e=r(3),o=r(144),i=r(11).f,u=r(73).f,c=r(124),f=r(115),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),i=void 0===n;return!r&&e&&t.constructor===a&&i?t:o(p?new s(e&&!i?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&i?f.call(t):n),r?this:l,a)};for(var d=function(n){n in a||i(a,n,{configurable:!0,get:function(){return s[n]},set:function(t){s[n]=t}})},y=u(s),g=0;y.length>g;)d(y[g++]);(l.constructor=a).prototype=l,r(27)(e,"RegExp",a)}r(77)("RegExp")},function(t,n,r){"use strict";var l=r(2),h=r(8),v=r(136),p=r(128);r(122)("match",1,function(e,i,a,s){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=s(a,t,this);if(n.done)return n.value;var r=l(t),e=String(this);if(!r.global)return p(r,e);for(var i,o=r.unicode,u=[],c=r.lastIndex=0;null!==(i=p(r,e));){var f=String(i[0]);""===(u[c]=f)&&(r.lastIndex=v(e,h(r.lastIndex),o)),c++}return 0===c?null:u}]})},function(t,n,r){"use strict";var O=r(2),e=r(17),E=r(8),M=r(49),P=r(136),j=r(128),F=Math.max,A=Math.min,h=Math.floor,v=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;r(122)("replace",2,function(i,o,S,w){function _(o,u,c,f,a,t){var s=c+o.length,l=f.length,n=p;return void 0!==a&&(a=e(a),n=v),S.call(t,n,function(t,n){var r;switch(n.charAt(0)){case"$":return"$";case"&":return o;case"`":return u.slice(0,c);case"'":return u.slice(s);case"<":r=a[n.slice(1,-1)];break;default:var e=+n;if(0===e)return t;if(l<e){var i=h(e/10);return 0===i?t:i<=l?void 0===f[i-1]?n.charAt(1):f[i-1]+n.charAt(1):t}r=f[e-1]}return void 0===r?"":r})}return[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):S.call(String(r),t,n)},function(t,n){var r=w(S,t,this,n);if(r.done)return r.value;var e=O(t),i=String(this),o="function"==typeof n;o||(n=String(n));var u,c=e.global;if(c){var f=e.unicode;e.lastIndex=0}for(var a=[];;){var s=j(e,i);if(null===s)break;if(a.push(s),!c)break;""===String(s[0])&&(e.lastIndex=P(i,E(e.lastIndex),f))}for(var l="",h=0,v=0;v<a.length;v++){s=a[v];for(var p=String(s[0]),d=F(A(M(s.index),i.length),0),y=[],g=1;g<s.length;g++)y.push(void 0===(u=s[g])?u:String(u));var b=s.groups;if(o){var x=[p].concat(y,d,i);void 0!==b&&x.push(b);var m=String(n.apply(void 0,x))}else m=_(p,i,d,y,b,n);h<=d&&(l+=i.slice(h,d)+m,h=d+p.length)}return l+i.slice(h)}]})},function(t,n,r){"use strict";var f=r(2),a=r(192),s=r(128);r(122)("search",1,function(e,i,u,c){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=c(u,t,this);if(n.done)return n.value;var r=f(t),e=String(this),i=r.lastIndex;a(i,0)||(r.lastIndex=0);var o=s(r,e);return a(r.lastIndex,i)||(r.lastIndex=i),null===o?-1:o.index}]})},function(t,n,r){"use strict";var l=r(124),x=r(2),m=r(119),S=r(136),w=r(8),_=r(128),h=r(152),e=r(4),O=Math.min,v=[].push,u="split",p="length",d="lastIndex",E=4294967295,M=!e(function(){RegExp(E,"y")});r(122)("split",2,function(i,o,y,g){var b;return b="c"=="abbc"[u](/(b)*/)[1]||4!="test"[u](/(?:)/,-1)[p]||2!="ab"[u](/(?:ab)*/)[p]||4!="."[u](/(.?)(.?)/)[p]||1<"."[u](/()()/)[p]||""[u](/.?/)[p]?function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!l(t))return y.call(r,t,n);for(var e,i,o,u=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,a=void 0===n?E:n>>>0,s=new RegExp(t.source,c+"g");(e=h.call(s,r))&&!(f<(i=s[d])&&(u.push(r.slice(f,e.index)),1<e[p]&&e.index<r[p]&&v.apply(u,e.slice(1)),o=e[0][p],f=i,u[p]>=a));)s[d]===e.index&&s[d]++;return f===r[p]?!o&&s.test("")||u.push(""):u.push(r.slice(f)),u[p]>a?u.slice(0,a):u}:"0"[u](void 0,0)[p]?function(t,n){return void 0===t&&0===n?[]:y.call(this,t,n)}:y,[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):b.call(String(r),t,n)},function(t,n){var r=g(b,t,this,n,b!==y);if(r.done)return r.value;var e=x(t),i=String(this),o=m(e,RegExp),u=e.unicode,c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(M?"y":"g"),f=new o(M?e:"^(?:"+e.source+")",c),a=void 0===n?E:n>>>0;if(0===a)return[];if(0===i.length)return null===_(f,i)?[i]:[];for(var s=0,l=0,h=[];l<i.length;){f.lastIndex=M?l:0;var v,p=_(f,M?i:i.slice(l));if(null===p||(v=O(w(f.lastIndex+(M?0:l)),i.length))===s)l=S(i,l,u);else{if(h.push(i.slice(s,l)),h.length===a)return h;for(var d=1;d<=p.length-1;d++)if(h.push(p[d]),h.length===a)return h;l=s=v}}return h.push(i.slice(s)),h}]})},function(t,n,r){"use strict";r(198);var e=r(2),i=r(115),o=r(10),u="toString",c=/./[u],f=function(t){r(27)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(28)("anchor",function(n){return function(t){return n(this,"a","name",t)}})},function(t,n,r){"use strict";r(28)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(28)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(28)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),u=r(8),c=r(155),f="endsWith",a=""[f];e(e.P+e.F*r(142)(f),"String",{endsWith:function(t){var n=c(this,t,f),r=1<arguments.length?arguments[1]:void 0,e=u(n.length),i=void 0===r?e:Math.min(u(r),e),o=String(t);return a?a.call(n,o,i):n.slice(i-o.length,i)===o}})},function(t,n,r){"use strict";r(28)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(28)("fontcolor",function(n){return function(t){return n(this,"font","color",t)}})},function(t,n,r){"use strict";r(28)("fontsize",function(n){return function(t){return n(this,"font","size",t)}})},function(t,n,r){var e=r(1),o=r(78),u=String.fromCharCode,i=String.fromCodePoint;e(e.S+e.F*(!!i&&1!=i.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,i=0;i<e;){if(n=+arguments[i++],o(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?u(n):u(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(155);e(e.P+e.F*r(142)("includes"),"String",{includes:function(t){return!!~i(this,t,"includes").indexOf(t,1<arguments.length?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(28)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(131)(!0);r(147)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(28)("link",function(n){return function(t){return n(this,"a","href",t)}})},function(t,n,r){var e=r(1),u=r(33),c=r(8);e(e.S,"String",{raw:function(t){for(var n=u(t.raw),r=c(n.length),e=arguments.length,i=[],o=0;o<r;)i.push(String(n[o++])),o<e&&i.push(String(arguments[o]));return i.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(156)})},function(t,n,r){"use strict";r(28)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(8),o=r(155),u="startsWith",c=""[u];e(e.P+e.F*r(142)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(1<arguments.length?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(28)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(28)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(28)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(84)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),u=r(30),i=r(10),o=r(1),c=r(27),f=r(69).KEY,a=r(4),s=r(118),l=r(83),h=r(79),v=r(7),p=r(195),d=r(160),y=r(218),g=r(123),b=r(2),x=r(5),m=r(17),S=r(33),w=r(53),_=r(75),O=r(72),E=r(184),M=r(31),P=r(127),j=r(11),F=r(74),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(73).f=E.f=tt,r(117).f=Q,P.f=nt,i&&!r(68)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(26)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(132),o=r(159),a=r(2),s=r(78),l=r(8),u=r(5),c=r(3).ArrayBuffer,h=r(119),v=o.ArrayBuffer,p=o.DataView,f=i.ABV&&c.isView,d=v.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(c!==v),{ArrayBuffer:v}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return f&&f(t)||u(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new v(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(a(this),t);for(var r=a(this).byteLength,e=s(t,r),i=s(void 0===n?r:n,r),o=new(h(this,v))(l(i-e)),u=new p(this),c=new p(o),f=0;e<i;)c.setUint8(f++,u.getUint8(e++));return o}}),r(77)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(132).ABV,{DataView:r(159).DataView})},function(t,n,r){r(57)("Float32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Float64",8,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(t,n,r){"use strict";var e=r(172),i=r(80);r(121)("WeakSet",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"WeakSet"),t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(21),f=r(138);e(e.P,"Array",{flatMap:function(t){var n,r,e=o(this);return c(t),n=u(e.length),r=f(e,0),i(r,e,e,n,0,1,t,arguments[1]),r}}),r(67)("flatMap")},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(49),f=r(138);e(e.P,"Array",{flatten:function(){var t=arguments[0],n=o(this),r=u(n.length),e=f(n,0);return i(e,n,n,r,0,void 0===t?1:c(t)),e}}),r(67)("flatten")},function(t,n,r){"use strict";var e=r(1),i=r(120)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)("includes")},function(t,n,r){var e=r(1),i=r(150)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.G,{global:r(3)})},function(t,n,r){r(129)("Map")},function(t,n,r){r(130)("Map")},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(171)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{clamp:function(t,n,r){return Math.min(r,Math.max(n,t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,n,r){var e=r(1),i=180/Math.PI;e(e.S,"Math",{degrees:function(t){return t*i}})},function(t,n,r){var e=r(1),o=r(181),u=r(179);e(e.S,"Math",{fscale:function(t,n,r,e,i){return u(o(t,n,r,e,i))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)+(e>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>16,c=e>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>16)+((i*c>>>0)+(65535&f)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)-(e>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,n,r){var e=r(1),i=Math.PI/180;e(e.S,"Math",{radians:function(t){return t*i}})},function(t,n,r){var e=r(1);e(e.S,"Math",{scale:r(181)})},function(t,n,r){var e=r(1);e(e.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:0<t}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>>16,c=e>>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>>16)+((i*c>>>0)+(65535&f)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(186)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),f=r(187),a=r(33),s=r(31),l=r(139);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r,e=a(t),i=s.f,o=f(e),u={},c=0;o.length>c;)void 0!==(r=i(e,n=o[c++]))&&l(u,n,r);return u}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(186)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),o=r(3),u=r(46),i=r(150)(),c=r(7)("observable"),f=r(21),a=r(2),s=r(70),l=r(76),h=r(26),v=r(71),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},x=function(t,n){a(t),this._c=void 0,this._o=t,t=new m(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};x.prototype=l({},{unsubscribe:function(){b(this)}});var m=function(t){this._s=t};m.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var S=function(t){s(this,S,"Observable","_f")._f=f(t)};l(S.prototype,{subscribe:function(t){return new x(t,this._f)},forEach:function(e){var i=this;return new(u.Promise||o.Promise)(function(t,n){f(e);var r=i.subscribe({next:function(t){try{return e(t)}catch(t){n(t),r.unsubscribe()}},error:n,complete:t})})}}),l(S,{from:function(t){var n="function"==typeof this?this:S,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return i(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,e=new Array(n);t<n;)e[t]=arguments[t++];return new("function"==typeof this?this:S)(function(n){var r=!1;return i(function(){if(!r){for(var t=0;t<e.length;++t)if(n.next(e[t]),r)return;n.complete()}}),function(){r=!0}})}}),h(S.prototype,c,function(){return this}),e(e.G,{Observable:S}),r(77)("Observable")},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(3),u=r(119),c=r(191);e(e.P+e.R,"Promise",{finally:function(n){var r=u(this,i.Promise||o.Promise),t="function"==typeof n;return this.then(t?function(t){return c(r,n()).then(function(){return t})}:n,t?function(t){return c(r,n()).then(function(){throw t})}:n)}})},function(t,n,r){"use strict";var e=r(1),i=r(151),o=r(190);e(e.S,"Promise",{try:function(t){var n=i.f(this),r=o(t);return(r.e?n.reject:n.resolve)(r.v),n.promise}})},function(t,n,r){var e=r(56),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(56),o=r(2),u=e.key,c=e.map,f=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:u(arguments[2]),e=c(o(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var i=f.get(n);return i.delete(r),!!i.size||f.delete(n)}})},function(t,n,r){var o=r(199),u=r(167),e=r(56),i=r(2),c=r(32),f=e.keys,a=e.key,s=function(t,n){var r=f(t,n),e=c(t);if(null===e)return r;var i=s(e,n);return i.length?r.length?u(new o(r.concat(i))):i:r};e.exp({getMetadataKeys:function(t){return s(i(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(21),u=e.key,c=e.set;e.exp({metadata:function(r,e){return function(t,n){c(r,e,(void 0!==n?i:o)(t),u(n))}}})},function(t,n,r){r(129)("Set")},function(t,n,r){r(130)("Set")},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(171)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(51),o=r(8),u=r(124),c=r(115),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(146)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padEnd:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padStart:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(84)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(84)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(160)("asyncIterator")},function(t,n,r){r(160)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){r(129)("WeakMap")},function(t,n,r){r(130)("WeakMap")},function(t,n,r){r(129)("WeakSet")},function(t,n,r){r(130)("WeakSet")},function(t,n,r){for(var e=r(162),i=r(74),o=r(27),u=r(3),c=r(26),f=r(82),a=r(7),s=a("iterator"),l=a("toStringTag"),h=f.Array,v={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(v),d=0;d<p.length;d++){var y,g=p[d],b=v[g],x=u[g],m=x&&x.prototype;if(m&&(m[s]||c(m,s,h),m[l]||c(m,l,g),f[g]=h,b))for(y in e)m[y]||o(m,y,e[y],!0)}},function(t,n,r){var e=r(1),i=r(158);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(133),u=[].slice,c=/MSIE .\./.test(o),f=function(i){return function(t,n){var r=2<arguments.length,e=!!r&&u.call(arguments,2);return i(r?function(){("function"==typeof t?t:Function(t)).apply(this,e)}:t,n)}};i(i.G+i.B+i.F*c,{setTimeout:f(e.setTimeout),setInterval:f(e.setInterval)})},function(t,n,r){r(341),r(280),r(282),r(281),r(284),r(286),r(291),r(285),r(283),r(293),r(292),r(288),r(289),r(287),r(279),r(290),r(294),r(295),r(247),r(249),r(248),r(297),r(296),r(267),r(277),r(278),r(268),r(269),r(270),r(271),r(272),r(273),r(274),r(275),r(276),r(250),r(251),r(252),r(253),r(254),r(255),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(328),r(333),r(340),r(331),r(323),r(324),r(329),r(334),r(336),r(319),r(320),r(321),r(322),r(325),r(326),r(327),r(330),r(332),r(335),r(337),r(338),r(339),r(242),r(244),r(243),r(246),r(245),r(231),r(229),r(235),r(232),r(238),r(240),r(228),r(234),r(225),r(239),r(223),r(237),r(236),r(230),r(233),r(222),r(224),r(227),r(226),r(241),r(162),r(313),r(197),r(318),r(198),r(314),r(315),r(316),r(317),r(298),r(196),r(199),r(200),r(353),r(342),r(343),r(348),r(351),r(352),r(346),r(349),r(347),r(350),r(344),r(345),r(299),r(300),r(301),r(302),r(303),r(306),r(304),r(305),r(307),r(308),r(309),r(310),r(312),r(311),r(356),r(354),r(355),r(397),r(400),r(399),r(401),r(402),r(398),r(403),r(404),r(378),r(381),r(377),r(375),r(376),r(379),r(380),r(362),r(396),r(361),r(395),r(407),r(409),r(360),r(394),r(406),r(408),r(359),r(405),r(358),r(363),r(364),r(365),r(366),r(367),r(369),r(368),r(370),r(371),r(372),r(374),r(373),r(383),r(384),r(385),r(386),r(388),r(387),r(390),r(389),r(391),r(392),r(393),r(357),r(382),r(412),r(411),r(410),t.exports=r(46)},function(t,n){t.exports=function(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}}])</script><script src="/./main.a5fda8.js"></script><script>!function(){var e,t;e="/slider.27463f.js",t=document.createElement("script"),document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}()</script>



<!--  -->

<script>
  /* 标签页标题切换 */
  var originTitle = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function () {
    if (document.hidden) {
      document.title = "xkBigData" + originTitle;
      clearTimeout(titleTime);
    } else {
      document.title = "xkBigData" + originTitle;
      titleTime = setTimeout(function () {
        document.title = originTitle;
      }, 2000);
    }
  });
</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 50%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 50%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">cdh</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">hadoop</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">hive</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">javaSE</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">kafka</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">java</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">phoenix</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">scala</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Linux</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">hbase</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">zookeeper</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">clickhouse</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia-plus根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
        
          
  	  		<div class="aboutme-wrap" id="aboutme">主要涉及技术：<br>Hadoop生态圈、Spark开发<br>大数据开发以及架构<br><br>联系QQ:2727546553<br><br>很惭愧<br><br>只做了一点微小的工作<br>谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>

  
  
<script type="text/javascript" src="/plugins/activate-power-mode/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true; // make power mode colorful
  POWERMODE.shake = false; // turn off shake
  document.body.addEventListener('input', POWERMODE);
</script>

  
  <!-- <script async type="text/javascript" size="90" alpha="0.2" zIndex="0" src="/plugins/ribbon.js/ribbon.min.js"></script> -->
  
  
  
</body>

</html>
